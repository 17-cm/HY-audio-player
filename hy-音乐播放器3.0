{
  "type": "script",
  "enabled": true,
  "name": "hy-æ’­æ”¾å™¨3.1å¢å¼ºç‰ˆ",
  "id": "e1046c22-4413-4801-be88-d54173eb76ad",
  "content": "/*\n    name: ğŸµ Insé£æ’­æ”¾å™¨ (V47.0 å¢å¼ºç‰ˆ)\n    author: Enhanced Version\n    version: 47.0\n    description: æ”¯æŒç½‘æ˜“äº‘å…¨é“¾æ¥+æ­Œå•å¯¼å…¥+ç£¨ç ‚ç»ç’ƒå¢å¼º+ç§»åŠ¨ç«¯é€‚é…+å¿«æ·é”®\n    id: ins-player-v47-enhanced\n    enable: true\n    context: ['chat']\n    on: ['load']\n*/\n\n(function() {\n    'use strict';\n\n    let targetDoc = document;\n    try {\n        if (window.parent && window.parent.document) {\n            targetDoc = window.parent.document;\n        }\n    } catch (e) {}\n\n    const clean = () => {\n        const old = targetDoc.getElementById('ins-v47-root');\n        const oldIcon = targetDoc.getElementById('ins-v47-icon');\n        if (old) old.remove();\n        if (oldIcon) oldIcon.remove();\n    };\n    clean();\n\n    const defaultConfig = {\n        cover: 'https://images.unsplash.com/photo-1493225255756-d9584f8606e9?q=80&w=500',\n        coverWidth: 80,\n        coverHeight: 80,\n        \n        expandedBg: '#1a1a1a',\n        collapsedBg: '#1a1a1a',\n        \n        vinylBg: '',\n        borderColor: '#333333',\n        borderWidth: '6px',\n        themeColor: '#ffffff',\n        rgbColor: '#00d2ff',\n        glassAlpha: 0.6,\n        playerWidth: '400px',\n        playerHeight: '160px',\n        \n        lyricsGradientStart: '#00d2ff',\n        lyricsGradientEnd: '#ff00ff',\n        \n        pos: { x: 20, y: 100 }\n    };\n\n    const App = {\n        playlist: [],\n        index: -1,\n        audio: new Audio(),\n        state: {\n            playMode: 0,\n            rgbMode: 0,\n            glass: true,\n            glassOpacity: 0.6,\n            speed: 1.0,\n            panel: false,\n            isMinimized: false,\n            isPlaying: false,\n            isPureMode: false,\n            lyrics: [],\n            currentLyricIndex: -1,\n            cfg: { ...defaultConfig },\n            playerPos: { x: 20, y: 100 },\n            iconPos: { x: 20, y: 300 },\n            importHistory: [],\n            isMobile: false // æ–°å¢ï¼šç§»åŠ¨ç«¯æ£€æµ‹\n        },\n        drag: { active: false, offX: 0, offY: 0 },\n        doubleClickTimer: null,\n        clickCount: 0,\n        currentApiIndex: 1, // å½“å‰ä½¿ç”¨çš„APIç´¢å¼•\n        apiEndpoints: [ // APIå¤‡ç”¨åˆ—è¡¨\n            'https://wyapi-1.toubiec.cn',\n            'https://wyapi-2.toubiec.cn'\n        ],\n        isDragging: false, // é˜²æ­¢è¯¯è§¦\n        touchStartTime: 0, // è§¦æ‘¸å¼€å§‹æ—¶é—´\n        lastTouchY: 0, // æœ€åè§¦æ‘¸Yåæ ‡ï¼ˆç”¨äºç§»åŠ¨ç«¯æ»‘åŠ¨ï¼‰\n\n        init() {\n            this.detectMobile();\n            this.injectCSS();\n            this.createUI();\n            this.loadData();\n            this.bindEvents();\n            this.bindKeyboardShortcuts();\n            console.log('ğŸµ V47.0 å¢å¼ºç‰ˆå¯åŠ¨ - ç§»åŠ¨ç«¯é€‚é…ç‰ˆ');\n        },\n\n        detectMobile() {\n            // æ£€æµ‹ç§»åŠ¨ç«¯\n            const userAgent = navigator.userAgent.toLowerCase();\n            this.state.isMobile = /mobile|android|iphone|ipad|ipod|windows phone/.test(userAgent);\n            \n            // å¦‚æœæ˜¯ç§»åŠ¨ç«¯ï¼Œè°ƒæ•´é»˜è®¤ä½ç½®å’Œå°ºå¯¸\n            if (this.state.isMobile) {\n                defaultConfig.playerWidth = '90vw';\n                defaultConfig.playerHeight = '180px';\n                defaultConfig.coverWidth = 70;\n                defaultConfig.coverHeight = 70;\n                defaultConfig.pos = { x: '5vw', y: '10vh' };\n                \n                // æ›´æ–°ç°æœ‰é…ç½®\n                this.state.cfg.playerWidth = '90vw';\n                this.state.cfg.playerHeight = '180px';\n                this.state.cfg.coverWidth = 70;\n                this.state.cfg.coverHeight = 70;\n            }\n        },\n\n        // è·å–å½“å‰APIåœ°å€\n        getCurrentApi() {\n            return this.apiEndpoints[this.currentApiIndex];\n        },\n\n        // åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªAPI\n        switchApi() {\n            this.currentApiIndex = (this.currentApiIndex + 1) % this.apiEndpoints.length;\n            console.log(`åˆ‡æ¢åˆ°API: ${this.getCurrentApi()}`);\n            return this.getCurrentApi();\n        },\n\n        loadData() {\n            const raw = localStorage.getItem('ins_v47_data');\n            if (raw) {\n                try {\n                    const data = JSON.parse(raw);\n                    this.playlist = data.playlist || [];\n                    if (data.state) {\n                        this.state = { ...this.state, ...data.state };\n                        this.state.cfg = { ...defaultConfig, ...data.state.cfg };\n                        \n                        // ä¿æŒç§»åŠ¨ç«¯æ£€æµ‹åçš„è®¾ç½®\n                        if (this.state.isMobile) {\n                            this.state.cfg.playerWidth = '90vw';\n                            this.state.cfg.playerHeight = '180px';\n                            this.state.cfg.coverWidth = 70;\n                            this.state.cfg.coverHeight = 70;\n                        }\n                        \n                        const checkPos = (pos, def) => {\n                            if (typeof pos.x === 'string' && pos.x.includes('vw')) {\n                                // ç™¾åˆ†æ¯”ä½ç½®ï¼Œä¿æŒåŸæ ·\n                                return;\n                            }\n                            if (pos.x > window.innerWidth - 50) pos.x = def.x;\n                            if (pos.y > window.innerHeight - 50) pos.y = def.y;\n                        };\n                        \n                        const defPos = this.state.isMobile ? { x: '5vw', y: '10vh' } : defaultConfig.pos;\n                        checkPos(this.state.playerPos, defPos);\n                        checkPos(this.state.iconPos, { x: 20, y: 300 });\n                    }\n                } catch (e) {\n                    console.error('åŠ è½½æ•°æ®å¤±è´¥:', e);\n                    // å¦‚æœåŠ è½½å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤å€¼\n                    this.state.cfg = { ...defaultConfig };\n                }\n            }\n            this.state.panel = false;\n            this.updateView();\n            this.renderList();\n        },\n\n        saveData() {\n            try {\n                localStorage.setItem('ins_v47_data', JSON.stringify({\n                    playlist: this.playlist,\n                    state: this.state\n                }));\n            } catch (e) {\n                console.error('ä¿å­˜æ•°æ®å¤±è´¥:', e);\n            }\n        },\n\n        // æ˜¾ç¤ºçŠ¶æ€æç¤ºï¼ˆç§»åŠ¨ç«¯ä¼˜åŒ–ï¼‰\n        showStatus(message, type = 'info', duration = 3000) {\n            const statusEl = targetDoc.getElementById('ins-status');\n            if (statusEl) {\n                statusEl.textContent = message;\n                statusEl.className = `status-${type}`;\n                statusEl.style.opacity = '1';\n                \n                // ç§»åŠ¨ç«¯è°ƒæ•´ä½ç½®\n                if (this.state.isMobile) {\n                    statusEl.style.top = '60px';\n                    statusEl.style.fontSize = '12px';\n                    statusEl.style.padding = '8px 16px';\n                }\n                \n                clearTimeout(this.statusTimer);\n                this.statusTimer = setTimeout(() => {\n                    statusEl.style.opacity = '0';\n                }, duration);\n            } else {\n                // ä¸´æ—¶åˆ›å»ºçŠ¶æ€æç¤º\n                const tempStatus = targetDoc.createElement('div');\n                tempStatus.textContent = message;\n                tempStatus.style.cssText = `\n                    position: fixed;\n                    top: ${this.state.isMobile ? '60px' : '20px'};\n                    left: 50%;\n                    transform: translateX(-50%);\n                    background: ${type === 'error' ? '#ff4444' : type === 'success' ? '#00cc66' : '#00d2ff'};\n                    color: white;\n                    padding: ${this.state.isMobile ? '8px 16px' : '10px 20px'};\n                    border-radius: 20px;\n                    z-index: 2147483648;\n                    font-size: ${this.state.isMobile ? '12px' : '14px'};\n                    box-shadow: 0 5px 15px rgba(0,0,0,0.3);\n                    transition: opacity 0.3s;\n                    white-space: nowrap;\n                    max-width: 80vw;\n                    overflow: hidden;\n                    text-overflow: ellipsis;\n                `;\n                targetDoc.body.appendChild(tempStatus);\n                \n                setTimeout(() => {\n                    tempStatus.style.opacity = '0';\n                    setTimeout(() => tempStatus.remove(), 300);\n                }, duration);\n            }\n        },\n\n        // ç§»åŠ¨ç«¯å‹å¥½çš„ç¡®è®¤å¯¹è¯æ¡†\n        mobileConfirm(message) {\n            return new Promise((resolve) => {\n                if (!this.state.isMobile) {\n                    resolve(confirm(message));\n                    return;\n                }\n\n                const overlay = targetDoc.createElement('div');\n                overlay.className = 'mobile-confirm-overlay';\n                overlay.innerHTML = `\n                    <div class=\"mobile-confirm-dialog\">\n                        <div class=\"mobile-confirm-message\">${message}</div>\n                        <div class=\"mobile-confirm-buttons\">\n                            <button id=\"mobile-confirm-cancel\">å–æ¶ˆ</button>\n                            <button id=\"mobile-confirm-ok\" class=\"primary\">ç¡®å®š</button>\n                        </div>\n                    </div>\n                `;\n                targetDoc.body.appendChild(overlay);\n\n                overlay.querySelector('#mobile-confirm-cancel').onclick = () => {\n                    overlay.remove();\n                    resolve(false);\n                };\n\n                overlay.querySelector('#mobile-confirm-ok').onclick = () => {\n                    overlay.remove();\n                    resolve(true);\n                };\n\n                overlay.onclick = (e) => {\n                    if (e.target === overlay) {\n                        overlay.remove();\n                        resolve(false);\n                    }\n                };\n            });\n        },\n\n        // ç§»åŠ¨ç«¯å‹å¥½çš„æç¤ºè¾“å…¥\n        mobilePrompt(message, defaultValue = '') {\n            return new Promise((resolve) => {\n                if (!this.state.isMobile) {\n                    resolve(prompt(message, defaultValue));\n                    return;\n                }\n\n                const overlay = targetDoc.createElement('div');\n                overlay.className = 'mobile-prompt-overlay';\n                overlay.innerHTML = `\n                    <div class=\"mobile-prompt-dialog\">\n                        <div class=\"mobile-prompt-title\">${message}</div>\n                        <input type=\"text\" id=\"mobile-prompt-input\" value=\"${defaultValue}\" placeholder=\"è¯·è¾“å…¥...\">\n                        <div class=\"mobile-prompt-buttons\">\n                            <button id=\"mobile-prompt-cancel\">å–æ¶ˆ</button>\n                            <button id=\"mobile-prompt-ok\" class=\"primary\">ç¡®å®š</button>\n                        </div>\n                    </div>\n                `;\n                targetDoc.body.appendChild(overlay);\n\n                const input = overlay.querySelector('#mobile-prompt-input');\n                setTimeout(() => input.focus(), 100);\n\n                overlay.querySelector('#mobile-prompt-cancel').onclick = () => {\n                    overlay.remove();\n                    resolve(null);\n                };\n\n                overlay.querySelector('#mobile-prompt-ok').onclick = () => {\n                    const value = input.value.trim();\n                    overlay.remove();\n                    resolve(value || defaultValue);\n                };\n\n                input.onkeypress = (e) => {\n                    if (e.key === 'Enter') {\n                        const value = input.value.trim();\n                        overlay.remove();\n                        resolve(value || defaultValue);\n                    }\n                };\n\n                overlay.onclick = (e) => {\n                    if (e.target === overlay) {\n                        overlay.remove();\n                        resolve(null);\n                    }\n                };\n            });\n        },\n\n        addImportHistory(type, data) {\n            const history = {\n                type: type,\n                data: data,\n                time: new Date().toLocaleTimeString()\n            };\n            this.state.importHistory.unshift(history);\n            if (this.state.importHistory.length > 10) {\n                this.state.importHistory.pop();\n            }\n            this.saveData();\n        },\n\n        handleFileUpload(file, callback) {\n            const reader = new FileReader();\n            reader.onload = (e) => callback(e.target.result);\n            reader.onerror = (e) => {\n                console.error('æ–‡ä»¶è¯»å–å¤±è´¥:', e);\n                this.showStatus('æ–‡ä»¶è¯»å–å¤±è´¥', 'error');\n            };\n            reader.readAsDataURL(file);\n        },\n\n        handleTextFileUpload(file, callback) {\n            const reader = new FileReader();\n            reader.onload = (e) => callback(e.target.result);\n            reader.onerror = (e) => {\n                console.error('æ–‡ä»¶è¯»å–å¤±è´¥:', e);\n                this.showStatus('æ–‡ä»¶è¯»å–å¤±è´¥', 'error');\n            };\n            reader.readAsText(file);\n        },\n\n        createFileInput(accept, callback, multiple = false) {\n            const input = targetDoc.createElement('input');\n            input.type = 'file';\n            input.accept = accept;\n            input.multiple = multiple;\n            input.style.display = 'none';\n            input.onchange = (e) => {\n                if (e.target.files && e.target.files.length > 0) {\n                    if (multiple) {\n                        callback(Array.from(e.target.files));\n                    } else {\n                        callback(e.target.files[0]);\n                    }\n                }\n                input.remove();\n            };\n            input.onerror = (e) => {\n                console.error('æ–‡ä»¶é€‰æ‹©å¤±è´¥:', e);\n                this.showStatus('æ–‡ä»¶é€‰æ‹©å¤±è´¥', 'error');\n                input.remove();\n            };\n            targetDoc.body.appendChild(input);\n            \n            // ç§»åŠ¨ç«¯è§¦å‘æ–¹å¼\n            if (this.state.isMobile) {\n                input.style.position = 'fixed';\n                input.style.top = '0';\n                input.style.left = '0';\n                input.style.width = '100%';\n                input.style.height = '100%';\n                input.style.opacity = '0';\n            }\n            \n            input.click();\n        },\n\n        // ä¼˜åŒ–èƒŒæ™¯å›¾ç‰‡å¤„ç†ï¼ˆé˜²æ­¢æ”¾å¤§ï¼‰\n        optimizeBackgroundImage(dataUrl) {\n            return new Promise((resolve) => {\n                const img = new Image();\n                img.onload = () => {\n                    // åˆ›å»ºcanvasæ¥ä¼˜åŒ–å›¾ç‰‡\n                    const canvas = targetDoc.createElement('canvas');\n                    const ctx = canvas.getContext('2d');\n                    \n                    // è®¾ç½®canvaså°ºå¯¸ä¸ºåŸå›¾å°ºå¯¸ï¼ˆä¸æ”¾å¤§ï¼‰\n                    canvas.width = img.width;\n                    canvas.height = img.height;\n                    \n                    // ç»˜åˆ¶å›¾ç‰‡\n                    ctx.drawImage(img, 0, 0);\n                    \n                    // è½¬æ¢ä¸ºbase64\n                    const optimizedDataUrl = canvas.toDataURL('image/jpeg', 0.8);\n                    resolve(optimizedDataUrl);\n                };\n                img.onerror = () => {\n                    // å¦‚æœå›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨åŸæ•°æ®URL\n                    resolve(dataUrl);\n                };\n                img.src = dataUrl;\n            });\n        },\n\n        // å¤„ç†èƒŒæ™¯å›¾ç‰‡URLï¼Œç¡®ä¿æ­£ç¡®æ˜¾ç¤º\n        createBackgroundUrl(dataUrl) {\n            return `url(\"${dataUrl}\") center/cover no-repeat`;\n        },\n\n        updateView() {\n            const root = targetDoc.getElementById('ins-v47-root');\n            const rootRgb = targetDoc.getElementById('root-rgb');\n            const inner = targetDoc.getElementById('root-inner');\n            const icon = targetDoc.getElementById('ins-v47-icon');\n            const cfg = this.state.cfg;\n\n            // ç§»åŠ¨ç«¯ä¼˜åŒ–\n            if (this.state.isMobile) {\n                root.style.left = typeof cfg.pos.x === 'string' ? cfg.pos.x : cfg.pos.x + 'px';\n                root.style.top = typeof cfg.pos.y === 'string' ? cfg.pos.y : cfg.pos.y + 'px';\n            } else {\n                root.style.left = this.state.playerPos.x + 'px';\n                root.style.top = this.state.playerPos.y + 'px';\n            }\n            \n            icon.style.left = this.state.iconPos.x + 'px';\n            icon.style.top = this.state.iconPos.y + 'px';\n\n            root.style.setProperty('--border-w', cfg.borderWidth);\n            root.style.setProperty('--rgb-single', cfg.rgbColor);\n            root.style.setProperty('--player-h', cfg.playerHeight);\n            root.style.setProperty('--lyrics-start', cfg.lyricsGradientStart);\n            root.style.setProperty('--lyrics-end', cfg.lyricsGradientEnd);\n            root.style.color = cfg.themeColor;\n            root.style.width = cfg.playerWidth;\n            icon.style.setProperty('--rgb-single', cfg.rgbColor);\n\n            const hexToRgba = (hex, alpha) => {\n                if (!hex || typeof hex !== 'string') {\n                    return `rgba(26, 26, 26, ${alpha})`;\n                }\n                \n                let r=0, g=0, b=0;\n                const cleanHex = hex.replace('#', '');\n                \n                if(cleanHex.length === 3){\n                    r=parseInt(cleanHex[0]+cleanHex[0],16);\n                    g=parseInt(cleanHex[1]+cleanHex[1],16);\n                    b=parseInt(cleanHex[2]+cleanHex[2],16);\n                }else if(cleanHex.length === 6){\n                    r=parseInt(cleanHex.slice(0,2),16);\n                    g=parseInt(cleanHex.slice(2,4),16);\n                    b=parseInt(cleanHex.slice(4,6),16);\n                }\n                return `rgba(${r},${g},${b},${alpha})`;\n            };\n\n            let currentBg = this.state.panel ? cfg.expandedBg : cfg.collapsedBg;\n\n            // ä¿®å¤ï¼šç£¨ç ‚ç»ç’ƒæ•ˆæœå’ŒèƒŒæ™¯é¢œè‰²å†²çªçš„é—®é¢˜\n            if (this.state.glass) {\n                inner.classList.add('glass-mode');\n                \n                // è®¾ç½®CSSå˜é‡ä¾›CSSä½¿ç”¨\n                inner.style.setProperty('--glass-opacity', this.state.glassOpacity);\n                \n                // å¦‚æœæ˜¯çº¯è‰²èƒŒæ™¯\n                if (currentBg.startsWith('#')) {\n                    // è®¾ç½®èƒŒæ™¯è‰²ä¸ºåŠé€æ˜ï¼ŒåŒæ—¶ä¿ç•™ç£¨ç ‚æ•ˆæœ\n                    inner.style.background = hexToRgba(currentBg, this.state.glassOpacity);\n                    inner.style.setProperty('--glass-bg-color', hexToRgba(currentBg, this.state.glassOpacity));\n                } \n                // å¦‚æœæ˜¯å›¾ç‰‡èƒŒæ™¯\n                else if (currentBg.startsWith('url')) {\n                    // ä¿æŒå›¾ç‰‡èƒŒæ™¯ï¼Œæ·»åŠ ç£¨ç ‚æ•ˆæœ\n                    inner.style.background = currentBg;\n                    inner.style.backgroundSize = 'cover';\n                    inner.style.backgroundPosition = 'center';\n                    inner.style.backgroundRepeat = 'no-repeat';\n                    \n                    // æ·»åŠ åŠé€æ˜è¦†ç›–å±‚å®ç°ç£¨ç ‚æ•ˆæœ\n                    inner.style.setProperty('--glass-overlay', `rgba(0,0,0,${0.5 * (1 - this.state.glassOpacity)})`);\n                } \n                // å…¶ä»–æƒ…å†µ\n                else {\n                    inner.style.background = currentBg;\n                }\n            } else {\n                // å…³é—­ç£¨ç ‚æ•ˆæœ\n                inner.classList.remove('glass-mode');\n                inner.style.background = currentBg;\n                inner.style.backdropFilter = 'none';\n                inner.style.setProperty('--glass-overlay', 'transparent');\n            }\n\n            const coverEl = targetDoc.getElementById('ins-cover');\n            if (coverEl) {\n                coverEl.style.backgroundImage = `url(\"${cfg.cover}\")`;\n                coverEl.style.width = cfg.coverWidth + 'px';\n                coverEl.style.height = cfg.coverHeight + 'px';\n                \n                // ç§»åŠ¨ç«¯è°ƒæ•´å°é¢å¤§å°\n                if (this.state.isMobile) {\n                    coverEl.style.marginRight = '10px';\n                }\n            }\n\n            if (rootRgb) {\n                rootRgb.className = 'rgb-layer';\n                rootRgb.style.background = cfg.borderColor;\n                \n                const mode = this.state.rgbMode;\n                if (mode === 1) rootRgb.classList.add('mode-single');\n                else if (mode === 2) rootRgb.classList.add('mode-rainbow');\n            }\n\n            if (icon) {\n                icon.className = '';\n                if (this.state.isPlaying) icon.classList.add('playing');\n                if (this.state.rgbMode === 1) icon.classList.add('rgb-single');\n                if (this.state.rgbMode === 2) icon.classList.add('rgb-rainbow');\n\n                if (this.state.isMinimized) {\n                    root.style.display = 'none';\n                    icon.style.display = 'flex';\n                } else {\n                    icon.style.display = 'none';\n                    root.style.display = 'flex';\n                }\n            }\n\n            if (root) {\n                root.classList.toggle('pure-mode', this.state.isPureMode);\n            }\n            \n            this.updatePureLyrics();\n\n            const modeBtn = targetDoc.getElementById('btn-mode');\n            if (modeBtn) {\n                const svgs = [\n                    '<svg viewBox=\"0 0 24 24\" width=\"16\" height=\"16\" stroke=\"currentColor\" stroke-width=\"2\" fill=\"none\"><path d=\"M17 1l4 4-4 4\"/><path d=\"M3 11V9a4 4 0 0 1 4-4h14\"/><path d=\"M7 23l-4-4 4-4\"/><path d=\"M21 13v2a4 4 0 0 1-4 4H3\"/></svg>',\n                    '<svg viewBox=\"0 0 24 24\" width=\"16\" height=\"16\" stroke=\"currentColor\" stroke-width=\"2\" fill=\"none\"><path d=\"M17 1l4 4-4 4\"/><path d=\"M3 11V9a4 4 0 0 1 4-4h14\"/><path d=\"M7 23l-4-4 4-4\"/><path d=\"M21 13v2a4 4 0 0 1-4 4H3\"/><text x=\"10\" y=\"17\" font-size=\"8\" stroke=\"none\" fill=\"currentColor\">1</text></svg>',\n                    '<svg viewBox=\"0 0 24 24\" width=\"16\" height=\"16\" stroke=\"currentColor\" stroke-width=\"2\" fill=\"none\"><path d=\"M16 3h5v5\"/><path d=\"M4 20L21 3\"/><path d=\"M21 16v5h-5\"/><path d=\"M15 15l6 6\"/><path d=\"M4 4l5 5\"/></svg>'\n                ];\n                modeBtn.innerHTML = svgs[this.state.playMode];\n            }\n\n            const t = this.playlist[this.index];\n            const titleEl = targetDoc.getElementById('ins-t');\n            const artistEl = targetDoc.getElementById('ins-a');\n            \n            if (titleEl) titleEl.innerText = t ? t.title : 'ç‚¹å‡»ä¸‹æ–¹æ·»åŠ æ­Œæ›²';\n            if (artistEl) artistEl.innerText = t ? t.artist : 'ç­‰å¾…æ’­æ”¾';\n\n            this.updateSettingsPanel();\n        },\n\n        updateSettingsPanel() {\n            const cfg = this.state.cfg;\n            \n            // æ›´æ–°æ‰€æœ‰è®¾ç½®æ§ä»¶\n            const updates = [\n                { id: 'inp-theme', value: cfg.themeColor },\n                { id: 'inp-border', value: cfg.borderColor },\n                { id: 'inp-rgb', value: cfg.rgbColor },\n                { id: 'inp-lyrics-start', value: cfg.lyricsGradientStart },\n                { id: 'inp-lyrics-end', value: cfg.lyricsGradientEnd },\n                { id: 'inp-expanded-col', value: cfg.expandedBg.startsWith('#') ? cfg.expandedBg : '#1a1a1a' },\n                { id: 'inp-collapsed-col', value: cfg.collapsedBg.startsWith('#') ? cfg.collapsedBg : '#1a1a1a' },\n                { id: 'sw-glass', checked: this.state.glass, type: 'checkbox' },\n                { id: 'inp-glass-opacity', value: Math.round(this.state.glassOpacity * 100) },\n                { id: 'val-glass-opacity', text: Math.round(this.state.glassOpacity * 100) + '%' },\n                { id: 'inp-speed', value: this.state.speed },\n                { id: 'val-speed', text: this.state.speed + 'x' },\n                { id: 'inp-width', value: parseInt(cfg.borderWidth) },\n                { id: 'val-width', text: cfg.borderWidth },\n                { id: 'inp-width-player', value: parseInt(cfg.playerWidth) },\n                { id: 'val-width-player', text: cfg.playerWidth },\n                { id: 'inp-height-player', value: parseInt(cfg.playerHeight) },\n                { id: 'val-height-player', text: cfg.playerHeight },\n                { id: 'inp-cover-w', value: cfg.coverWidth },\n                { id: 'val-cover-w', text: cfg.coverWidth + 'px' },\n                { id: 'inp-cover-h', value: cfg.coverHeight },\n                { id: 'val-cover-h', text: cfg.coverHeight + 'px' }\n            ];\n\n            updates.forEach(item => {\n                const el = targetDoc.getElementById(item.id);\n                if (el) {\n                    if (item.type === 'checkbox') {\n                        el.checked = item.checked;\n                    } else if (item.text !== undefined) {\n                        el.innerText = item.text;\n                    } else {\n                        el.value = item.value;\n                    }\n                }\n            });\n\n            // æ›´æ–°RGBæ¨¡å¼é€‰é¡¹\n            const rgbOpts = targetDoc.querySelectorAll('.rgb-opt');\n            rgbOpts.forEach(opt => {\n                opt.classList.toggle('active', parseInt(opt.dataset.val) === this.state.rgbMode);\n            });\n        },\n\n        updatePureLyrics() {\n            const container = targetDoc.getElementById('pure-lyrics-container');\n            if (!container) return;\n            \n            if (!this.state.lyrics.length) {\n                container.innerHTML = '<div class=\"pure-lyric-line active no-lyrics\">æ™šç¡çš„å°å­©ä¸ä¼šæœ‰ç¾æ¢¦å…‰ä¸´å“¦</div>';\n                return;\n            }\n\n            const time = this.audio.currentTime;\n            let currentIndex = -1;\n            \n            for (let i = 0; i < this.state.lyrics.length; i++) {\n                if (time >= this.state.lyrics[i].time) {\n                    currentIndex = i;\n                } else {\n                    break;\n                }\n            }\n\n            if (currentIndex !== this.state.currentLyricIndex) {\n                this.state.currentLyricIndex = currentIndex;\n                this.renderPureLyrics(currentIndex);\n            }\n\n            if (currentIndex >= 0 && currentIndex < this.state.lyrics.length - 1) {\n                const currentLyric = this.state.lyrics[currentIndex];\n                const nextLyric = this.state.lyrics[currentIndex + 1];\n                const duration = nextLyric.time - currentLyric.time;\n                const elapsed = time - currentLyric.time;\n                const progress = Math.min(elapsed / duration * 100, 100);\n                \n                const activeLine = container.querySelector('.pure-lyric-line.active');\n                if (activeLine) {\n                    activeLine.style.setProperty('--progress', progress + '%');\n                }\n            }\n        },\n\n        renderPureLyrics(currentIndex) {\n            const container = targetDoc.getElementById('pure-lyrics-container');\n            if (!container) return;\n            \n            container.innerHTML = '';\n            \n            const start = Math.max(0, currentIndex - 2);\n            const end = Math.min(this.state.lyrics.length, currentIndex + 3);\n            \n            for (let i = start; i < end; i++) {\n                const line = targetDoc.createElement('div');\n                line.className = 'pure-lyric-line';\n                line.innerText = this.state.lyrics[i].text;\n                \n                if (i === currentIndex) {\n                    line.classList.add('active');\n                } else if (i < currentIndex) {\n                    line.classList.add('passed');\n                }\n                \n                container.appendChild(line);\n            }\n        },\n\n        play(i) {\n            if (!this.playlist[i]) return;\n            this.index = i;\n            this.audio.src = this.playlist[i].url;\n            this.audio.playbackRate = this.state.speed;\n            this.audio.play().catch(e => {\n                console.log('æ’­æ”¾å¤±è´¥:', e);\n                this.showStatus('æ’­æ”¾å¤±è´¥ï¼Œè¯·æ£€æŸ¥éŸ³é¢‘é“¾æ¥', 'error');\n            });\n            this.state.lyrics = this.playlist[i].lyrics ? this.parseLyrics(this.playlist[i].lyrics) : [];\n            this.state.currentLyricIndex = -1;\n            this.updateView();\n            this.renderList();\n        },\n\n        toggle() {\n            if (!this.playlist.length) return this.showAddOptions();\n            if (this.audio.paused) {\n                if (this.index === -1) {\n                    this.play(0);\n                } else {\n                    this.audio.play().catch(e => {\n                        console.log('æ’­æ”¾å¤±è´¥:', e);\n                        this.showStatus('æ’­æ”¾å¤±è´¥', 'error');\n                    });\n                }\n            } else {\n                this.audio.pause();\n            }\n        },\n\n        next() {\n            if (!this.playlist.length) return;\n            let n;\n            if (this.state.playMode === 2) {\n                do { n = Math.floor(Math.random() * this.playlist.length); } while (n === this.index && this.playlist.length > 1);\n            } else {\n                n = this.index + 1 >= this.playlist.length ? 0 : this.index + 1;\n            }\n            this.play(n);\n        },\n\n        prev() {\n            if (!this.playlist.length) return;\n            let n = this.index - 1 < 0 ? this.playlist.length - 1 : this.index - 1;\n            this.play(n);\n        },\n\n        togglePanel(type) {\n            const root = targetDoc.getElementById('ins-v47-root');\n            const p1 = targetDoc.getElementById('panel-set');\n            const p2 = targetDoc.getElementById('panel-list');\n            const p3 = targetDoc.getElementById('panel-history');\n            \n            if (this.state.panel === type) {\n                root.classList.remove('expanded');\n                p1.style.display = p2.style.display = p3.style.display = 'none';\n                this.state.panel = false;\n            } else {\n                root.classList.add('expanded');\n                p1.style.display = type === 'set' ? 'flex' : 'none';\n                p2.style.display = type === 'list' ? 'flex' : 'none';\n                p3.style.display = type === 'history' ? 'flex' : 'none';\n                this.state.panel = type;\n                \n                if (type === 'history') {\n                    this.renderImportHistory();\n                }\n            }\n            this.updateView();\n        },\n\n        togglePureMode() {\n            this.state.isPureMode = !this.state.isPureMode;\n            this.state.currentLyricIndex = -1;\n            this.updateView();\n            this.saveData();\n        },\n\n        parseLyrics(lrc) {\n            if (!lrc) return [];\n            const lines = lrc.split('\\n');\n            const result = [];\n            const regex = /\\[(\\d{2}):(\\d{2})\\.(\\d{2,3})\\](.*)/;\n            for (const line of lines) {\n                const match = line.match(regex);\n                if (match) {\n                    const time = parseInt(match[1]) * 60 + parseInt(match[2]) + parseInt(match[3]) / 1000;\n                    const text = match[4].trim();\n                    if (text) result.push({ time, text });\n                }\n            }\n            return result.sort((a, b) => a.time - b.time);\n        },\n\n        // ==================== é“¾æ¥è¯†åˆ«è¾…åŠ©å‡½æ•° ====================\n        isNeteaseLink(url) {\n            if (!url) return false;\n            return url.includes('music.163.com') || \n                   url.includes('163cn.tv') || \n                   url.includes('y.music.163.com');\n        },\n\n        isPlaylistLink(url) {\n            if (!url) return false;\n            return url.includes('playlist') || url.includes('playlist?id=') || url.includes('/my/m/music/playlist?id=');\n        },\n\n        extractIdFromLink(link) {\n            if (!link) return null;\n            const cleanLink = link.trim();\n            \n            // çŸ­é“¾æ¥ç›´æ¥è¿”å›\n            if (cleanLink.includes('163cn.tv/')) {\n                const match = cleanLink.match(/163cn\\.tv\\/([a-zA-Z0-9]+)/);\n                return match ? match[1] : null;\n            }\n            \n            // æ ‡å‡†é“¾æ¥æå–æ•°å­—ID\n            const idMatch = cleanLink.match(/(\\d{6,})/);\n            return idMatch ? idMatch[1] : null;\n        },\n\n        // ==================== æ˜¾ç¤ºæ·»åŠ é€‰é¡¹å¯¹è¯æ¡†ï¼ˆæ–°å¢æœ¬åœ°å¯¼å…¥ï¼‰ ====================\n        showAddOptions() {\n            const overlay = targetDoc.createElement('div');\n            overlay.className = 'lyrics-dialog-overlay';\n            overlay.innerHTML = `\n                <div class=\"add-options-dialog\">\n                    <div class=\"lyrics-dialog-title\">æ·»åŠ æ­Œæ›²</div>\n                    <div class=\"add-options-btns\">\n                        <button id=\"add-local-btn\">\n                            <div class=\"option-icon\">ğŸ“</div>\n                            <div class=\"option-text\">æœ¬åœ°å¯¼å…¥</div>\n                        </button>\n                        <button id=\"add-link-btn\">\n                            <div class=\"option-icon\">ğŸ”—</div>\n                            <div class=\"option-text\">é“¾æ¥å¯¼å…¥</div>\n                        </button>\n                    </div>\n                    <button id=\"add-cancel-btn\" class=\"lyrics-cancel\">å–æ¶ˆ</button>\n                </div>\n            `;\n            targetDoc.body.appendChild(overlay);\n\n            overlay.querySelector('#add-local-btn').onclick = () => {\n                overlay.remove();\n                this.addLocalSongs();\n            };\n\n            overlay.querySelector('#add-link-btn').onclick = () => {\n                overlay.remove();\n                this.showLinkOptions();\n            };\n\n            overlay.querySelector('#add-cancel-btn').onclick = () => {\n                overlay.remove();\n            };\n\n            overlay.onclick = (e) => {\n                if (e.target === overlay) overlay.remove();\n            };\n        },\n\n        // ==================== æ˜¾ç¤ºé“¾æ¥é€‰é¡¹å¯¹è¯æ¡† ====================\n        showLinkOptions() {\n            const overlay = targetDoc.createElement('div');\n            overlay.className = 'lyrics-dialog-overlay';\n            overlay.innerHTML = `\n                <div class=\"add-options-dialog\">\n                    <div class=\"lyrics-dialog-title\">é“¾æ¥å¯¼å…¥</div>\n                    <div class=\"link-options-info\">\n                        æ”¯æŒï¼š<br>\n                        â€¢ URLç›´é“¾ï¼ˆmp3/m4aç­‰ï¼‰<br>\n                        â€¢ ç½‘æ˜“äº‘åˆ†äº«é“¾æ¥<br>\n                        â€¢ æ­Œå•é“¾æ¥\n                    </div>\n                    <div class=\"add-options-btns\">\n                        <button id=\"link-single-btn\">\n                            <div class=\"option-icon\">ğŸµ</div>\n                            <div class=\"option-text\">å•æ›²å¯¼å…¥</div>\n                        </button>\n                        <button id=\"link-playlist-btn\">\n                            <div class=\"option-icon\">ğŸ“‹</div>\n                            <div class=\"option-text\">æ­Œå•å¯¼å…¥</div>\n                        </button>\n                    </div>\n                    <button id=\"link-cancel-btn\" class=\"lyrics-cancel\">å–æ¶ˆ</button>\n                </div>\n            `;\n            targetDoc.body.appendChild(overlay);\n\n            overlay.querySelector('#link-single-btn').onclick = () => {\n                overlay.remove();\n                this.addUrlSong();\n            };\n\n            overlay.querySelector('#link-playlist-btn').onclick = () => {\n                overlay.remove();\n                this.addPlaylist();\n            };\n\n            overlay.querySelector('#link-cancel-btn').onclick = () => {\n                overlay.remove();\n            };\n\n            overlay.onclick = (e) => {\n                if (e.target === overlay) overlay.remove();\n            };\n        },\n\n        // ==================== æœ¬åœ°å¯¼å…¥åŠŸèƒ½ ====================\n        async addLocalSongs() {\n            this.createFileInput('audio/*', async (files) => {\n                if (!files) return;\n                \n                const fileList = Array.isArray(files) ? files : [files];\n                let addedCount = 0;\n                \n                this.showStatus(`æ­£åœ¨å¯¼å…¥ ${fileList.length} ä¸ªæ–‡ä»¶...`, 'info');\n                \n                for (let i = 0; i < fileList.length; i++) {\n                    const file = fileList[i];\n                    try {\n                        // åˆ›å»ºå¯¹è±¡URL\n                        const objectUrl = URL.createObjectURL(file);\n                        \n                        // å°è¯•è·å–å…ƒæ•°æ®\n                        const audio = new Audio();\n                        audio.src = objectUrl;\n                        \n                        const title = file.name.replace(/\\.[^/.]+$/, \"\") || 'æœªçŸ¥æ­Œæ›²';\n                        const artist = 'æœ¬åœ°æ–‡ä»¶';\n                        \n                        this.playlist.push({\n                            title: title,\n                            artist: artist,\n                            url: objectUrl,\n                            lyrics: '',\n                            cover: defaultConfig.cover,\n                            isLocal: true // æ ‡è®°ä¸ºæœ¬åœ°æ–‡ä»¶\n                        });\n                        \n                        addedCount++;\n                        \n                        // æ›´æ–°è¿›åº¦\n                        if ((i + 1) % 5 === 0 || i === fileList.length - 1) {\n                            this.showStatus(`å·²å¯¼å…¥ ${i + 1}/${fileList.length} é¦–æ­Œæ›²`, 'info');\n                        }\n                        \n                    } catch (error) {\n                        console.error(`æ–‡ä»¶ ${file.name} å¯¼å…¥å¤±è´¥:`, error);\n                    }\n                }\n                \n                this.saveData();\n                this.renderList();\n                \n                if (addedCount > 0) {\n                    this.showStatus(`æˆåŠŸå¯¼å…¥ ${addedCount} é¦–æœ¬åœ°æ­Œæ›²`, 'success');\n                    \n                    if (this.index === -1 && this.playlist.length > 0) {\n                        this.play(this.playlist.length - 1);\n                    }\n                } else {\n                    this.showStatus('æ²¡æœ‰æ­Œæ›²æˆåŠŸå¯¼å…¥', 'error');\n                }\n            }, true); // trueè¡¨ç¤ºå…è®¸å¤šé€‰\n        },\n\n        // ==================== å•æ›²æ·»åŠ ï¼ˆå¸¦APIå¤‡ç”¨ï¼‰ ====================\n        async fetchNeteaseSongInfo(link, retryCount = 0) {\n            const maxRetries = this.apiEndpoints.length - 1;\n            \n            try {\n                this.showStatus('æ­£åœ¨è§£æé“¾æ¥...', 'info');\n                \n                const apiBase = this.getCurrentApi();\n                const detailResponse = await fetch(`${apiBase}/api/music/detail`, {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify({ id: link })\n                });\n                \n                if (!detailResponse.ok) {\n                    throw new Error('è·å–æ­Œæ›²ä¿¡æ¯å¤±è´¥');\n                }\n                \n                const detailData = await detailResponse.json();\n                \n                if (detailData.code !== 200) {\n                    // å¦‚æœAPIè¿”å›é”™è¯¯ï¼Œå°è¯•åˆ‡æ¢API\n                    if (retryCount < maxRetries) {\n                        this.switchApi();\n                        return this.fetchNeteaseSongInfo(link, retryCount + 1);\n                    }\n                    throw new Error(detailData.msg || 'APIè¿”å›é”™è¯¯');\n                }\n                \n                const songInfo = detailData.data;\n                \n                // è·å–æ’­æ”¾é“¾æ¥\n                const urlResponse = await fetch(`${apiBase}/api/music/url`, {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify({ \n                        id: link, \n                        level: 'exhigh'\n                    })\n                });\n                \n                if (!urlResponse.ok) {\n                    throw new Error('è·å–æ’­æ”¾é“¾æ¥å¤±è´¥');\n                }\n                \n                const urlData = await urlResponse.json();\n                \n                if (urlData.code !== 200) {\n                    throw new Error(urlData.msg || 'è·å–æ’­æ”¾é“¾æ¥å¤±è´¥');\n                }\n                \n                // è·å–æ­Œè¯\n                let lyrics = '';\n                try {\n                    const lyricResponse = await fetch(`${apiBase}/api/music/lyric`, {\n                        method: 'POST',\n                        headers: { 'Content-Type': 'application/json' },\n                        body: JSON.stringify({ id: link })\n                    });\n                    \n                    if (lyricResponse.ok) {\n                        const lyricData = await lyricResponse.json();\n                        if (lyricData.code === 200) {\n                            lyrics = lyricData.data.lrc || '';\n                        }\n                    }\n                } catch (lyricError) {\n                    console.warn('è·å–æ­Œè¯å¤±è´¥:', lyricError);\n                }\n                \n                // è§£ææ’­æ”¾é“¾æ¥\n                let playUrl = '';\n                if (urlData.data && Array.isArray(urlData.data) && urlData.data[0]) {\n                    playUrl = urlData.data[0].url || '';\n                }\n                \n                if (!playUrl) {\n                    throw new Error('æ— æ³•è·å–æ’­æ”¾é“¾æ¥');\n                }\n                \n                return {\n                    title: songInfo.name || 'æœªçŸ¥æ­Œæ›²',\n                    artist: songInfo.singer || 'æœªçŸ¥è‰ºæœ¯å®¶',\n                    url: playUrl,\n                    lyrics: lyrics,\n                    cover: songInfo.picimg || defaultConfig.cover,\n                    duration: songInfo.duration || '0:00'\n                };\n                \n            } catch (error) {\n                console.error('ç½‘æ˜“äº‘è§£æå¤±è´¥:', error);\n                \n                // å¦‚æœè¿˜æœ‰å¤‡ç”¨APIï¼Œå°è¯•åˆ‡æ¢\n                if (retryCount < maxRetries) {\n                    this.showStatus('æ­£åœ¨åˆ‡æ¢å¤‡ç”¨API...', 'info');\n                    this.switchApi();\n                    return this.fetchNeteaseSongInfo(link, retryCount + 1);\n                }\n                \n                this.showStatus(`è§£æå¤±è´¥: ${error.message}`, 'error');\n                throw error;\n            }\n        },\n\n        async addUrlSong() {\n            const input = await this.mobilePrompt(\n                'è¯·è¾“å…¥æ­Œæ›²é“¾æ¥ï¼š\\næ”¯æŒæ ¼å¼ï¼š\\nâ€¢ ç½‘æ˜“äº‘é“¾æ¥\\nâ€¢ ç›´é“¾URL\\nâ€¢ å…¶ä»–éŸ³é¢‘é“¾æ¥',\n                ''\n            );\n            \n            if (!input) return;\n            \n            // æ£€æŸ¥æ˜¯å¦ä¸ºç½‘æ˜“äº‘é“¾æ¥\n            if (this.isNeteaseLink(input)) {\n                try {\n                    const songInfo = await this.fetchNeteaseSongInfo(input);\n                    \n                    this.playlist.push({\n                        title: songInfo.title,\n                        artist: songInfo.artist,\n                        url: songInfo.url,\n                        lyrics: songInfo.lyrics || '',\n                        cover: songInfo.cover,\n                        isNetease: true\n                    });\n                    \n                    this.addImportHistory('single', {\n                        title: songInfo.title,\n                        artist: songInfo.artist,\n                        link: input\n                    });\n                    \n                    this.saveData();\n                    this.renderList();\n                    this.showStatus(`æˆåŠŸæ·»åŠ : ${songInfo.title}`, 'success');\n                    \n                    if (this.index === -1) {\n                        this.play(this.playlist.length - 1);\n                    }\n                } catch (error) {\n                    console.error('æ·»åŠ å¤±è´¥:', error);\n                }\n            } else {\n                // æ™®é€šéŸ³é¢‘é“¾æ¥\n                const title = await this.mobilePrompt('æ­Œå:', 'Untitled') || 'Untitled';\n                const artist = await this.mobilePrompt('æ­Œæ‰‹:', 'Unknown') || 'Unknown';\n                \n                this.playlist.push({\n                    title: title,\n                    artist: artist,\n                    url: input,\n                    lyrics: '',\n                    cover: defaultConfig.cover,\n                    isDirectLink: true\n                });\n                \n                this.saveData();\n                this.renderList();\n                this.showStatus('æ­Œæ›²æ·»åŠ æˆåŠŸï¼', 'success');\n                \n                if (this.index === -1) {\n                    this.play(this.playlist.length - 1);\n                }\n            }\n        },\n\n        // ==================== æ­Œå•æ·»åŠ ï¼ˆå¸¦APIå¤‡ç”¨ï¼‰ ====================\n        async fetchNeteasePlaylist(link, retryCount = 0) {\n            const maxRetries = this.apiEndpoints.length - 1;\n            \n            try {\n                this.showStatus('æ­£åœ¨è§£ææ­Œå•...', 'info');\n                \n                const apiBase = this.getCurrentApi();\n                const response = await fetch(`${apiBase}/api/music/playlist`, {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify({ id: link })\n                });\n                \n                if (!response.ok) {\n                    throw new Error('è·å–æ­Œå•å¤±è´¥');\n                }\n                \n                const data = await response.json();\n                \n                if (data.code !== 200) {\n                    // å¦‚æœAPIè¿”å›é”™è¯¯ï¼Œå°è¯•åˆ‡æ¢API\n                    if (retryCount < maxRetries) {\n                        this.switchApi();\n                        return this.fetchNeteasePlaylist(link, retryCount + 1);\n                    }\n                    throw new Error(data.msg || 'APIè¿”å›é”™è¯¯');\n                }\n                \n                const playlist = data.data;\n                return playlist;\n                \n            } catch (error) {\n                console.error('æ­Œå•è§£æå¤±è´¥:', error);\n                \n                // å¦‚æœè¿˜æœ‰å¤‡ç”¨APIï¼Œå°è¯•åˆ‡æ¢\n                if (retryCount < maxRetries) {\n                    this.showStatus('æ­£åœ¨åˆ‡æ¢å¤‡ç”¨API...', 'info');\n                    this.switchApi();\n                    return this.fetchNeteasePlaylist(link, retryCount + 1);\n                }\n                \n                this.showStatus(`æ­Œå•è§£æå¤±è´¥: ${error.message}`, 'error');\n                throw error;\n            }\n        },\n\n        async addPlaylist() {\n            const input = await this.mobilePrompt(\n                'è¯·è¾“å…¥æ­Œå•é“¾æ¥ï¼š\\næ”¯æŒæ ¼å¼ï¼š\\nâ€¢ music.163.com/playlist?id=xxx\\nâ€¢ y.music.163.com/m/playlist?id=xxx',\n                ''\n            );\n            \n            if (!input) return;\n            \n            if (!this.isPlaylistLink(input)) {\n                this.showStatus('è¿™ä¸æ˜¯æœ‰æ•ˆçš„æ­Œå•é“¾æ¥', 'error');\n                return;\n            }\n            \n            try {\n                const playlist = await this.fetchNeteasePlaylist(input);\n                \n                if (!playlist.tracks || playlist.tracks.length === 0) {\n                    this.showStatus('æ­Œå•ä¸ºç©ºæˆ–æ— æ³•è·å–æ­Œæ›²åˆ—è¡¨', 'error');\n                    return;\n                }\n                \n                // ä½¿ç”¨ç§»åŠ¨ç«¯å‹å¥½çš„ç¡®è®¤å¯¹è¯æ¡†\n                const confirmed = await this.mobileConfirm(\n                    `å‘ç°æ­Œå•: ${playlist.name}\\nåˆ›å»ºè€…: ${playlist.creator}\\nå…± ${playlist.tracks.length} é¦–æ­Œæ›²\\n\\næ˜¯å¦å…¨éƒ¨æ·»åŠ åˆ°æ’­æ”¾åˆ—è¡¨ï¼Ÿ`\n                );\n                \n                if (!confirmed) return;\n                \n                this.showStatus(`æ­£åœ¨å¯¼å…¥ ${playlist.tracks.length} é¦–æ­Œæ›²...`, 'info');\n                \n                let addedCount = 0;\n                let failedCount = 0;\n                \n                // åˆ†æ‰¹å¯¼å…¥ï¼Œé¿å…é˜»å¡\n                const batchSize = 5;\n                for (let i = 0; i < playlist.tracks.length; i += batchSize) {\n                    const batch = playlist.tracks.slice(i, Math.min(i + batchSize, playlist.tracks.length));\n                    \n                    const batchPromises = batch.map(async (track) => {\n                        try {\n                            const link = `music.163.com/song?id=${track.id}`;\n                            const songInfo = await this.fetchNeteaseSongInfo(link);\n                            \n                            this.playlist.push({\n                                title: track.name,\n                                artist: track.artists,\n                                url: songInfo.url,\n                                lyrics: songInfo.lyrics || '',\n                                cover: track.picUrl || songInfo.cover,\n                                isNetease: true\n                            });\n                            \n                            return { success: true };\n                        } catch (error) {\n                            console.error(`æ­Œæ›² ${track.name} å¯¼å…¥å¤±è´¥:`, error);\n                            return { success: false };\n                        }\n                    });\n                    \n                    const results = await Promise.all(batchPromises);\n                    \n                    results.forEach(result => {\n                        if (result.success) {\n                            addedCount++;\n                        } else {\n                            failedCount++;\n                        }\n                    });\n                    \n                    // æ›´æ–°è¿›åº¦æç¤º\n                    const processed = Math.min(i + batchSize, playlist.tracks.length);\n                    this.showStatus(`å·²å¯¼å…¥ ${processed}/${playlist.tracks.length} é¦–æ­Œæ›²`, 'info');\n                    \n                    // å°å»¶è¿Ÿé¿å…è¯·æ±‚è¿‡å¿«\n                    await new Promise(resolve => setTimeout(resolve, 500));\n                }\n                \n                // æ·»åŠ å¯¼å…¥å†å²\n                this.addImportHistory('playlist', {\n                    name: playlist.name,\n                    creator: playlist.creator,\n                    count: playlist.tracks.length,\n                    link: input\n                });\n                \n                this.saveData();\n                this.renderList();\n                \n                if (addedCount > 0) {\n                    this.showStatus(`æ­Œå•å¯¼å…¥å®Œæˆï¼æˆåŠŸ ${addedCount} é¦–ï¼Œå¤±è´¥ ${failedCount} é¦–`, 'success');\n                } else {\n                    this.showStatus('æ²¡æœ‰æ­Œæ›²æˆåŠŸå¯¼å…¥', 'error');\n                }\n                \n                if (this.index === -1 && this.playlist.length > 0) {\n                    this.play(0);\n                }\n                \n            } catch (error) {\n                console.error('æ­Œå•å¯¼å…¥å¤±è´¥:', error);\n            }\n        },\n\n        // ==================== æ¸²æŸ“å¯¼å…¥å†å² ====================\n        renderImportHistory() {\n            const container = targetDoc.getElementById('history-list');\n            if (!container) return;\n            \n            if (this.state.importHistory.length === 0) {\n                container.innerHTML = '<div class=\"no-history\">æš‚æ— å¯¼å…¥å†å²</div>';\n                return;\n            }\n            \n            let html = '';\n            this.state.importHistory.forEach((history, index) => {\n                const time = history.time;\n                \n                if (history.type === 'single') {\n                    html += `\n                        <div class=\"history-item\">\n                            <div class=\"history-icon\">ğŸµ</div>\n                            <div class=\"history-content\">\n                                <div class=\"history-title\">${history.data.title}</div>\n                                <div class=\"history-sub\">${history.data.artist}</div>\n                            </div>\n                            <div class=\"history-time\">${time}</div>\n                        </div>\n                    `;\n                } else if (history.type === 'playlist') {\n                    html += `\n                        <div class=\"history-item\">\n                            <div class=\"history-icon\">ğŸ“‹</div>\n                            <div class=\"history-content\">\n                                <div class=\"history-title\">${history.data.name}</div>\n                                <div class=\"history-sub\">${history.data.creator} â€¢ ${history.data.count} é¦–</div>\n                            </div>\n                            <div class=\"history-time\">${time}</div>\n                        </div>\n                    `;\n                } else if (history.type === 'local') {\n                    html += `\n                        <div class=\"history-item\">\n                            <div class=\"history-icon\">ğŸ“</div>\n                            <div class=\"history-content\">\n                                <div class=\"history-title\">${history.data.title}</div>\n                                <div class=\"history-sub\">æœ¬åœ°æ–‡ä»¶</div>\n                            </div>\n                            <div class=\"history-time\">${time}</div>\n                        </div>\n                    `;\n                }\n            });\n            \n            container.innerHTML = html;\n        },\n\n        // ==================== é”®ç›˜å¿«æ·é”®æ”¯æŒ ====================\n        bindKeyboardShortcuts() {\n            const handleKeyDown = (e) => {\n                // å¿½ç•¥åœ¨è¾“å…¥æ¡†ä¸­çš„æŒ‰é”®\n                if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {\n                    return;\n                }\n\n                // Alt + P: æ’­æ”¾/æš‚åœ\n                if (e.altKey && e.key.toLowerCase() === 'p') {\n                    e.preventDefault();\n                    this.toggle();\n                }\n                \n                // Alt + N: ä¸‹ä¸€é¦–\n                else if (e.altKey && e.key.toLowerCase() === 'n') {\n                    e.preventDefault();\n                    this.next();\n                }\n                \n                // Alt + B: ä¸Šä¸€é¦–\n                else if (e.altKey && e.key.toLowerCase() === 'b') {\n                    e.preventDefault();\n                    this.prev();\n                }\n                \n                // Alt + Space: æ’­æ”¾/æš‚åœï¼ˆå¤‡ç”¨å¿«æ·é”®ï¼‰\n                else if (e.altKey && e.code === 'Space') {\n                    e.preventDefault();\n                    this.toggle();\n                }\n                \n                // Alt + M: æœ€å°åŒ–/æœ€å¤§åŒ–\n                else if (e.altKey && e.key.toLowerCase() === 'm') {\n                    e.preventDefault();\n                    this.state.isMinimized = !this.state.isMinimized;\n                    this.updateView();\n                    this.saveData();\n                }\n                \n                // Alt + L: åˆ‡æ¢çº¯äº«æ¨¡å¼\n                else if (e.altKey && e.key.toLowerCase() === 'l') {\n                    e.preventDefault();\n                    this.togglePureMode();\n                }\n                \n                // Alt + ,: å‡å°éŸ³é‡\n                else if (e.altKey && e.key === ',') {\n                    e.preventDefault();\n                    this.audio.volume = Math.max(0, this.audio.volume - 0.1);\n                    this.showStatus(`éŸ³é‡: ${Math.round(this.audio.volume * 100)}%`, 'info', 1000);\n                }\n                \n                // Alt + .: å¢åŠ éŸ³é‡\n                else if (e.altKey && e.key === '.') {\n                    e.preventDefault();\n                    this.audio.volume = Math.min(1, this.audio.volume + 0.1);\n                    this.showStatus(`éŸ³é‡: ${Math.round(this.audio.volume * 100)}%`, 'info', 1000);\n                }\n                \n                // Alt + ?: æ˜¾ç¤ºå¿«æ·é”®å¸®åŠ©\n                else if (e.altKey && e.key === '?') {\n                    e.preventDefault();\n                    this.showKeyboardHelp();\n                }\n            };\n\n            targetDoc.addEventListener('keydown', handleKeyDown);\n            \n            // ä¿å­˜å¼•ç”¨ä»¥ä¾¿æ¸…ç†\n            this.keyboardHandler = handleKeyDown;\n        },\n\n        // æ˜¾ç¤ºå¿«æ·é”®å¸®åŠ©\n        showKeyboardHelp() {\n            const shortcuts = [\n                'Alt + P: æ’­æ”¾/æš‚åœ',\n                'Alt + N: ä¸‹ä¸€é¦–',\n                'Alt + B: ä¸Šä¸€é¦–',\n                'Alt + M: æœ€å°åŒ–/æœ€å¤§åŒ–',\n                'Alt + L: åˆ‡æ¢çº¯äº«æ¨¡å¼',\n                'Alt + ,: å‡å°éŸ³é‡',\n                'Alt + .: å¢åŠ éŸ³é‡',\n                'Alt + ?: æ˜¾ç¤ºå¸®åŠ©'\n            ];\n            \n            const message = 'é”®ç›˜å¿«æ·é”®:\\n' + shortcuts.join('\\n');\n            \n            if (this.state.isMobile) {\n                this.showStatus('å¿«æ·é”®ä»…é™æ¡Œé¢ç«¯ä½¿ç”¨', 'info', 3000);\n            } else {\n                alert(message);\n            }\n        },\n\n        // ==================== å…¶ä»–åŠŸèƒ½ ====================\n        updateLyrics() {\n            const lyricsEl = targetDoc.getElementById('ins-lyrics');\n            if (!lyricsEl) return;\n            \n            if (!this.state.lyrics.length) {\n                lyricsEl.innerText = 'â‹†â€¦â€¦ğ–¦¤â€¦â€¦â‹†';\n                return;\n            }\n            \n            const time = this.audio.currentTime;\n            let currentLine = '';\n            for (let i = 0; i < this.state.lyrics.length; i++) {\n                if (time >= this.state.lyrics[i].time) {\n                    currentLine = this.state.lyrics[i].text;\n                } else {\n                    break;\n                }\n            }\n            lyricsEl.innerText = currentLine || 'â‹†â€¦â€¦ğ–¦¤â€¦â€¦â‹†';\n            \n            if (this.state.isPureMode) {\n                this.updatePureLyrics();\n            }\n        },\n\n        async delSong(i) {\n            const confirmed = await this.mobileConfirm('ç¡®è®¤åˆ é™¤è¿™é¦–æ­Œæ›²å—ï¼Ÿ');\n            if (!confirmed) return;\n            \n            this.playlist.splice(i, 1);\n            this.saveData();\n            this.renderList();\n            \n            if (i === this.index) {\n                this.audio.pause();\n                this.index = -1;\n                this.updateView();\n            }\n        },\n\n        showLyricsDialog(i) {\n            const overlay = targetDoc.createElement('div');\n            overlay.className = 'lyrics-dialog-overlay';\n            overlay.innerHTML = `\n                <div class=\"lyrics-dialog\">\n                    <div class=\"lyrics-dialog-title\">æ­Œè¯è®¾ç½®</div>\n                    <div class=\"lyrics-dialog-btns\">\n                        <button id=\"lyrics-paste-btn\">ç²˜è´´æ­Œè¯</button>\n                        <button id=\"lyrics-import-btn\">å¯¼å…¥æ–‡ä»¶</button>\n                    </div>\n                    <button id=\"lyrics-cancel-btn\" class=\"lyrics-cancel\">å–æ¶ˆ</button>\n                </div>\n            `;\n            targetDoc.body.appendChild(overlay);\n\n            overlay.querySelector('#lyrics-paste-btn').onclick = () => {\n                overlay.remove();\n                const currentLyrics = this.playlist[i].lyrics || '';\n                this.mobilePrompt('ç²˜è´´LRCæ ¼å¼æ­Œè¯:', currentLyrics).then(newLyrics => {\n                    if (newLyrics !== null) {\n                        this.playlist[i].lyrics = newLyrics;\n                        if (i === this.index) {\n                            this.state.lyrics = this.parseLyrics(newLyrics);\n                            this.state.currentLyricIndex = -1;\n                        }\n                        this.saveData();\n                        this.showStatus('æ­Œè¯å·²æ›´æ–°', 'success');\n                    }\n                });\n            };\n\n            overlay.querySelector('#lyrics-import-btn').onclick = () => {\n                overlay.remove();\n                this.createFileInput('.lrc,.txt', (file) => {\n                    this.handleTextFileUpload(file, (content) => {\n                        this.playlist[i].lyrics = content;\n                        if (i === this.index) {\n                            this.state.lyrics = this.parseLyrics(content);\n                            this.state.currentLyricIndex = -1;\n                        }\n                        this.saveData();\n                        this.showStatus('æ­Œè¯å¯¼å…¥æˆåŠŸï¼', 'success');\n                    });\n                });\n            };\n\n            overlay.querySelector('#lyrics-cancel-btn').onclick = () => {\n                overlay.remove();\n            };\n\n            overlay.onclick = (e) => {\n                if (e.target === overlay) overlay.remove();\n            };\n        },\n\n        renderList() {\n            const list = targetDoc.getElementById('list-box');\n            if (!list) return;\n            \n            list.innerHTML = '';\n            this.playlist.forEach((t, i) => {\n                const item = targetDoc.createElement('div');\n                item.className = `item ${i === this.index ? 'active' : ''}`;\n                \n                // æ·»åŠ æ–‡ä»¶ç±»å‹å›¾æ ‡\n                let typeIcon = 'ğŸµ';\n                if (t.isLocal) typeIcon = 'ğŸ“';\n                else if (t.isDirectLink) typeIcon = 'ğŸ”—';\n                else if (t.isNetease) typeIcon = 'â˜ï¸';\n                \n                item.innerHTML = `\n                    <div class=\"item-type\">${typeIcon}</div>\n                    <div class=\"info\"><b>${t.title}</b><br><small>${t.artist}</small></div>\n                    <div class=\"item-btns\">\n                        <button class=\"btn-lyrics\">æ­Œè¯</button>\n                        <button class=\"del\">Ã—</button>\n                    </div>\n                `;\n                \n                item.querySelector('.info').onclick = () => this.play(i);\n                item.querySelector('.del').onclick = () => this.delSong(i);\n                item.querySelector('.btn-lyrics').onclick = () => this.showLyricsDialog(i);\n                \n                // ç§»åŠ¨ç«¯ä¼˜åŒ–ç‚¹å‡»åŒºåŸŸ\n                if (this.state.isMobile) {\n                    item.style.padding = '12px 0';\n                    item.querySelector('.info').style.cursor = 'pointer';\n                }\n                \n                list.appendChild(item);\n            });\n        },\n\n        // ==================== ç§»åŠ¨ç«¯ä¼˜åŒ–çš„äº‹ä»¶ç»‘å®š ====================\n        bindEvents() {\n            const root = targetDoc.getElementById('ins-v47-root');\n            const icon = targetDoc.getElementById('ins-v47-icon');\n            const island = targetDoc.getElementById('ins-island');\n            \n            if (!root || !icon || !island) {\n                console.error('UIå…ƒç´ æœªæ‰¾åˆ°');\n                return;\n            }\n\n            const leftZone = icon.querySelector('.icon-left-zone');\n            const rightZone = icon.querySelector('.icon-right-zone');\n\n            // æ’­æ”¾å™¨æ‹–æ‹½ï¼ˆç§»åŠ¨ç«¯ä¼˜åŒ–ï¼‰\n            const handlePlayerDrag = (e) => {\n                e.preventDefault();\n                e.stopPropagation();\n                \n                if (this.state.isMobile) {\n                    this.touchStartTime = Date.now();\n                    this.isDragging = false;\n                    \n                    // å¦‚æœæ˜¯è§¦æ‘¸äº‹ä»¶ï¼Œè®°å½•èµ·å§‹ä½ç½®\n                    if (e.touches) {\n                        this.lastTouchY = e.touches[0].clientY;\n                    }\n                }\n                \n                this.drag.active = true;\n                const startX = e.clientX || e.touches[0].clientX;\n                const startY = e.clientY || e.touches[0].clientY;\n                this.drag.offX = startX - root.offsetLeft;\n                this.drag.offY = startY - root.offsetTop;\n\n                const move = (ev) => {\n                    if (!this.drag.active) return;\n                    ev.preventDefault();\n                    \n                    if (this.state.isMobile) {\n                        this.isDragging = true;\n                        \n                        // æ£€æŸ¥æ˜¯å¦ä¸ºä¸Šä¸‹æ»‘åŠ¨ï¼ˆç§»åŠ¨ç«¯å¯èƒ½ç”¨äºå…¶ä»–æ“ä½œï¼‰\n                        if (ev.touches) {\n                            const currentY = ev.touches[0].clientY;\n                            const deltaY = Math.abs(currentY - this.lastTouchY);\n                            \n                            if (deltaY > 10) {\n                                // ä¸Šä¸‹æ»‘åŠ¨è¾ƒå¤§ï¼Œå¯èƒ½æ˜¯æ»šåŠ¨æ“ä½œï¼Œå–æ¶ˆæ‹–æ‹½\n                                this.drag.active = false;\n                                return;\n                            }\n                        }\n                    }\n                    \n                    const cx = ev.clientX || ev.touches[0].clientX;\n                    const cy = ev.clientY || ev.touches[0].clientY;\n                    const x = cx - this.drag.offX;\n                    const y = cy - this.drag.offY;\n                    \n                    // è¾¹ç•Œæ£€æŸ¥\n                    const maxX = window.innerWidth - root.offsetWidth;\n                    const maxY = window.innerHeight - root.offsetHeight;\n                    const boundedX = Math.max(0, Math.min(x, maxX));\n                    const boundedY = Math.max(0, Math.min(y, maxY));\n                    \n                    root.style.left = boundedX + 'px';\n                    root.style.top = boundedY + 'px';\n                    this.state.playerPos = { x: boundedX, y: boundedY };\n                };\n\n                const up = () => {\n                    if (this.state.isMobile && !this.isDragging && (Date.now() - this.touchStartTime < 300)) {\n                        // çŸ­æŒ‰æœªæ‹–æ‹½ï¼Œè§†ä¸ºç‚¹å‡»\n                        if (!this.state.panel) {\n                            this.togglePanel('list');\n                        }\n                    }\n                    \n                    this.drag.active = false;\n                    this.isDragging = false;\n                    this.saveData();\n                    \n                    targetDoc.removeEventListener('mousemove', move);\n                    targetDoc.removeEventListener('touchmove', move);\n                    targetDoc.removeEventListener('mouseup', up);\n                    targetDoc.removeEventListener('touchend', up);\n                    targetDoc.removeEventListener('touchcancel', up);\n                };\n\n                targetDoc.addEventListener('mousemove', move);\n                targetDoc.addEventListener('touchmove', move, { passive: false });\n                targetDoc.addEventListener('mouseup', up);\n                targetDoc.addEventListener('touchend', up);\n                targetDoc.addEventListener('touchcancel', up);\n            };\n\n            island.addEventListener('mousedown', handlePlayerDrag);\n            island.addEventListener('touchstart', handlePlayerDrag, { passive: false });\n\n            // å›¾æ ‡æ‹–æ‹½ï¼ˆç§»åŠ¨ç«¯ä¼˜åŒ–ï¼‰\n            if (leftZone) {\n                const handleIconDrag = (e) => {\n                    e.preventDefault();\n                    e.stopPropagation();\n                    \n                    if (this.state.isMobile) {\n                        this.touchStartTime = Date.now();\n                        this.isDragging = false;\n                    }\n                    \n                    this.drag.active = true;\n                    const startX = e.clientX || e.touches[0].clientX;\n                    const startY = e.clientY || e.touches[0].clientY;\n                    this.drag.offX = startX - icon.offsetLeft;\n                    this.drag.offY = startY - icon.offsetTop;\n\n                    const move = (ev) => {\n                        if (!this.drag.active) return;\n                        ev.preventDefault();\n                        \n                        if (this.state.isMobile) {\n                            this.isDragging = true;\n                        }\n                        \n                        const cx = ev.clientX || ev.touches[0].clientX;\n                        const cy = ev.clientY || ev.touches[0].clientY;\n                        const x = cx - this.drag.offX;\n                        const y = cy - this.drag.offY;\n                        \n                        // è¾¹ç•Œæ£€æŸ¥\n                        const maxX = window.innerWidth - icon.offsetWidth;\n                        const maxY = window.innerHeight - icon.offsetHeight;\n                        const boundedX = Math.max(0, Math.min(x, maxX));\n                        const boundedY = Math.max(0, Math.min(y, maxY));\n                        \n                        icon.style.left = boundedX + 'px';\n                        icon.style.top = boundedY + 'px';\n                        this.state.iconPos = { x: boundedX, y: boundedY };\n                    };\n\n                    const up = () => {\n                        this.drag.active = false;\n                        this.isDragging = false;\n                        this.saveData();\n                        \n                        targetDoc.removeEventListener('mousemove', move);\n                        targetDoc.removeEventListener('touchmove', move);\n                        targetDoc.removeEventListener('mouseup', up);\n                        targetDoc.removeEventListener('touchend', up);\n                        targetDoc.removeEventListener('touchcancel', up);\n                    };\n\n                    targetDoc.addEventListener('mousemove', move);\n                    targetDoc.addEventListener('touchmove', move, { passive: false });\n                    targetDoc.addEventListener('mouseup', up);\n                    targetDoc.addEventListener('touchend', up);\n                    targetDoc.addEventListener('touchcancel', up);\n                };\n\n                leftZone.addEventListener('mousedown', handleIconDrag);\n                leftZone.addEventListener('touchstart', handleIconDrag, { passive: false });\n            }\n\n            // å³ä¾§åŒºåŸŸï¼šåŒå‡»å±•å¼€ï¼ˆç§»åŠ¨ç«¯ä¼˜åŒ–ï¼‰\n            if (rightZone) {\n                let lastClickTime = 0;\n                const handleRightClick = (e) => {\n                    e.preventDefault();\n                    e.stopPropagation();\n                    \n                    if (this.state.isMobile) {\n                        // ç§»åŠ¨ç«¯ä½¿ç”¨å•å‡»å±•å¼€\n                        this.state.isMinimized = false;\n                        this.updateView();\n                        this.saveData();\n                    } else {\n                        // æ¡Œé¢ç«¯ä¿æŒåŒå‡»é€»è¾‘\n                        const now = Date.now();\n                        if (now - lastClickTime < 300) {\n                            this.state.isMinimized = false;\n                            this.updateView();\n                            this.saveData();\n                            lastClickTime = 0;\n                        } else {\n                            lastClickTime = now;\n                        }\n                    }\n                };\n\n                rightZone.addEventListener('click', handleRightClick);\n                rightZone.addEventListener('touchend', (e) => {\n                    e.preventDefault();\n                    handleRightClick(e);\n                });\n            }\n\n            // é€šç”¨ç‚¹å‡»äº‹ä»¶ç»‘å®š\n            const click = (id, fn) => {\n                const el = targetDoc.getElementById(id);\n                if (el) {\n                    // ç§»é™¤æ—§çš„äº‹ä»¶ç›‘å¬å™¨\n                    el.onclick = null;\n                    el.onclick = (e) => { \n                        e.stopPropagation(); \n                        fn(e); \n                    };\n                    \n                    // ç§»åŠ¨ç«¯æ·»åŠ è§¦æ‘¸åé¦ˆ\n                    if (this.state.isMobile) {\n                        el.style.cursor = 'pointer';\n                        el.style.webkitTapHighlightColor = 'transparent';\n                    }\n                }\n            };\n\n            // ç»‘å®šæ‰€æœ‰æŒ‰é’®ç‚¹å‡»äº‹ä»¶\n            click('btn-min', () => { \n                this.state.isMinimized = true; \n                this.updateView(); \n                this.saveData(); \n            });\n            click('btn-play', () => this.toggle());\n            click('btn-next', () => this.next());\n            click('btn-prev', () => this.prev());\n            click('btn-mode', () => { \n                this.state.playMode = (this.state.playMode + 1) % 3; \n                this.updateView(); \n                this.saveData(); \n            });\n            click('btn-set', () => this.togglePanel('set'));\n            click('btn-list', () => this.togglePanel('list'));\n            click('btn-history', () => this.togglePanel('history'));\n            click('btn-add', () => this.showAddOptions());\n            click('btn-pure', () => this.togglePureMode());\n            click('ins-pure-mode', () => this.togglePureMode());\n\n            // èƒŒæ™¯å›¾ç‰‡ä¸Šä¼ ä¼˜åŒ–ï¼ˆä¿®å¤å›¾ç‰‡æ”¾å¤§é—®é¢˜ï¼‰\n            click('btn-cover-upload', () => {\n                this.createFileInput('image/*', async (file) => {\n                    this.handleFileUpload(file, async (dataUrl) => {\n                        // ä¼˜åŒ–å›¾ç‰‡ï¼ˆä¸æ”¾å¤§ï¼‰\n                        const optimizedUrl = await this.optimizeBackgroundImage(dataUrl);\n                        this.state.cfg.cover = optimizedUrl;\n                        this.updateView();\n                        this.saveData();\n                        this.showStatus('å°é¢å·²æ›´æ–°', 'success');\n                    });\n                });\n            });\n\n            click('btn-expanded-upload', () => {\n                this.createFileInput('image/*', async (file) => {\n                    this.handleFileUpload(file, async (dataUrl) => {\n                        // ä¼˜åŒ–å›¾ç‰‡ï¼ˆä¸æ”¾å¤§ï¼‰\n                        const optimizedUrl = await this.optimizeBackgroundImage(dataUrl);\n                        this.state.cfg.expandedBg = this.createBackgroundUrl(optimizedUrl);\n                        this.updateView();\n                        this.saveData();\n                        this.showStatus('å…¨å±èƒŒæ™¯å·²æ›´æ–°', 'success');\n                    });\n                });\n            });\n\n            click('btn-collapsed-upload', () => {\n                this.createFileInput('image/*', async (file) => {\n                    this.handleFileUpload(file, async (dataUrl) => {\n                        // ä¼˜åŒ–å›¾ç‰‡ï¼ˆä¸æ”¾å¤§ï¼‰\n                        const optimizedUrl = await this.optimizeBackgroundImage(dataUrl);\n                        this.state.cfg.collapsedBg = this.createBackgroundUrl(optimizedUrl);\n                        this.updateView();\n                        this.saveData();\n                        this.showStatus('çª„å±èƒŒæ™¯å·²æ›´æ–°', 'success');\n                    });\n                });\n            });\n\n            // èƒŒæ™¯é¢œè‰²è¾“å…¥ï¼ˆä¿®å¤ç£¨ç ‚ç»ç’ƒé—®é¢˜ï¼‰\n            const bgColorChange = (id, key) => {\n                const el = targetDoc.getElementById(id);\n                if (el) {\n                    el.oninput = (e) => {\n                        this.state.cfg[key] = e.target.value;\n                        this.updateView();\n                    };\n                    el.onchange = () => {\n                        this.saveData();\n                        this.showStatus('èƒŒæ™¯é¢œè‰²å·²ä¿å­˜', 'success');\n                    };\n                }\n            };\n\n            bgColorChange('inp-expanded-col', 'expandedBg');\n            bgColorChange('inp-collapsed-col', 'collapsedBg');\n\n            // å…¶ä»–é¢œè‰²è®¾ç½®\n            const change = (id, fn) => {\n                const el = targetDoc.getElementById(id);\n                if (el) {\n                    el.onchange = (e) => { \n                        fn(e.target.value); \n                        this.saveData();\n                        this.showStatus('è®¾ç½®å·²ä¿å­˜', 'success');\n                    };\n                }\n            };\n\n            change('inp-theme', v => { this.state.cfg.themeColor = v; this.updateView(); });\n            change('inp-border', v => { this.state.cfg.borderColor = v; this.updateView(); });\n            change('inp-rgb', v => { this.state.cfg.rgbColor = v; this.updateView(); });\n            change('inp-lyrics-start', v => { this.state.cfg.lyricsGradientStart = v; this.updateView(); });\n            change('inp-lyrics-end', v => { this.state.cfg.lyricsGradientEnd = v; this.updateView(); });\n\n            // RGBæ¨¡å¼é€‰é¡¹\n            targetDoc.querySelectorAll('.rgb-opt').forEach(opt => {\n                opt.onclick = () => {\n                    this.state.rgbMode = parseInt(opt.dataset.val);\n                    this.updateView();\n                    this.saveData();\n                    this.showStatus('RGBæ¨¡å¼å·²æ›´æ–°', 'success');\n                };\n            });\n\n            // ç£¨ç ‚ç»ç’ƒå¼€å…³ï¼ˆå·²ä¿®å¤èƒŒæ™¯é¢œè‰²é—®é¢˜ï¼‰\n            const glassSwitch = targetDoc.getElementById('sw-glass');\n            if (glassSwitch) {\n                glassSwitch.onchange = (e) => { \n                    this.state.glass = e.target.checked;\n                    this.updateView();\n                    this.saveData();\n                    this.showStatus(`ç£¨ç ‚ç»ç’ƒ ${e.target.checked ? 'å¼€å¯' : 'å…³é—­'}`, 'success');\n                };\n            }\n\n            // ç£¨ç ‚ç»ç’ƒé€æ˜åº¦æ»‘å—\n            const glassOpacityInput = targetDoc.getElementById('inp-glass-opacity');\n            if (glassOpacityInput) {\n                glassOpacityInput.oninput = (e) => {\n                    this.state.glassOpacity = parseInt(e.target.value) / 100;\n                    this.updateView();\n                };\n                glassOpacityInput.onchange = () => {\n                    this.saveData();\n                    this.showStatus(`é€æ˜åº¦å·²è®¾ç½®ä¸º ${Math.round(this.state.glassOpacity * 100)}%`, 'success');\n                };\n            }\n\n            // æ’­æ”¾é€Ÿåº¦\n            const speedInput = targetDoc.getElementById('inp-speed');\n            if (speedInput) {\n                speedInput.oninput = (e) => {\n                    this.state.speed = parseFloat(e.target.value); \n                    this.audio.playbackRate = this.state.speed;\n                    this.updateView();\n                };\n                speedInput.onchange = () => {\n                    this.saveData();\n                    this.showStatus(`æ’­æ”¾é€Ÿåº¦: ${this.state.speed}x`, 'success');\n                };\n            }\n\n            // å…¶ä»–æ»‘å—æ§åˆ¶\n            const sliderControls = [\n                { id: 'inp-width', cfgKey: 'borderWidth', suffix: 'px', message: 'è¾¹æ¡†å®½åº¦' },\n                { id: 'inp-width-player', cfgKey: 'playerWidth', suffix: 'px', message: 'æ’­æ”¾å™¨å®½åº¦' },\n                { id: 'inp-height-player', cfgKey: 'playerHeight', suffix: 'px', message: 'æ’­æ”¾å™¨é«˜åº¦' },\n                { id: 'inp-cover-w', cfgKey: 'coverWidth', suffix: 'px', message: 'å°é¢å®½åº¦' },\n                { id: 'inp-cover-h', cfgKey: 'coverHeight', suffix: 'px', message: 'å°é¢é«˜åº¦' }\n            ];\n\n            sliderControls.forEach(control => {\n                const input = targetDoc.getElementById(control.id);\n                if (input) {\n                    input.oninput = (e) => {\n                        this.state.cfg[control.cfgKey] = e.target.value + control.suffix;\n                        this.updateView();\n                    };\n                    input.onchange = () => {\n                        this.saveData();\n                        this.showStatus(`${control.message}å·²æ›´æ–°`, 'success');\n                    };\n                }\n            });\n\n            // è¿›åº¦æ¡æ§åˆ¶\n            const progInput = targetDoc.getElementById('inp-prog');\n            if (progInput) {\n                progInput.oninput = (e) => {\n                    if(this.audio.duration) {\n                        this.audio.currentTime = (e.target.value/100)*this.audio.duration;\n                    }\n                };\n            }\n\n            // éŸ³é¢‘äº‹ä»¶\n            this.audio.onplay = () => {\n                this.state.isPlaying = true;\n                const playBtn = targetDoc.getElementById('btn-play');\n                if (playBtn) playBtn.innerText = 'âšâš';\n                this.updateView();\n            };\n            \n            this.audio.onpause = () => {\n                this.state.isPlaying = false;\n                const playBtn = targetDoc.getElementById('btn-play');\n                if (playBtn) playBtn.innerText = 'â–¶';\n                this.updateView();\n            };\n            \n            this.audio.onended = () => this.next();\n            \n            this.audio.ontimeupdate = () => {\n                if (this.audio.duration) {\n                    const progInput = targetDoc.getElementById('inp-prog');\n                    if (progInput) {\n                        progInput.value = (this.audio.currentTime / this.audio.duration) * 100;\n                    }\n                }\n                this.updateLyrics();\n            };\n            \n            // éŸ³é¢‘é”™è¯¯å¤„ç†\n            this.audio.onerror = (e) => {\n                console.error('éŸ³é¢‘æ’­æ”¾é”™è¯¯:', e);\n                this.showStatus('éŸ³é¢‘æ’­æ”¾å¤±è´¥ï¼Œè¯·æ£€æŸ¥é“¾æ¥', 'error');\n                this.state.isPlaying = false;\n                this.updateView();\n            };\n\n            // çª—å£å¤§å°å˜åŒ–æ—¶é‡æ–°è°ƒæ•´ä½ç½®\n            window.addEventListener('resize', () => {\n                this.updateView();\n            });\n\n            // ç§»åŠ¨ç«¯è§¦æ‘¸äº‹ä»¶ä¼˜åŒ–\n            if (this.state.isMobile) {\n                // é˜²æ­¢è§¦æ‘¸æ—¶ç¼©æ”¾\n                targetDoc.addEventListener('touchmove', (e) => {\n                    if (this.drag.active) {\n                        e.preventDefault();\n                    }\n                }, { passive: false });\n\n                // é•¿æŒ‰æç¤º\n                island.addEventListener('touchstart', (e) => {\n                    this.longPressTimer = setTimeout(() => {\n                        this.showStatus('æ‹–æ‹½å¯ç§»åŠ¨æ’­æ”¾å™¨', 'info', 2000);\n                    }, 1000);\n                });\n\n                island.addEventListener('touchend', () => {\n                    clearTimeout(this.longPressTimer);\n                });\n\n                island.addEventListener('touchcancel', () => {\n                    clearTimeout(this.longPressTimer);\n                });\n            }\n        },\n\n        createUI() {\n            // åˆ›å»ºçŠ¶æ€æç¤ºå…ƒç´ \n            const statusEl = targetDoc.createElement('div');\n            statusEl.id = 'ins-status';\n            statusEl.style.cssText = `\n                position: fixed;\n                top: ${this.state.isMobile ? '60px' : '20px'};\n                left: 50%;\n                transform: translateX(-50%);\n                background: #00d2ff;\n                color: white;\n                padding: ${this.state.isMobile ? '8px 16px' : '10px 20px'};\n                border-radius: 20px;\n                z-index: 2147483648;\n                font-size: ${this.state.isMobile ? '12px' : '14px'};\n                opacity: 0;\n                transition: opacity 0.3s;\n                pointer-events: none;\n                box-shadow: 0 5px 15px rgba(0,0,0,0.3);\n                white-space: nowrap;\n                max-width: 80vw;\n                overflow: hidden;\n                text-overflow: ellipsis;\n            `;\n            targetDoc.body.appendChild(statusEl);\n\n            // åˆ›å»ºå›¾æ ‡\n            const icon = targetDoc.createElement('div');\n            icon.id = 'ins-v47-icon';\n            \n            let bars = '';\n            const totalBars = this.state.isMobile ? 40 : 60;\n            for(let i = 0; i < totalBars; i++) {\n                const pos = i / totalBars;\n                const isEdge = pos < 0.15 || pos > 0.85;\n                \n                let h, s;\n                if (isEdge) {\n                    h = Math.random() * 8 + 2;\n                    s = Math.random() * 2 + 1.5;\n                } else {\n                    h = Math.random() * 30 + 5;\n                    s = Math.random() * 0.5 + 0.3;\n                }\n                const d = Math.random() * 0.8;\n                bars += `<div class=\"v-bar ${isEdge ? 'edge-bar' : ''}\" style=\"--h:${h}px; --d:${d}s; --s:${s}s\"></div>`;\n            }\n            \n            icon.innerHTML = `\n                <div class=\"icon-left-zone\">\n                    <div class=\"zone-hint\">${this.state.isMobile ? 'æ‹–æ‹½' : 'æ‹–æ‹½'}</div>\n                </div>\n                <div class=\"wave-box\">${bars}</div>\n                <div class=\"base-line\"></div>\n                <div class=\"icon-right-zone\">\n                    <div class=\"zone-hint\">${this.state.isMobile ? 'ç‚¹å‡»å±•å¼€' : 'åŒå‡»å±•å¼€'}</div>\n                </div>\n            `;\n            \n            // ç§»åŠ¨ç«¯è°ƒæ•´å›¾æ ‡å¤§å°\n            if (this.state.isMobile) {\n                icon.style.width = '250px';\n                icon.style.height = '45px';\n                icon.querySelector('.wave-box').style.height = '30px';\n            }\n            \n            targetDoc.body.appendChild(icon);\n\n            // åˆ›å»ºæ’­æ”¾å™¨ä¸»ç•Œé¢\n            const root = targetDoc.createElement('div');\n            root.id = 'ins-v47-root';\n            \n            // ç§»åŠ¨ç«¯è°ƒæ•´å¸ƒå±€\n            const coverSize = this.state.isMobile ? '70px' : '80px';\n            const mainPadding = this.state.isMobile ? '20px 10px 15px' : '30px 15px 15px';\n            \n            root.innerHTML = `\n                <div id=\"root-rgb\" class=\"rgb-layer\"></div>\n                <div id=\"ins-island\"></div>\n                <div id=\"root-inner\" class=\"inner-content\">\n                    <div id=\"ins-main-content\">\n                        <div class=\"main\">\n                            <div id=\"ins-cover\" style=\"width: ${coverSize}; height: ${coverSize};\"></div>\n                            <div class=\"center\">\n                                <div class=\"meta\">\n                                    <div id=\"ins-t\">Ins Player</div>\n                                    <div id=\"ins-a\">Ready</div>\n                                </div>\n                                <div id=\"ins-lyrics\">â‹†â€¦â€¦ğ–¦¤â€¦â€¦â‹†</div>\n                                <div class=\"prog-wrap\">\n                                    <input type=\"range\" id=\"inp-prog\" value=\"0\" min=\"0\" max=\"100\">\n                                </div>\n                                <div class=\"ctrls\">\n                                    <button id=\"btn-mode\"></button>\n                                    <button id=\"btn-prev\">â®</button>\n                                    <button id=\"btn-play\">â–¶</button>\n                                    <button id=\"btn-next\">â­</button>\n                                    <button id=\"btn-list\">â˜°</button>\n                                </div>\n                            </div>\n                            <div class=\"right\">\n                                <button id=\"btn-min\" title=\"æœ€å°åŒ–\">ğ“†</button>\n                                <button id=\"btn-set\" title=\"è®¾ç½®\">â™¡</button>\n                                <button id=\"btn-history\" title=\"å†å²è®°å½•\">ğŸ“œ</button>\n                                <button id=\"btn-pure\" title=\"çº¯äº«æ¨¡å¼\">ğ“†Ÿ</button>\n                            </div>\n                        </div>\n                        \n                        <div id=\"panel-set\" class=\"panel\">\n                            <div class=\"section-title\">æ’­æ”¾è®¾ç½®</div>\n                            <div class=\"row\">\n                                <span>å€é€Ÿ <b id=\"val-speed\">1.0x</b></span>\n                                <input id=\"inp-speed\" type=\"range\" min=\"0.5\" max=\"2.0\" step=\"0.1\">\n                            </div>\n                            \n                            <div class=\"section-title\">èƒŒæ™¯è®¾ç½®</div>\n                            <div class=\"row\">\n                                <span>å…¨å±èƒŒæ™¯</span>\n                                <div class=\"bg-ctrl\">\n                                    <input id=\"inp-expanded-col\" type=\"color\">\n                                    <button id=\"btn-expanded-upload\" class=\"upload-btn\">ä¸Šä¼ </button>\n                                </div>\n                            </div>\n                            <div class=\"row\">\n                                <span>çª„å±èƒŒæ™¯</span>\n                                <div class=\"bg-ctrl\">\n                                    <input id=\"inp-collapsed-col\" type=\"color\">\n                                    <button id=\"btn-collapsed-upload\" class=\"upload-btn\">ä¸Šä¼ </button>\n                                </div>\n                            </div>\n                            \n                            <div class=\"section-title\">å°é¢è®¾ç½®</div>\n                            <div class=\"row\">\n                                <span>å°é¢å›¾ç‰‡</span>\n                                <button id=\"btn-cover-upload\" class=\"upload-btn\">ä¸Šä¼ </button>\n                            </div>\n                            <div class=\"row\">\n                                <span>å°é¢å®½åº¦ <b id=\"val-cover-w\">${this.state.isMobile ? '70px' : '80px'}</b></span>\n                                <input id=\"inp-cover-w\" type=\"range\" min=\"40\" max=\"150\" step=\"5\" value=\"${this.state.isMobile ? '70' : '80'}\">\n                            </div>\n                            <div class=\"row\">\n                                <span>å°é¢é«˜åº¦ <b id=\"val-cover-h\">${this.state.isMobile ? '70px' : '80px'}</b></span>\n                                <input id=\"inp-cover-h\" type=\"range\" min=\"40\" max=\"150\" step=\"5\" value=\"${this.state.isMobile ? '70' : '80'}\">\n                            </div>\n                            \n                            <div class=\"section-title\">RGB æ¨¡å¼</div>\n                            <div class=\"row\">\n                                <span>ç¯å…‰æ¨¡å¼</span>\n                                <div class=\"opt-group\">\n                                    <div class=\"rgb-opt\" data-val=\"0\">å…³</div>\n                                    <div class=\"rgb-opt\" data-val=\"1\">å•è‰²</div>\n                                    <div class=\"rgb-opt\" data-val=\"2\">å¹»å½©</div>\n                                </div>\n                            </div>\n                            <div class=\"row\">\n                                <span>å•è‰²é¢œè‰²</span>\n                                <input id=\"inp-rgb\" type=\"color\">\n                            </div>\n                            \n                            <div class=\"section-title\">æ­Œè¯æ¸å˜è‰²</div>\n                            <div class=\"row col-2\">\n                                <label>èµ·å§‹è‰² <input id=\"inp-lyrics-start\" type=\"color\"></label>\n                                <label>ç»“æŸè‰² <input id=\"inp-lyrics-end\" type=\"color\"></label>\n                            </div>\n                            \n                            <div class=\"section-title\">é¢œè‰²è®¾ç½®</div>\n                            <div class=\"row col-2\">\n                                <label>å­—ä½“é¢œè‰² <input id=\"inp-theme\" type=\"color\"></label>\n                                <label>è¾¹æ¡†è‰² <input id=\"inp-border\" type=\"color\"></label>\n                            </div>\n                            \n                            <div class=\"section-title\">ç£¨ç ‚ç»ç’ƒè®¾ç½®</div>\n                            <div class=\"row\">\n                                <span>å¯ç”¨ç£¨ç ‚æ•ˆæœ</span>\n                                <input id=\"sw-glass\" type=\"checkbox\" checked>\n                            </div>\n                            <div class=\"row\">\n                                <span>é€æ˜åº¦ <b id=\"val-glass-opacity\">60%</b></span>\n                                <input id=\"inp-glass-opacity\" type=\"range\" min=\"10\" max=\"90\" value=\"60\">\n                            </div>\n                            \n                            <div class=\"section-title\">å°ºå¯¸è°ƒæ•´</div>\n                            <div class=\"row\">\n                                <span>æ’­æ”¾å™¨å®½åº¦ <b id=\"val-width-player\">${this.state.isMobile ? '90vw' : '400px'}</b></span>\n                                <input id=\"inp-width-player\" type=\"range\" min=\"200\" max=\"600\" step=\"10\" value=\"${this.state.isMobile ? '90' : '400'}\">\n                            </div>\n                            <div class=\"row\">\n                                <span>æ’­æ”¾å™¨é«˜åº¦ <b id=\"val-height-player\">${this.state.isMobile ? '180px' : '160px'}</b></span>\n                                <input id=\"inp-height-player\" type=\"range\" min=\"120\" max=\"300\" step=\"5\" value=\"${this.state.isMobile ? '180' : '160'}\">\n                            </div>\n                            <div class=\"row\">\n                                <span>è¾¹æ¡†å®½åº¦ <b id=\"val-width\">6px</b></span>\n                                <input id=\"inp-width\" type=\"range\" min=\"1\" max=\"20\" step=\"1\">\n                            </div>\n                        </div>\n\n                        <div id=\"panel-list\" class=\"panel\">\n                            <div id=\"list-box\"></div>\n                            <button id=\"btn-add\" class=\"add-btn\">+ æ·»åŠ æ­Œæ›²</button>\n                        </div>\n                        \n                        <div id=\"panel-history\" class=\"panel\">\n                            <div class=\"section-title\">å¯¼å…¥å†å²</div>\n                            <div id=\"history-list\" class=\"history-list\"></div>\n                        </div>\n                    </div>\n                    \n                    <div id=\"ins-pure-mode\">\n                        <div id=\"pure-lyrics-container\"></div>\n                    </div>\n                </div>\n            `;\n            \n            // è®¾ç½®ä¸»åŒºåŸŸæ ·å¼\n            const mainDiv = root.querySelector('.main');\n            if (mainDiv) {\n                mainDiv.style.padding = mainPadding;\n            }\n            \n            // ç§»åŠ¨ç«¯è°ƒæ•´æ§ä»¶å¤§å°\n            if (this.state.isMobile) {\n                const buttons = root.querySelectorAll('button');\n                buttons.forEach(btn => {\n                    if (!btn.className.includes('upload-btn') && !btn.className.includes('add-btn')) {\n                        btn.style.padding = '8px';\n                        btn.style.fontSize = '16px';\n                    }\n                });\n                \n                const rightButtons = root.querySelector('.right');\n                if (rightButtons) {\n                    rightButtons.style.height = '120px';\n                }\n            }\n            \n            targetDoc.body.appendChild(root);\n        },\n\n        injectCSS() {\n            const css = `\n                @keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.3} }\n                @keyframes color-cycle {\n                    0% { background-color: #ff0000; } \n                    14% { background-color: #ff7f00; } \n                    28% { background-color: #ffff00; } \n                    42% { background-color: #00ff00; } \n                    57% { background-color: #00ffff; } \n                    71% { background-color: #0000ff; } \n                    85% { background-color: #8b00ff; } \n                    100% { background-color: #ff0000; }\n                }\n                @keyframes wave { 0%, 100% { height: 2px; } 50% { height: var(--h); } }\n\n                /* çŠ¶æ€æç¤º */\n                #ins-status.status-info { background: #00d2ff; }\n                #ins-status.status-success { background: #00cc66; }\n                #ins-status.status-error { background: #ff4444; }\n\n                /* ç§»åŠ¨ç«¯å¯¹è¯æ¡† */\n                .mobile-confirm-overlay,\n                .mobile-prompt-overlay {\n                    position: fixed;\n                    top: 0;\n                    left: 0;\n                    right: 0;\n                    bottom: 0;\n                    background: rgba(0,0,0,0.6);\n                    display: flex;\n                    justify-content: center;\n                    align-items: center;\n                    z-index: 2147483649;\n                    padding: 20px;\n                }\n\n                .mobile-confirm-dialog,\n                .mobile-prompt-dialog {\n                    background: #2a2a2a;\n                    border-radius: 16px;\n                    padding: 25px;\n                    width: 100%;\n                    max-width: 300px;\n                    text-align: center;\n                    color: #fff;\n                    box-shadow: 0 15px 35px rgba(0,0,0,0.5);\n                }\n\n                .mobile-confirm-message {\n                    font-size: 16px;\n                    margin-bottom: 20px;\n                    line-height: 1.4;\n                    text-align: left;\n                    white-space: pre-line;\n                }\n\n                .mobile-prompt-title {\n                    font-size: 16px;\n                    margin-bottom: 15px;\n                    line-height: 1.4;\n                    text-align: left;\n                    white-space: pre-line;\n                }\n\n                #mobile-prompt-input {\n                    width: 100%;\n                    padding: 12px;\n                    margin-bottom: 20px;\n                    background: rgba(255,255,255,0.1);\n                    border: 1px solid rgba(255,255,255,0.2);\n                    border-radius: 8px;\n                    color: #fff;\n                    font-size: 16px;\n                    box-sizing: border-box;\n                }\n\n                .mobile-confirm-buttons,\n                .mobile-prompt-buttons {\n                    display: flex;\n                    gap: 10px;\n                }\n\n                .mobile-confirm-buttons button,\n                .mobile-prompt-buttons button {\n                    flex: 1;\n                    padding: 12px;\n                    border: none;\n                    border-radius: 8px;\n                    cursor: pointer;\n                    font-size: 16px;\n                    transition: all 0.2s;\n                }\n\n                .mobile-confirm-buttons .primary,\n                .mobile-prompt-buttons .primary {\n                    background: #00d2ff;\n                    color: #000;\n                }\n\n                .mobile-confirm-buttons button:not(.primary),\n                .mobile-prompt-buttons button:not(.primary) {\n                    background: rgba(255,255,255,0.1);\n                    color: #fff;\n                }\n\n                /* æ·»åŠ é€‰é¡¹å¯¹è¯æ¡† */\n                .add-options-dialog {\n                    background: #2a2a2a;\n                    border-radius: 16px;\n                    padding: 25px;\n                    min-width: 250px;\n                    max-width: 90vw;\n                    text-align: center;\n                    color: #fff;\n                    box-shadow: 0 15px 35px rgba(0,0,0,0.5);\n                }\n\n                .add-options-btns {\n                    display: flex;\n                    flex-direction: column;\n                    gap: 15px;\n                    margin: 20px 0;\n                }\n\n                .add-options-btns button {\n                    background: rgba(255,255,255,0.1);\n                    border: 2px solid rgba(255,255,255,0.2);\n                    border-radius: 12px;\n                    padding: 20px;\n                    cursor: pointer;\n                    transition: all 0.3s;\n                    display: flex;\n                    flex-direction: column;\n                    align-items: center;\n                    justify-content: center;\n                    gap: 10px;\n                }\n\n                .add-options-btns button:hover {\n                    background: rgba(255,255,255,0.2);\n                    transform: translateY(-2px);\n                    border-color: rgba(255,255,255,0.3);\n                }\n\n                .link-options-info {\n                    background: rgba(0,0,0,0.3);\n                    border-radius: 8px;\n                    padding: 12px;\n                    margin: 15px 0;\n                    font-size: 12px;\n                    text-align: left;\n                    line-height: 1.4;\n                    white-space: pre-line;\n                }\n\n                .option-icon {\n                    font-size: 32px;\n                    line-height: 1;\n                }\n\n                .option-text {\n                    font-size: 16px;\n                    font-weight: bold;\n                }\n\n                /* å¯¼å…¥å†å² */\n                .history-list {\n                    max-height: 300px;\n                    overflow-y: auto;\n                }\n\n                .history-list::-webkit-scrollbar {\n                    width: 4px;\n                }\n\n                .history-list::-webkit-scrollbar-thumb {\n                    background: rgba(255,255,255,0.3);\n                    border-radius: 2px;\n                }\n\n                .history-item {\n                    display: flex;\n                    align-items: center;\n                    padding: 12px 0;\n                    border-bottom: 1px solid rgba(255,255,255,0.1);\n                    gap: 12px;\n                }\n\n                .history-icon {\n                    font-size: 20px;\n                    width: 40px;\n                    height: 40px;\n                    display: flex;\n                    align-items: center;\n                    justify-content: center;\n                    background: rgba(255,255,255,0.1);\n                    border-radius: 10px;\n                    flex-shrink: 0;\n                }\n\n                .history-content {\n                    flex: 1;\n                    overflow: hidden;\n                    min-width: 0;\n                }\n\n                .history-title {\n                    font-weight: bold;\n                    font-size: 13px;\n                    margin-bottom: 3px;\n                    white-space: nowrap;\n                    overflow: hidden;\n                    text-overflow: ellipsis;\n                }\n\n                .history-sub {\n                    font-size: 11px;\n                    opacity: 0.7;\n                    white-space: nowrap;\n                    overflow: hidden;\n                    text-overflow: ellipsis;\n                }\n\n                .history-time {\n                    font-size: 10px;\n                    opacity: 0.5;\n                    white-space: nowrap;\n                    flex-shrink: 0;\n                }\n\n                .no-history {\n                    text-align: center;\n                    padding: 40px 0;\n                    opacity: 0.5;\n                    font-size: 13px;\n                }\n\n                /* ä¿®å¤ç£¨ç ‚ç»ç’ƒæ•ˆæœ - å…³é”®ä¿®å¤ */\n                #root-inner.glass-mode {\n                    backdrop-filter: blur(20px) saturate(180%);\n                    -webkit-backdrop-filter: blur(20px) saturate(180%);\n                    position: relative;\n                }\n\n                /* ä½¿ç”¨ä¼ªå…ƒç´ å®ç°èƒŒæ™¯è¦†ç›–ï¼Œè§£å†³é¢œè‰²å†²çª */\n                #root-inner.glass-mode::before {\n                    content: '';\n                    position: absolute;\n                    top: 0;\n                    left: 0;\n                    right: 0;\n                    bottom: 0;\n                    background: var(--glass-bg-color, rgba(26, 26, 26, 0.6));\n                    z-index: 0;\n                    border-radius: 24px;\n                }\n\n                /* ç¡®ä¿å†…å®¹åœ¨ç£¨ç ‚å±‚ä¸Šæ–¹ */\n                #root-inner.glass-mode > * {\n                    position: relative;\n                    z-index: 1;\n                }\n\n                /* å›¾ç‰‡èƒŒæ™¯çš„ç‰¹æ®Šå¤„ç† */\n                #root-inner.glass-mode[style*=\"url(\"]::before {\n                    background: var(--glass-overlay, rgba(0,0,0,0.3));\n                    mix-blend-mode: overlay;\n                }\n\n                /* æ’­æ”¾å™¨åŸºç¡€æ ·å¼ */\n                #ins-v47-icon {\n                    position: fixed; \n                    z-index: 2147483647;\n                    width: 300px; \n                    height: 50px;\n                    display: none; \n                    flex-direction: column;\n                    align-items: center; \n                    justify-content: flex-end;\n                    pointer-events: auto !important;\n                    --rgb-single: #00d2ff;\n                    background: transparent;\n                    touch-action: none;\n                }\n\n                .icon-left-zone,\n                .icon-right-zone {\n                    position: absolute;\n                    top: 0;\n                    width: 50%;\n                    height: 100%;\n                    display: flex;\n                    align-items: center;\n                    justify-content: center;\n                    z-index: 10;\n                }\n                \n                .icon-left-zone {\n                    left: 0;\n                    cursor: grab;\n                }\n                .icon-left-zone:active {\n                    cursor: grabbing;\n                }\n                \n                .icon-right-zone {\n                    right: 0;\n                    cursor: pointer;\n                }\n\n                .zone-hint {\n                    font-size: 10px;\n                    color: rgba(0,0,0,0.3);\n                    opacity: 0;\n                    transition: opacity 0.3s;\n                    pointer-events: none;\n                }\n                \n                .icon-left-zone:hover .zone-hint,\n                .icon-right-zone:hover .zone-hint {\n                    opacity: 1;\n                }\n                \n                .wave-box { \n                    display: flex; \n                    align-items: flex-end; \n                    gap: 2px; \n                    height: 35px; \n                    width: 100%; \n                    justify-content: center;\n                    padding: 0 10px;\n                    box-sizing: border-box;\n                }\n                \n                .v-bar { \n                    width: 3px; \n                    height: 2px; \n                    background: #000; \n                    border-radius: 1px; \n                    transition: background 0.3s; \n                }\n                \n                .v-bar.edge-bar {\n                    width: 2px;\n                    opacity: 0.6;\n                }\n                \n                .base-line { \n                    width: 100%; \n                    height: 2px; \n                    background: #000; \n                    margin-top: 1px; \n                }\n\n                #ins-v47-icon.playing .v-bar { \n                    animation: wave var(--s) infinite ease-in-out alternate; \n                    animation-delay: var(--d); \n                }\n                \n                #ins-v47-icon.rgb-single .v-bar, \n                #ins-v47-icon.rgb-single .base-line { \n                    background: var(--rgb-single); \n                    box-shadow: 0 0 5px var(--rgb-single); \n                }\n                \n                #ins-v47-icon.rgb-rainbow .v-bar, \n                #ins-v47-icon.rgb-rainbow .base-line { \n                    animation: color-cycle 4s infinite linear; \n                }\n                \n                #ins-v47-icon.rgb-rainbow.playing .v-bar { \n                    animation: wave var(--s) infinite ease-in-out alternate, color-cycle 4s infinite linear; \n                    animation-delay: var(--d), 0s; \n                }\n\n                #ins-v47-root {\n                    position: fixed; \n                    z-index: 2147483647;\n                    width: 400px;\n                    height: var(--player-h, 160px);\n                    border-radius: 30px; \n                    display: none; \n                    flex-direction: column;\n                    font-family: sans-serif; \n                    box-shadow: 0 20px 50px rgba(0,0,0,0.5);\n                    transition: height 0.3s, width 0.3s; \n                    pointer-events: auto !important;\n                    --rgb-single: #00d2ff; \n                    --border-w: 6px;\n                    --lyrics-start: #00d2ff; \n                    --lyrics-end: #ff00ff;\n                    touch-action: none;\n                }\n                \n                /* ç§»åŠ¨ç«¯æ ·å¼ */\n                @media (max-width: 768px) {\n                    #ins-v47-root {\n                        width: 90vw !important;\n                        height: 180px !important;\n                        border-radius: 20px;\n                    }\n                    \n                    #ins-v47-icon {\n                        width: 250px;\n                        height: 45px;\n                    }\n                    \n                    .wave-box {\n                        height: 30px;\n                    }\n                    \n                    .main {\n                        padding: 20px 10px 15px !important;\n                    }\n                    \n                    #ins-cover {\n                        width: 70px !important;\n                        height: 70px !important;\n                        margin-right: 10px !important;\n                    }\n                    \n                    .right {\n                        height: 120px !important;\n                    }\n                    \n                    .right button {\n                        padding: 8px !important;\n                        font-size: 18px !important;\n                    }\n                    \n                    #btn-play {\n                        font-size: 24px !important;\n                        width: 30px !important;\n                        height: 30px !important;\n                    }\n                    \n                    .ctrls button {\n                        font-size: 20px !important;\n                        padding: 5px !important;\n                    }\n                    \n                    .item {\n                        padding: 12px 0 !important;\n                    }\n                    \n                    .item-type {\n                        font-size: 16px;\n                        margin-right: 8px;\n                    }\n                    \n                    .info {\n                        font-size: 13px !important;\n                    }\n                    \n                    .info small {\n                        font-size: 11px !important;\n                    }\n                    \n                    .panel {\n                        padding: 10px !important;\n                    }\n                    \n                    .row {\n                        font-size: 13px !important;\n                        padding: 8px 0 !important;\n                    }\n                    \n                    input[type=range] {\n                        width: 80px !important;\n                    }\n                }\n\n                #ins-v47-root.expanded { height: 520px !important; }\n                @media (max-width: 768px) {\n                    #ins-v47-root.expanded { height: 70vh !important; }\n                }\n\n                #root-rgb { \n                    position: absolute; \n                    inset: 0; \n                    border-radius: 30px; \n                    z-index: 0; \n                    -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);\n                    -webkit-mask-composite: xor;\n                    mask-composite: exclude;\n                    padding: var(--border-w);\n                }\n                #root-rgb.mode-single { \n                    background: var(--rgb-single) !important; \n                    animation: blink 2s infinite; \n                }\n                #root-rgb.mode-rainbow { \n                    animation: color-cycle 4s infinite linear, blink 2s infinite; \n                }\n\n                #root-inner {\n                    position: absolute; \n                    top: var(--border-w); \n                    left: var(--border-w); \n                    right: var(--border-w); \n                    bottom: var(--border-w);\n                    border-radius: 24px; \n                    z-index: 1; \n                    overflow: hidden;\n                    background: #1a1a1a;\n                    transition: background 0.3s;\n                }\n                @media (max-width: 768px) {\n                    #root-inner {\n                        border-radius: 18px;\n                    }\n                }\n\n                #ins-island { \n                    width: 70px; \n                    height: 18px; \n                    background: #000; \n                    margin: 0 auto; \n                    border-radius: 0 0 10px 10px; \n                    cursor: move; \n                    position: absolute; \n                    left: 50%; \n                    transform: translateX(-50%); \n                    z-index: 20; \n                    top: 0; \n                }\n                @media (max-width: 768px) {\n                    #ins-island { \n                        width: 50px;\n                        height: 12px;\n                    }\n                }\n                \n                .main { \n                    display: flex; \n                    height: 100%; \n                    padding: 30px 15px 15px; \n                    box-sizing: border-box; \n                    align-items: center; \n                    position: relative; \n                    z-index: 3; \n                }\n                \n                #ins-cover { \n                    width: 80px; \n                    height: 80px; \n                    border-radius: 12px; \n                    margin-right: 15px; \n                    background-size: cover; \n                    background-position: center; \n                    background-repeat: no-repeat;\n                    background-color: rgba(0,0,0,0.2);\n                    transition: width 0.3s, height 0.3s;\n                    flex-shrink: 0;\n                }\n                \n                .center { \n                    flex: 1; \n                    display: flex; \n                    flex-direction: column; \n                    justify-content: center; \n                    overflow: hidden; \n                    min-width: 0;\n                }\n                \n                .meta { \n                    white-space: nowrap; \n                    overflow: hidden; \n                    margin-bottom: 5px; \n                }\n                #ins-t { font-weight: bold; font-size: 16px; }\n                #ins-a { font-size: 12px; opacity: 0.7; }\n                @media (max-width: 768px) {\n                    #ins-t { font-size: 14px; }\n                    #ins-a { font-size: 11px; }\n                }\n                \n                #ins-lyrics { \n                    font-size: 12px; \n                    opacity: 0.8; \n                    height: 16px; \n                    overflow: hidden; \n                    text-align: center; \n                    margin: 5px 0;\n                }\n                @media (max-width: 768px) {\n                    #ins-lyrics { font-size: 11px; height: 14px; }\n                }\n                \n                .prog-wrap { \n                    width: 100%; \n                    height: 6px; \n                    background: rgba(255,255,255,0.1); \n                    border-radius: 3px; \n                    position: relative; \n                    margin: 5px 0; \n                }\n                #inp-prog { \n                    width: 100%; \n                    height: 100%; \n                    -webkit-appearance: none; \n                    background: transparent; \n                    margin: 0; \n                    cursor: pointer;\n                }\n                #inp-prog::-webkit-slider-thumb { \n                    -webkit-appearance: none; \n                    width: 12px; \n                    height: 12px; \n                    background: var(--rgb-single); \n                    border-radius: 50%; \n                    box-shadow: 0 0 5px rgba(0,0,0,0.5); \n                    margin-top: -3px;\n                }\n                \n                .ctrls { \n                    display: flex; \n                    justify-content: space-between; \n                    align-items: center; \n                    padding-top: 10px; \n                }\n                .ctrls button { \n                    background: none; \n                    border: none; \n                    color: inherit; \n                    cursor: pointer; \n                    display: flex; \n                    align-items: center; \n                    padding: 5px;\n                    font-size: 18px;\n                }\n                #btn-play { \n                    font-size: 22px; \n                    width: 26px; \n                    height: 26px; \n                    justify-content: center; \n                }\n                #btn-prev, #btn-next { font-size: 18px; }\n                #btn-mode { font-size: 18px; opacity: 0.8; }\n                #btn-list { font-size: 18px; opacity: 0.8; }\n\n                .right { \n                    display: flex; \n                    flex-direction: column; \n                    justify-content: space-between; \n                    height: 100px; \n                    margin-left: 12px; \n                    flex-shrink: 0;\n                }\n                .right button { \n                    background: none; \n                    border: none; \n                    font-size: 22px; \n                    cursor: pointer; \n                    opacity: 0.7; \n                    color: inherit; \n                    padding: 5px;\n                    transition: opacity 0.2s;\n                }\n                .right button:hover { opacity: 1; }\n                \n                #ins-pure-mode { \n                    display: none; \n                    width: 100%; \n                    height: 100%; \n                    justify-content: center; \n                    align-items: center; \n                    padding: 40px 30px; \n                    box-sizing: border-box;\n                    overflow: hidden; \n                    cursor: pointer;\n                }\n                #ins-v47-root.pure-mode #ins-main-content { display: none; }\n                #ins-v47-root.pure-mode #ins-pure-mode { display: flex; }\n\n                #pure-lyrics-container {\n                    width: 100%;\n                    display: flex;\n                    flex-direction: column;\n                    align-items: center;\n                    gap: 12px;\n                }\n\n                .pure-lyric-line {\n                    font-size: 14px;\n                    opacity: 0.4;\n                    transition: all 0.3s;\n                    text-align: center;\n                    line-height: 1.5;\n                }\n\n                .pure-lyric-line.active {\n                    font-size: 22px;\n                    font-weight: bold;\n                    opacity: 1;\n                    background: linear-gradient(90deg, \n                        var(--lyrics-start) var(--progress, 0%), \n                        var(--lyrics-end) var(--progress, 0%), \n                        rgba(255,255,255,0.6) var(--progress, 0%));\n                    -webkit-background-clip: text;\n                    -webkit-text-fill-color: transparent;\n                    background-clip: text;\n                }\n                @media (max-width: 768px) {\n                    .pure-lyric-line {\n                        font-size: 13px;\n                    }\n                    .pure-lyric-line.active {\n                        font-size: 18px;\n                    }\n                }\n\n                .pure-lyric-line.no-lyrics {\n                    font-size: 16px;\n                    opacity: 0.6;\n                    background: none;\n                    -webkit-text-fill-color: inherit;\n                }\n\n                .pure-lyric-line.passed { opacity: 0.25; }\n\n                .panel { \n                    flex: 1; \n                    display: none; \n                    flex-direction: column; \n                    padding: 15px; \n                    overflow-y: auto; \n                    position: relative; \n                    z-index: 3; \n                    max-height: 360px;\n                    background: transparent;\n                }\n                @media (max-width: 768px) {\n                    .panel {\n                        max-height: 50vh;\n                        padding: 10px;\n                    }\n                }\n                \n                .section-title {\n                    font-weight: bold;\n                    font-size: 13px;\n                    margin: 12px 0 8px 0;\n                    padding-bottom: 5px;\n                    border-bottom: 1px solid rgba(255,255,255,0.15);\n                    position: relative;\n                }\n                .section-title:first-child { margin-top: 0; }\n                \n                .row { \n                    display: flex; \n                    justify-content: space-between; \n                    margin-bottom: 10px; \n                    font-size: 12px; \n                    align-items: center;\n                    padding: 6px 0;\n                    border-bottom: 1px solid rgba(255,255,255,0.08);\n                    position: relative;\n                }\n                \n                .row.col-2 { gap: 10px; }\n                .row.col-2 label { \n                    flex: 1; \n                    display: flex; \n                    justify-content: space-between; \n                    align-items: center; \n                    font-size: 12px; \n                }\n                \n                .bg-ctrl { display: flex; gap: 5px; align-items: center; }\n                \n                .upload-btn, .add-btn {\n                    padding: 5px 10px;\n                    background: rgba(255,255,255,0.1);\n                    border: 1px solid rgba(255,255,255,0.2);\n                    color: #fff;\n                    border-radius: 5px;\n                    cursor: pointer;\n                    font-size: 11px;\n                    transition: all 0.2s;\n                }\n                .upload-btn:hover, .add-btn:hover {\n                    background: rgba(255,255,255,0.2);\n                }\n                \n                .opt-group { \n                    display: flex; \n                    gap: 4px; \n                    background: rgba(0,0,0,0.3); \n                    padding: 2px; \n                    border-radius: 5px; \n                }\n                .rgb-opt { \n                    padding: 4px 8px; \n                    cursor: pointer; \n                    border-radius: 4px; \n                    font-size: 11px; \n                    transition: all 0.2s; \n                }\n                .rgb-opt.active { \n                    background: #fff; \n                    color: #000; \n                    font-weight: bold; \n                }\n\n                input[type=color] { \n                    width: 28px; \n                    height: 28px; \n                    border: none; \n                    background: none; \n                    cursor: pointer; \n                    border-radius: 4px; \n                }\n                input[type=range] { \n                    width: 100px; \n                    cursor: pointer;\n                }\n                @media (max-width: 768px) {\n                    input[type=range] {\n                        width: 80px;\n                    }\n                }\n                \n                input[type=checkbox] { \n                    width: 16px; \n                    height: 16px; \n                    cursor: pointer; \n                }\n                \n                .item { \n                    display: flex; \n                    justify-content: space-between; \n                    padding: 10px 0; \n                    border-bottom: 1px solid rgba(255,255,255,0.1); \n                    align-items: center;\n                }\n                \n                .item.active { color: var(--rgb-single); font-weight: bold; }\n                .item-type {\n                    font-size: 14px;\n                    margin-right: 10px;\n                    opacity: 0.7;\n                }\n                .item .info { \n                    flex: 1; \n                    cursor: pointer; \n                    font-size: 13px; \n                    min-width: 0;\n                }\n                .item .info small {\n                    font-size: 11px;\n                    opacity: 0.7;\n                }\n                .item-btns { \n                    display: flex; \n                    gap: 8px; \n                    align-items: center; \n                    flex-shrink: 0;\n                }\n                .item-btns button { \n                    padding: 3px 8px; \n                    font-size: 11px; \n                }\n                .btn-lyrics { \n                    background: rgba(255,255,255,0.1); \n                    border: 1px solid rgba(255,255,255,0.2); \n                    color: #fff; \n                    border-radius: 4px; \n                    cursor: pointer; \n                }\n                .del { \n                    background: none; \n                    border: none; \n                    color: #f55; \n                    cursor: pointer; \n                    font-size: 18px; \n                }\n                \n                .add-btn { \n                    width: 100%; \n                    padding: 12px; \n                    background: var(--rgb-single); \n                    border: none; \n                    cursor: pointer; \n                    font-weight: bold; \n                    border-radius: 8px; \n                    color: #000; \n                    margin-top: 10px; \n                    font-size: 13px;\n                }\n\n                #list-box { max-height: 280px; overflow-y: auto; }\n                #list-box::-webkit-scrollbar { width: 4px; }\n                #list-box::-webkit-scrollbar-thumb { \n                    background: rgba(255,255,255,0.3); \n                    border-radius: 2px; \n                }\n\n                .panel::-webkit-scrollbar { width: 4px; }\n                .panel::-webkit-scrollbar-thumb { \n                    background: rgba(255,255,255,0.3); \n                    border-radius: 2px; \n                }\n\n                /* æ­Œè¯å¯¹è¯æ¡† */\n                .lyrics-dialog-overlay {\n                    position: fixed;\n                    top: 0;\n                    left: 0;\n                    right: 0;\n                    bottom: 0;\n                    background: rgba(0,0,0,0.6);\n                    display: flex;\n                    justify-content: center;\n                    align-items: center;\n                    z-index: 2147483648;\n                    padding: 20px;\n                }\n\n                .lyrics-dialog {\n                    background: #2a2a2a;\n                    border-radius: 12px;\n                    padding: 20px;\n                    min-width: 200px;\n                    max-width: 90vw;\n                    text-align: center;\n                    color: #fff;\n                    box-shadow: 0 10px 30px rgba(0,0,0,0.5);\n                }\n\n                .lyrics-dialog-title {\n                    font-size: 16px;\n                    font-weight: bold;\n                    margin-bottom: 15px;\n                }\n\n                .lyrics-dialog-btns {\n                    display: flex;\n                    flex-direction: column;\n                    gap: 10px;\n                    margin-bottom: 15px;\n                }\n\n                .lyrics-dialog-btns button {\n                    padding: 12px 20px;\n                    border: none;\n                    border-radius: 8px;\n                    cursor: pointer;\n                    font-size: 14px;\n                    transition: all 0.2s;\n                }\n\n                #lyrics-paste-btn {\n                    background: #00d2ff;\n                    color: #000;\n                }\n\n                #lyrics-import-btn {\n                    background: #ff6b9d;\n                    color: #000;\n                }\n\n                .lyrics-dialog-btns button:hover {\n                    transform: scale(1.02);\n                    opacity: 0.9;\n                }\n\n                .lyrics-cancel {\n                    background: transparent;\n                    border: 1px solid rgba(255,255,255,0.3) !important;\n                    color: #fff;\n                    padding: 8px 20px;\n                    border-radius: 6px;\n                    cursor: pointer;\n                    font-size: 12px;\n                }\n\n                .lyrics-cancel:hover {\n                    background: rgba(255,255,255,0.1);\n                }\n            `;\n            \n            const style = targetDoc.createElement('style');\n            style.textContent = css;\n            targetDoc.head.appendChild(style);\n        }\n    };\n\n    // åˆå§‹åŒ–åº”ç”¨\n    App.init();\n\n})();",
  "info": "",
  "button": {
    "enabled": true,
    "buttons": []
  },
  "data": {}
}