{
  "type": "script",
  "enabled": true,
  "name": "hy-æ’­æ”¾å™¨3.0",
  "id": "0416f2ed-3881-4244-b88f-861329b754b8",
  "content": "/*\n    name: ğŸµ Insé£æ’­æ”¾å™¨ (V46.5 å¢å¼ºç‰ˆ)\n    author: Enhanced Version\n    version: 46.5\n    description: æ”¯æŒç½‘æ˜“äº‘å…¨é“¾æ¥+æ­Œå•å¯¼å…¥+ç£¨ç ‚ç»ç’ƒå¢å¼º\n    id: ins-player-v46-enhanced\n    enable: true\n    context: ['chat']\n    on: ['load']\n*/\n\n(function() {\n    'use strict';\n\n    let targetDoc = document;\n    try {\n        if (window.parent && window.parent.document) {\n            targetDoc = window.parent.document;\n        }\n    } catch (e) {}\n\n    const clean = () => {\n        const old = targetDoc.getElementById('ins-v46-root');\n        const oldIcon = targetDoc.getElementById('ins-v46-icon');\n        if (old) old.remove();\n        if (oldIcon) oldIcon.remove();\n    };\n    clean();\n\n    const defaultConfig = {\n        cover: 'https://images.unsplash.com/photo-1493225255756-d9584f8606e9?q=80&w=500',\n        coverWidth: 80,\n        coverHeight: 80,\n        \n        expandedBg: '#1a1a1a',\n        collapsedBg: '#1a1a1a',\n        \n        vinylBg: '',\n        borderColor: '#333333',\n        borderWidth: '6px',\n        themeColor: '#ffffff',\n        rgbColor: '#00d2ff',\n        glassAlpha: 0.6,\n        playerWidth: '400px',\n        playerHeight: '160px',\n        \n        // çº¯äº«æ¨¡å¼è®¾ç½®\n        pureModeSize: '400',\n        pureModeBg: '#1a1a1a',\n        pureModeSignature: '',\n        \n        // åˆ é™¤æ­Œè¯æ¸å˜è®¾ç½®\n        pos: { x: 20, y: 100 }\n    };\n\n    const App = {\n        playlist: [],\n        index: -1,\n        audio: new Audio(),\n        state: {\n            playMode: 0,\n            rgbMode: 0,\n            glass: true,\n            glassOpacity: 0.6,\n            speed: 1.0,\n            panel: false,\n            isMinimized: false,\n            isPlaying: false,\n            isPureMode: false,\n            lyrics: [],\n            currentLyricIndex: -1,\n            cfg: { ...defaultConfig },\n            playerPos: { x: 20, y: 100 },\n            iconPos: { x: 20, y: 300 },\n            importHistory: [],\n            wordLyricsProgress: 0 // é€å­—æ­Œè¯è¿›åº¦\n        },\n        drag: { active: false, offX: 0, offY: 0 },\n        doubleClickTimer: null,\n        clickCount: 0,\n        audioVisualizer: null,\n        resizeTimer: null,\n\n        init() {\n            this.injectCSS();\n            this.createUI();\n            this.loadData();\n            this.bindEvents();\n            this.initResponsive();\n            console.log('ğŸµ V46.5 å¢å¼ºç‰ˆå¯åŠ¨');\n        },\n\n        // å“åº”å¼åˆå§‹åŒ–\n        initResponsive() {\n            this.centerPlayer();\n            window.addEventListener('resize', () => {\n                clearTimeout(this.resizeTimer);\n                this.resizeTimer = setTimeout(() => this.centerPlayer(), 100);\n            });\n        },\n\n        // å±…ä¸­æ’­æ”¾å™¨\n        centerPlayer() {\n            const root = targetDoc.getElementById('ins-v46-root');\n            const icon = targetDoc.getElementById('ins-v46-icon');\n            \n            if (root && !this.drag.active) {\n                const width = parseInt(this.state.cfg.playerWidth);\n                root.style.left = (window.innerWidth - width) / 2 + 'px';\n                root.style.top = (window.innerHeight - parseInt(this.state.cfg.playerHeight)) / 2 + 'px';\n                this.state.playerPos = { \n                    x: (window.innerWidth - width) / 2, \n                    y: (window.innerHeight - parseInt(this.state.cfg.playerHeight)) / 2 \n                };\n            }\n            \n            if (icon && !this.drag.active) {\n                icon.style.left = (window.innerWidth - 300) / 2 + 'px';\n                icon.style.top = window.innerHeight - 100 + 'px';\n                this.state.iconPos = { \n                    x: (window.innerWidth - 300) / 2, \n                    y: window.innerHeight - 100 \n                };\n            }\n            \n            this.saveData();\n        },\n\n        loadData() {\n            const raw = localStorage.getItem('ins_v46_data');\n            if (raw) {\n                const data = JSON.parse(raw);\n                this.playlist = data.playlist || [];\n                if (data.state) {\n                    this.state = { ...this.state, ...data.state };\n                    this.state.cfg = { ...defaultConfig, ...data.state.cfg };\n                    \n                    const checkPos = (pos, def) => {\n                        if (pos.x > window.innerWidth - 50) pos.x = def.x;\n                        if (pos.y > window.innerHeight - 50) pos.y = def.y;\n                    };\n                    checkPos(this.state.playerPos, defaultConfig.pos);\n                    checkPos(this.state.iconPos, { x: 20, y: 300 });\n                }\n            }\n            this.state.panel = false;\n            this.updateView();\n            this.renderList();\n        },\n\n        saveData() {\n            localStorage.setItem('ins_v46_data', JSON.stringify({\n                playlist: this.playlist,\n                state: this.state\n            }));\n        },\n\n        // æ˜¾ç¤ºçŠ¶æ€æç¤º\n        showStatus(message, type = 'info', duration = 3000) {\n            const statusEl = targetDoc.getElementById('ins-status');\n            if (statusEl) {\n                statusEl.textContent = message;\n                statusEl.className = `status-${type}`;\n                statusEl.style.opacity = '1';\n                \n                clearTimeout(this.statusTimer);\n                this.statusTimer = setTimeout(() => {\n                    statusEl.style.opacity = '0';\n                }, duration);\n            } else {\n                const tempStatus = targetDoc.createElement('div');\n                tempStatus.textContent = message;\n                tempStatus.style.cssText = `\n                    position: fixed;\n                    top: 20px;\n                    left: 50%;\n                    transform: translateX(-50%);\n                    background: ${type === 'error' ? '#ff4444' : '#00d2ff'};\n                    color: white;\n                    padding: 10px 20px;\n                    border-radius: 20px;\n                    z-index: 2147483648;\n                    font-size: 14px;\n                    box-shadow: 0 5px 15px rgba(0,0,0,0.3);\n                    transition: opacity 0.3s;\n                `;\n                targetDoc.body.appendChild(tempStatus);\n                \n                setTimeout(() => {\n                    tempStatus.style.opacity = '0';\n                    setTimeout(() => tempStatus.remove(), 300);\n                }, duration);\n            }\n        },\n\n        addImportHistory(type, data) {\n            const history = {\n                type: type,\n                data: data,\n                time: new Date().toLocaleTimeString()\n            };\n            this.state.importHistory.unshift(history);\n            if (this.state.importHistory.length > 10) {\n                this.state.importHistory.pop();\n            }\n            this.saveData();\n        },\n\n        handleFileUpload(file, callback) {\n            const reader = new FileReader();\n            reader.onload = (e) => callback(e.target.result);\n            reader.readAsDataURL(file);\n        },\n\n        handleTextFileUpload(file, callback) {\n            const reader = new FileReader();\n            reader.onload = (e) => callback(e.target.result);\n            reader.readAsText(file);\n        },\n\n        createFileInput(accept, callback) {\n            const input = targetDoc.createElement('input');\n            input.type = 'file';\n            input.accept = accept;\n            input.style.display = 'none';\n            input.onchange = (e) => {\n                if (e.target.files[0]) callback(e.target.files[0]);\n                input.remove();\n            };\n            targetDoc.body.appendChild(input);\n            input.click();\n        },\n\n        updateView() {\n            const root = targetDoc.getElementById('ins-v46-root');\n            const rootRgb = targetDoc.getElementById('root-rgb');\n            const inner = targetDoc.getElementById('root-inner');\n            const icon = targetDoc.getElementById('ins-v46-icon');\n            const cfg = this.state.cfg;\n\n            root.style.left = this.state.playerPos.x + 'px';\n            root.style.top = this.state.playerPos.y + 'px';\n            icon.style.left = this.state.iconPos.x + 'px';\n            icon.style.top = this.state.iconPos.y + 'px';\n\n            root.style.setProperty('--border-w', cfg.borderWidth);\n            root.style.setProperty('--rgb-single', cfg.rgbColor);\n            root.style.setProperty('--player-h', cfg.playerHeight);\n            root.style.color = cfg.themeColor;\n            root.style.width = cfg.playerWidth;\n            icon.style.setProperty('--rgb-single', cfg.rgbColor);\n\n            // ä¿®å¤ç£¨ç ‚ç»ç’ƒèƒŒæ™¯é—®é¢˜\n            let currentBg = this.state.panel ? cfg.expandedBg : cfg.collapsedBg;\n\n            if (this.state.glass) {\n                inner.classList.add('glass-mode');\n                // å¤„ç†çº¯è‰²èƒŒæ™¯\n                if (currentBg.startsWith('#')) {\n                    const hex = currentBg;\n                    let r=0, g=0, b=0;\n                    if(hex.length === 4){\n                        r=parseInt(hex[1]+hex[1],16);\n                        g=parseInt(hex[2]+hex[2],16);\n                        b=parseInt(hex[3]+hex[3],16);\n                    }else if(hex.length === 7){\n                        r=parseInt(hex.slice(1,3),16);\n                        g=parseInt(hex.slice(3,5),16);\n                        b=parseInt(hex.slice(5,7),16);\n                    }\n                    inner.style.background = `rgba(${r},${g},${b},${this.state.glassOpacity})`;\n                    inner.style.setProperty('--glass-bg-r', r);\n                    inner.style.setProperty('--glass-bg-g', g);\n                    inner.style.setProperty('--glass-bg-b', b);\n                } else if (currentBg.startsWith('url')) {\n                    // å›¾ç‰‡èƒŒæ™¯ä½¿ç”¨å åŠ å±‚\n                    inner.style.background = `${currentBg}`;\n                    inner.style.position = 'relative';\n                    \n                    // æ·»åŠ é€æ˜åº¦è¦†ç›–å±‚\n                    let overlay = inner.querySelector('.glass-overlay');\n                    if (!overlay) {\n                        overlay = targetDoc.createElement('div');\n                        overlay.className = 'glass-overlay';\n                        inner.appendChild(overlay);\n                    }\n                    overlay.style.cssText = `\n                        position: absolute;\n                        top: 0;\n                        left: 0;\n                        right: 0;\n                        bottom: 0;\n                        background: rgba(0,0,0,${1 - this.state.glassOpacity});\n                        backdrop-filter: blur(20px) saturate(180%);\n                        -webkit-backdrop-filter: blur(20px) saturate(180%);\n                        z-index: 1;\n                        pointer-events: none;\n                    `;\n                } else {\n                    inner.style.background = currentBg;\n                }\n                inner.style.setProperty('--glass-opacity', this.state.glassOpacity);\n            } else {\n                inner.classList.remove('glass-mode');\n                inner.style.background = currentBg;\n                inner.style.backdropFilter = 'none';\n                const overlay = inner.querySelector('.glass-overlay');\n                if (overlay) overlay.remove();\n            }\n\n            const coverEl = targetDoc.getElementById('ins-cover');\n            coverEl.style.backgroundImage = `url(\"${cfg.cover}\")`;\n            coverEl.style.width = cfg.coverWidth + 'px';\n            coverEl.style.height = cfg.coverHeight + 'px';\n\n            rootRgb.className = 'rgb-layer';\n            rootRgb.style.background = cfg.borderColor;\n            \n            const mode = this.state.rgbMode;\n            if (mode === 1) rootRgb.classList.add('mode-single');\n            else if (mode === 2) rootRgb.classList.add('mode-rainbow');\n\n            icon.className = '';\n            if (this.state.isPlaying) icon.classList.add('playing');\n            if (mode === 1) icon.classList.add('rgb-single');\n            if (mode === 2) icon.classList.add('rgb-rainbow');\n\n            if (this.state.isMinimized) {\n                root.style.display = 'none';\n                icon.style.display = 'flex';\n            } else {\n                icon.style.display = 'none';\n                root.style.display = 'flex';\n            }\n\n            root.classList.toggle('pure-mode', this.state.isPureMode);\n            this.updatePureMode();\n\n            const modeBtn = targetDoc.getElementById('btn-mode');\n            const svgs = [\n                '<svg viewBox=\"0 0 24 24\" width=\"16\" height=\"16\" stroke=\"currentColor\" stroke-width=\"2\" fill=\"none\"><path d=\"M17 1l4 4-4 4\"/><path d=\"M3 11V9a4 4 0 0 1 4-4h14\"/><path d=\"M7 23l-4-4 4-4\"/><path d=\"M21 13v2a4 4 0 0 1-4 4H3\"/></svg>',\n                '<svg viewBox=\"0 0 24 24\" width=\"16\" height=\"16\" stroke=\"currentColor\" stroke-width=\"2\" fill=\"none\"><path d=\"M17 1l4 4-4 4\"/><path d=\"M3 11V9a4 4 0 0 1 4-4h14\"/><path d=\"M7 23l-4-4 4-4\"/><path d=\"M21 13v2a4 4 0 0 1-4 4H3\"/><text x=\"10\" y=\"17\" font-size=\"8\" stroke=\"none\" fill=\"currentColor\">1</text></svg>',\n                '<svg viewBox=\"0 0 24 24\" width=\"16\" height=\"16\" stroke=\"currentColor\" stroke-width=\"2\" fill=\"none\"><path d=\"M16 3h5v5\"/><path d=\"M4 20L21 3\"/><path d=\"M21 16v5h-5\"/><path d=\"M15 15l6 6\"/><path d=\"M4 4l5 5\"/></svg>'\n            ];\n            modeBtn.innerHTML = svgs[this.state.playMode];\n\n            const t = this.playlist[this.index];\n            targetDoc.getElementById('ins-t').innerText = t ? t.title : 'ç‚¹å‡»ä¸‹æ–¹æ·»åŠ æ­Œæ›²';\n            targetDoc.getElementById('ins-a').innerText = t ? t.artist : 'ç­‰å¾…æ’­æ”¾';\n\n            this.updateSettingsPanel();\n            this.updateAudioVisualizer();\n        },\n\n        // æ›´æ–°çº¯äº«æ¨¡å¼\n        updatePureMode() {\n            const pureContainer = targetDoc.getElementById('ins-pure-mode');\n            const cfg = this.state.cfg;\n            \n            if (pureContainer) {\n                // è®¾ç½®çº¯äº«æ¨¡å¼å°ºå¯¸\n                pureContainer.style.width = cfg.pureModeSize + 'px';\n                pureContainer.style.height = cfg.pureModeSize + 'px';\n                \n                // è®¾ç½®çº¯äº«æ¨¡å¼èƒŒæ™¯\n                if (cfg.pureModeBg.startsWith('url')) {\n                    pureContainer.style.backgroundImage = cfg.pureModeBg;\n                    pureContainer.style.backgroundSize = 'cover';\n                    pureContainer.style.backgroundColor = 'transparent';\n                } else {\n                    pureContainer.style.background = cfg.pureModeBg;\n                    pureContainer.style.backgroundImage = 'none';\n                }\n                \n                // æ›´æ–°ç­¾å\n                const signatureEl = targetDoc.getElementById('pure-signature');\n                if (signatureEl) {\n                    signatureEl.innerText = cfg.pureModeSignature || '';\n                    signatureEl.style.display = cfg.pureModeSignature.trim() ? 'block' : 'none';\n                }\n                \n                this.updatePureLyrics();\n            }\n        },\n\n        updateSettingsPanel() {\n            const cfg = this.state.cfg;\n            \n            targetDoc.getElementById('inp-theme').value = cfg.themeColor;\n            targetDoc.getElementById('inp-border').value = cfg.borderColor;\n            targetDoc.getElementById('inp-rgb').value = cfg.rgbColor;\n            \n            targetDoc.getElementById('inp-expanded-col').value = cfg.expandedBg.startsWith('#') ? cfg.expandedBg : '#1a1a1a';\n            targetDoc.getElementById('inp-collapsed-col').value = cfg.collapsedBg.startsWith('#') ? cfg.collapsedBg : '#1a1a1a';\n            \n            targetDoc.getElementById('sw-glass').checked = this.state.glass;\n            targetDoc.getElementById('inp-glass-opacity').value = Math.round(this.state.glassOpacity * 100);\n            targetDoc.getElementById('val-glass-opacity').innerText = Math.round(this.state.glassOpacity * 100) + '%';\n            \n            targetDoc.getElementById('inp-speed').value = this.state.speed;\n            targetDoc.getElementById('val-speed').innerText = this.state.speed + 'x';\n            \n            targetDoc.getElementById('inp-width').value = parseInt(cfg.borderWidth);\n            targetDoc.getElementById('val-width').innerText = cfg.borderWidth;\n            \n            targetDoc.getElementById('inp-width-player').value = parseInt(cfg.playerWidth);\n            targetDoc.getElementById('val-width-player').innerText = cfg.playerWidth;\n            \n            targetDoc.getElementById('inp-height-player').value = parseInt(cfg.playerHeight);\n            targetDoc.getElementById('val-height-player').innerText = cfg.playerHeight;\n            \n            targetDoc.getElementById('inp-cover-w').value = cfg.coverWidth;\n            targetDoc.getElementById('val-cover-w').innerText = cfg.coverWidth + 'px';\n            \n            targetDoc.getElementById('inp-cover-h').value = cfg.coverHeight;\n            targetDoc.getElementById('val-cover-h').innerText = cfg.coverHeight + 'px';\n            \n            // çº¯äº«æ¨¡å¼è®¾ç½®\n            targetDoc.getElementById('inp-pure-size').value = cfg.pureModeSize;\n            targetDoc.getElementById('val-pure-size').innerText = cfg.pureModeSize + 'px';\n            \n            targetDoc.getElementById('inp-pure-bg').value = cfg.pureModeBg.startsWith('#') ? cfg.pureModeBg : '#1a1a1a';\n            \n            const rgbOpts = targetDoc.querySelectorAll('.rgb-opt');\n            rgbOpts.forEach(opt => {\n                opt.classList.toggle('active', parseInt(opt.dataset.val) === this.state.rgbMode);\n            });\n        },\n\n        updatePureLyrics() {\n            if (!this.state.isPureMode) return;\n            \n            const container = targetDoc.getElementById('pure-lyrics-container');\n            if (!container) return;\n            \n            if (!this.state.lyrics.length || this.state.currentLyricIndex < 0) {\n                container.innerHTML = '<div class=\"pure-lyric-line no-lyrics\">æ™šç¡çš„å°å­©ä¸ä¼šæœ‰ç¾æ¢¦å…‰ä¸´å“¦</div>';\n                return;\n            }\n\n            const currentLyric = this.state.lyrics[this.state.currentLyricIndex];\n            const nextLyric = this.state.lyrics[this.state.currentLyricIndex + 1];\n            \n            if (!currentLyric) return;\n            \n            const time = this.audio.currentTime;\n            const duration = nextLyric ? nextLyric.time - currentLyric.time : 3;\n            const elapsed = time - currentLyric.time;\n            const progress = Math.min(Math.max(elapsed / duration, 0), 1);\n            \n            // é€å­—æ­Œè¯æ•ˆæœ\n            this.state.wordLyricsProgress = progress;\n            this.renderWordLyrics(currentLyric.text, progress);\n        },\n\n        renderWordLyrics(text, progress) {\n            const container = targetDoc.getElementById('pure-lyrics-container');\n            container.innerHTML = '';\n            \n            // æ·»åŠ ç­¾åï¼ˆå¦‚æœæœ‰ï¼‰\n            if (this.state.cfg.pureModeSignature && this.state.cfg.pureModeSignature.trim()) {\n                const signature = targetDoc.createElement('div');\n                signature.id = 'pure-signature';\n                signature.className = 'pure-signature';\n                signature.innerText = this.state.cfg.pureModeSignature;\n                container.appendChild(signature);\n            }\n            \n            // é€å­—æ­Œè¯\n            const lyricLine = targetDoc.createElement('div');\n            lyricLine.className = 'word-lyrics-line';\n            \n            const chars = text.split('');\n            chars.forEach((char, index) => {\n                const charSpan = targetDoc.createElement('span');\n                charSpan.className = 'lyric-char';\n                charSpan.textContent = char;\n                charSpan.style.setProperty('--char-index', index);\n                \n                // è®¡ç®—æ¯ä¸ªå­—çš„è¿›åº¦\n                const charProgress = (progress * chars.length - index) / 0.3;\n                const effectiveProgress = Math.max(0, Math.min(1, charProgress));\n                \n                if (effectiveProgress > 0) {\n                    charSpan.style.background = `linear-gradient(90deg, \n                        var(--rgb-single) 0%, \n                        var(--rgb-single) ${effectiveProgress * 100}%, \n                        currentColor ${effectiveProgress * 100}%)`;\n                    charSpan.style.webkitBackgroundClip = 'text';\n                    charSpan.style.backgroundClip = 'text';\n                    charSpan.style.color = 'transparent';\n                } else {\n                    charSpan.style.background = 'none';\n                    charSpan.style.color = 'currentColor';\n                }\n                \n                lyricLine.appendChild(charSpan);\n            });\n            \n            container.appendChild(lyricLine);\n        },\n\n        // åˆå§‹åŒ–éŸ³é¢‘å¯è§†åŒ–\n        initAudioVisualizer() {\n            if (this.audioVisualizer) return;\n            \n            const icon = targetDoc.getElementById('ins-v46-icon');\n            if (!icon) return;\n            \n            // åˆ›å»ºæ–°çš„éŸ³é¢‘å¯è§†åŒ–å®¹å™¨\n            const visualizer = targetDoc.createElement('div');\n            visualizer.className = 'new-audio-visualizer';\n            visualizer.style.cssText = `\n                position: absolute;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                display: flex;\n                justify-content: center;\n                align-items: center;\n                gap: 2px;\n                z-index: 5;\n                pointer-events: none;\n            `;\n            \n            // åˆ›å»ºæ˜Ÿæ˜Ÿå’ŒéŸ³é¢‘æ¡\n            const stars = [];\n            const bars = [];\n            \n            // ä¸Šæ’éŸ³é¢‘æ¡ (34æ ¹)\n            for (let i = 0; i < 34; i++) {\n                const bar = targetDoc.createElement('div');\n                bar.className = 'audio-bar top-bar';\n                bar.style.cssText = `\n                    width: 4px;\n                    height: 2px;\n                    background: currentColor;\n                    border-radius: 2px;\n                    transition: height 0.1s ease-out;\n                    opacity: 0;\n                `;\n                bars.push(bar);\n                visualizer.appendChild(bar);\n            }\n            \n            // ä¸­é—´æ˜Ÿæ˜Ÿ (34ä¸ª)\n            for (let i = 0; i < 34; i++) {\n                const star = targetDoc.createElement('div');\n                star.className = 'audio-star';\n                star.innerHTML = 'âœ¦';\n                star.style.cssText = `\n                    font-size: 14px;\n                    animation: starBlink ${1 + Math.random()}s infinite alternate;\n                    animation-delay: ${i * 0.05}s;\n                    opacity: 0.7;\n                    transform-origin: center;\n                `;\n                stars.push(star);\n                visualizer.appendChild(star);\n            }\n            \n            // ä¸‹æ’éŸ³é¢‘æ¡ (34æ ¹)\n            for (let i = 0; i < 34; i++) {\n                const bar = targetDoc.createElement('div');\n                bar.className = 'audio-bar bottom-bar';\n                bar.style.cssText = `\n                    width: 4px;\n                    height: 2px;\n                    background: currentColor;\n                    border-radius: 2px;\n                    transition: height 0.1s ease-out;\n                    opacity: 0;\n                `;\n                bars.push(bar);\n                visualizer.appendChild(bar);\n            }\n            \n            icon.appendChild(visualizer);\n            \n            this.audioVisualizer = {\n                container: visualizer,\n                stars: stars,\n                bars: bars,\n                baseFrequency: 1.0,\n                frequencyTimer: 0,\n                barHeights: new Array(68).fill(2),\n                update: function(isPlaying) {\n                    // éšæœºæ”¹å˜é¢‘ç‡\n                    if (this.frequencyTimer <= 0) {\n                        this.baseFrequency = 0.5 + Math.random() * 2.0;\n                        this.frequencyTimer = 30 + Math.random() * 120;\n                    }\n                    this.frequencyTimer--;\n                    \n                    const time = Date.now() * 0.001 * this.baseFrequency;\n                    \n                    // æ›´æ–°éŸ³é¢‘æ¡\n                    this.bars.forEach((bar, i) => {\n                        const isSide = i < 5 || (i >= 34 && i < 39) || \n                                      (i >= 29 && i < 34) || (i >= 63);\n                        const maxHeight = isSide ? 90 : 125;\n                        \n                        // åŒæ­¥é¢‘ç‡ï¼Œä½†é«˜åº¦éšæœº\n                        const base = Math.sin(time + i * 0.2) * 0.5 + 0.5;\n                        const random = Math.random() * 0.4;\n                        const height = Math.min(maxHeight, (base * 0.6 + random * 0.4) * maxHeight);\n                        \n                        bar.style.height = height + 'px';\n                        bar.style.opacity = isPlaying ? 1 : 0;\n                    });\n                    \n                    // æ›´æ–°æ˜Ÿæ˜Ÿ\n                    this.updateStars();\n                },\n                updateStars: function() {\n                    const time = Date.now() * 0.001;\n                    this.stars.forEach((star, i) => {\n                        const scale = 0.85 + Math.sin(time * 2 + i) * 0.15;\n                        star.style.transform = `scale(${scale})`;\n                    });\n                }\n            };\n            \n            // å¼€å§‹åŠ¨ç”»å¾ªç¯\n            this.startVisualizerAnimation();\n        },\n\n        startVisualizerAnimation() {\n            if (!this.audioVisualizer) return;\n            \n            const animate = () => {\n                if (this.audioVisualizer) {\n                    this.audioVisualizer.update(this.state.isPlaying && !this.audio.paused);\n                }\n                requestAnimationFrame(animate);\n            };\n            animate();\n        },\n\n        updateAudioVisualizer() {\n            if (!this.audioVisualizer) {\n                this.initAudioVisualizer();\n            }\n            \n            // æ›´æ–°é¢œè‰²\n            const cfg = this.state.cfg;\n            const mode = this.state.rgbMode;\n            \n            if (this.audioVisualizer) {\n                const color = mode === 2 ? '#ffffff' : (mode === 1 ? cfg.rgbColor : '#000000');\n                \n                this.audioVisualizer.bars.forEach(bar => {\n                    bar.style.color = color;\n                    bar.style.background = color;\n                });\n                \n                this.audioVisualizer.stars.forEach(star => {\n                    star.style.color = color;\n                });\n            }\n        },\n\n        play(i) {\n            if (!this.playlist[i]) return;\n            this.index = i;\n            this.audio.src = this.playlist[i].url;\n            this.audio.playbackRate = this.state.speed;\n            this.audio.play().catch(e => console.log(e));\n            this.state.lyrics = this.playlist[i].lyrics ? this.parseLyrics(this.playlist[i].lyrics) : [];\n            this.state.currentLyricIndex = -1;\n            this.state.wordLyricsProgress = 0;\n            this.updateView();\n            this.renderList();\n        },\n\n        toggle() {\n            if (!this.playlist.length) return this.showAddOptions();\n            this.audio.paused ? (this.index === -1 ? this.play(0) : this.audio.play()) : this.audio.pause();\n        },\n\n        next() {\n            if (!this.playlist.length) return;\n            let n;\n            if (this.state.playMode === 2) {\n                do { n = Math.floor(Math.random() * this.playlist.length); } while (n === this.index && this.playlist.length > 1);\n            } else {\n                n = this.index + 1 >= this.playlist.length ? 0 : this.index + 1;\n            }\n            this.play(n);\n        },\n\n        prev() {\n            if (!this.playlist.length) return;\n            let n = this.index - 1 < 0 ? this.playlist.length - 1 : this.index - 1;\n            this.play(n);\n        },\n\n        togglePanel(type) {\n            const root = targetDoc.getElementById('ins-v46-root');\n            const p1 = targetDoc.getElementById('panel-set');\n            const p2 = targetDoc.getElementById('panel-list');\n            const p3 = targetDoc.getElementById('panel-history');\n            \n            if (this.state.panel === type) {\n                root.classList.remove('expanded');\n                p1.style.display = p2.style.display = p3.style.display = 'none';\n                this.state.panel = false;\n            } else {\n                root.classList.add('expanded');\n                p1.style.display = type === 'set' ? 'flex' : 'none';\n                p2.style.display = type === 'list' ? 'flex' : 'none';\n                p3.style.display = type === 'history' ? 'flex' : 'none';\n                this.state.panel = type;\n                \n                if (type === 'history') {\n                    this.renderImportHistory();\n                }\n            }\n            this.updateView();\n        },\n\n        togglePureMode() {\n            this.state.isPureMode = !this.state.isPureMode;\n            this.state.currentLyricIndex = -1;\n            this.state.wordLyricsProgress = 0;\n            this.updateView();\n            this.saveData();\n        },\n\n        showSignatureDialog() {\n            const overlay = targetDoc.createElement('div');\n            overlay.className = 'lyrics-dialog-overlay';\n            overlay.innerHTML = `\n                <div class=\"lyrics-dialog\">\n                    <div class=\"lyrics-dialog-title\">è®¾ç½®ç­¾å</div>\n                    <input type=\"text\" id=\"signature-input\" placeholder=\"è¾“å…¥ç­¾åï¼ˆç©ºæ ¼åˆ™ä¸æ˜¾ç¤ºï¼‰\" value=\"${this.state.cfg.pureModeSignature}\" style=\"\n                        width: 100%;\n                        padding: 10px;\n                        margin: 10px 0;\n                        background: rgba(255,255,255,0.1);\n                        border: 1px solid rgba(255,255,255,0.3);\n                        border-radius: 5px;\n                        color: white;\n                        font-size: 14px;\n                    \">\n                    <div class=\"lyrics-dialog-btns\">\n                        <button id=\"signature-confirm\">ç¡®å®š</button>\n                        <button id=\"signature-cancel\" class=\"lyrics-cancel\">å–æ¶ˆ</button>\n                    </div>\n                </div>\n            `;\n            targetDoc.body.appendChild(overlay);\n\n            overlay.querySelector('#signature-confirm').onclick = () => {\n                const input = overlay.querySelector('#signature-input');\n                this.state.cfg.pureModeSignature = input.value.trim();\n                overlay.remove();\n                this.updateView();\n                this.saveData();\n            };\n\n            overlay.querySelector('#signature-cancel').onclick = () => {\n                overlay.remove();\n            };\n\n            overlay.onclick = (e) => {\n                if (e.target === overlay) overlay.remove();\n            };\n            \n            // å±…ä¸­å¼¹çª—\n            overlay.style.display = 'flex';\n            overlay.style.alignItems = 'center';\n            overlay.style.justifyContent = 'center';\n        },\n\n        parseLyrics(lrc) {\n            const lines = lrc.split('\\n');\n            const result = [];\n            const regex = /\\[(\\d{2}):(\\d{2})\\.(\\d{2,3})\\](.*)/;\n            for (const line of lines) {\n                const match = line.match(regex);\n                if (match) {\n                    const time = parseInt(match[1]) * 60 + parseInt(match[2]) + parseInt(match[3]) / 1000;\n                    const text = match[4].trim();\n                    if (text) result.push({ time, text });\n                }\n            }\n            return result.sort((a, b) => a.time - b.time);\n        },\n\n        // ==================== é“¾æ¥è¯†åˆ«è¾…åŠ©å‡½æ•° ====================\n        isNeteaseLink(url) {\n            return url.includes('music.163.com') || \n                   url.includes('163cn.tv') || \n                   url.includes('y.music.163.com');\n        },\n\n        isPlaylistLink(url) {\n            return url.includes('playlist') || url.includes('playlist?id=');\n        },\n\n        extractIdFromLink(link) {\n            const cleanLink = link.trim();\n            \n            if (cleanLink.includes('163cn.tv/')) {\n                const match = cleanLink.match(/163cn\\.tv\\/([a-zA-Z0-9]+)/);\n                return match ? match[1] : null;\n            }\n            \n            const idMatch = cleanLink.match(/(\\d{6,})/);\n            return idMatch ? idMatch[1] : null;\n        },\n\n        // ==================== æ˜¾ç¤ºæ·»åŠ é€‰é¡¹å¯¹è¯æ¡† ====================\n        showAddOptions() {\n            const overlay = targetDoc.createElement('div');\n            overlay.className = 'lyrics-dialog-overlay';\n            overlay.innerHTML = `\n                <div class=\"add-options-dialog\">\n                    <div class=\"lyrics-dialog-title\">æ·»åŠ æ­Œæ›²</div>\n                    <div class=\"add-options-btns\">\n                        <button id=\"add-single-btn\">\n                            <div class=\"option-icon\">ğŸµ</div>\n                            <div class=\"option-text\">æ·»åŠ å•æ›²</div>\n                        </button>\n                        <button id=\"add-playlist-btn\">\n                            <div class=\"option-icon\">ğŸ“‹</div>\n                            <div class=\"option-text\">æ·»åŠ æ­Œå•</div>\n                        </button>\n                    </div>\n                    <button id=\"add-cancel-btn\" class=\"lyrics-cancel\">å–æ¶ˆ</button>\n                </div>\n            `;\n            targetDoc.body.appendChild(overlay);\n\n            overlay.querySelector('#add-single-btn').onclick = () => {\n                overlay.remove();\n                this.addUrlSong();\n            };\n\n            overlay.querySelector('#add-playlist-btn').onclick = () => {\n                overlay.remove();\n                this.addPlaylist();\n            };\n\n            overlay.querySelector('#add-cancel-btn').onclick = () => {\n                overlay.remove();\n            };\n\n            overlay.onclick = (e) => {\n                if (e.target === overlay) overlay.remove();\n            };\n            \n            // å±…ä¸­å¼¹çª—\n            overlay.style.display = 'flex';\n            overlay.style.alignItems = 'center';\n            overlay.style.justifyContent = 'center';\n        },\n\n        // ==================== å•æ›²æ·»åŠ  ====================\n        async fetchNeteaseSongInfo(link) {\n            try {\n                this.showStatus('æ­£åœ¨è§£æé“¾æ¥...', 'info');\n                \n                const detailResponse = await fetch('https://wyapi-1.toubiec.cn/api/music/detail', {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify({ id: link })\n                });\n                \n                if (!detailResponse.ok) {\n                    throw new Error('è·å–æ­Œæ›²ä¿¡æ¯å¤±è´¥');\n                }\n                \n                const detailData = await detailResponse.json();\n                \n                if (detailData.code !== 200) {\n                    throw new Error(detailData.msg || 'APIè¿”å›é”™è¯¯');\n                }\n                \n                const songInfo = detailData.data;\n                \n                const urlResponse = await fetch('https://wyapi-1.toubiec.cn/api/music/url', {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify({ \n                        id: link, \n                        level: 'exhigh'\n                    })\n                });\n                \n                if (!urlResponse.ok) {\n                    throw new Error('è·å–æ’­æ”¾é“¾æ¥å¤±è´¥');\n                }\n                \n                const urlData = await urlResponse.json();\n                \n                if (urlData.code !== 200) {\n                    throw new Error(urlData.msg || 'è·å–æ’­æ”¾é“¾æ¥å¤±è´¥');\n                }\n                \n                let lyrics = '';\n                const lyricResponse = await fetch('https://wyapi-1.toubiec.cn/api/music/lyric', {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify({ id: link })\n                });\n                \n                if (lyricResponse.ok) {\n                    const lyricData = await lyricResponse.json();\n                    if (lyricData.code === 200) {\n                        lyrics = lyricData.data.lrc || '';\n                    }\n                }\n                \n                let playUrl = '';\n                if (urlData.data && Array.isArray(urlData.data) && urlData.data[0]) {\n                    playUrl = urlData.data[0].url || '';\n                }\n                \n                if (!playUrl) {\n                    throw new Error('æ— æ³•è·å–æ’­æ”¾é“¾æ¥');\n                }\n                \n                return {\n                    title: songInfo.name || 'æœªçŸ¥æ­Œæ›²',\n                    artist: songInfo.singer || 'æœªçŸ¥è‰ºæœ¯å®¶',\n                    url: playUrl,\n                    lyrics: lyrics,\n                    cover: songInfo.picimg || defaultConfig.cover,\n                    duration: songInfo.duration || '0:00'\n                };\n                \n            } catch (error) {\n                console.error('ç½‘æ˜“äº‘è§£æå¤±è´¥:', error);\n                this.showStatus(`è§£æå¤±è´¥: ${error.message}`, 'error');\n                throw error;\n            }\n        },\n\n        addUrlSong() {\n            const input = prompt('è¯·è¾“å…¥ç½‘æ˜“äº‘æ­Œæ›²é“¾æ¥ï¼š\\næ”¯æŒæ ¼å¼ï¼š\\nâ€¢ music.163.com/song?id=xxx\\nâ€¢ y.music.163.com/m/song/xxx\\nâ€¢ 163cn.tv/xxxï¼ˆçŸ­é“¾æ¥ï¼‰');\n            if (!input) return;\n            \n            if (!this.isNeteaseLink(input)) {\n                const title = prompt('æ­Œå:', 'Untitled') || 'Untitled';\n                const artist = prompt('æ­Œæ‰‹:', 'Unknown') || 'Unknown';\n                \n                this.playlist.push({\n                    title: title,\n                    artist: artist,\n                    url: input,\n                    lyrics: '',\n                    cover: defaultConfig.cover\n                });\n                \n                this.saveData();\n                this.renderList();\n                this.showStatus('æ­Œæ›²æ·»åŠ æˆåŠŸï¼', 'success');\n                \n                if (this.index === -1) {\n                    this.play(this.playlist.length - 1);\n                }\n                return;\n            }\n            \n            this.fetchNeteaseSongInfo(input)\n                .then(songInfo => {\n                    this.playlist.push({\n                        title: songInfo.title,\n                        artist: songInfo.artist,\n                        url: songInfo.url,\n                        lyrics: songInfo.lyrics || '',\n                        cover: songInfo.cover\n                    });\n                    \n                    this.addImportHistory('single', {\n                        title: songInfo.title,\n                        artist: songInfo.artist,\n                        link: input\n                    });\n                    \n                    this.saveData();\n                    this.renderList();\n                    this.showStatus(`æˆåŠŸæ·»åŠ : ${songInfo.title}`, 'success');\n                    \n                    if (this.index === -1) {\n                        this.play(this.playlist.length - 1);\n                    }\n                })\n                .catch(error => {\n                    console.error('æ·»åŠ å¤±è´¥:', error);\n                });\n        },\n\n        // ==================== æ­Œå•æ·»åŠ  ====================\n        async fetchNeteasePlaylist(link) {\n            try {\n                this.showStatus('æ­£åœ¨è§£ææ­Œå•...', 'info');\n                \n                const response = await fetch('https://wyapi-1.toubiec.cn/api/music/playlist', {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify({ id: link })\n                });\n                \n                if (!response.ok) {\n                    throw new Error('è·å–æ­Œå•å¤±è´¥');\n                }\n                \n                const data = await response.json();\n                \n                if (data.code !== 200) {\n                    throw new Error(data.msg || 'APIè¿”å›é”™è¯¯');\n                }\n                \n                const playlist = data.data;\n                return playlist;\n                \n            } catch (error) {\n                console.error('æ­Œå•è§£æå¤±è´¥:', error);\n                this.showStatus(`æ­Œå•è§£æå¤±è´¥: ${error.message}`, 'error');\n                throw error;\n            }\n        },\n\n        async addPlaylist() {\n            const input = prompt('è¯·è¾“å…¥ç½‘æ˜“äº‘æ­Œå•é“¾æ¥ï¼š\\næ”¯æŒæ ¼å¼ï¼š\\nâ€¢ music.163.com/playlist?id=xxx\\nâ€¢ y.music.163.com/m/playlist?id=xxx');\n            if (!input) return;\n            \n            if (!this.isPlaylistLink(input)) {\n                this.showStatus('è¿™ä¸æ˜¯æœ‰æ•ˆçš„æ­Œå•é“¾æ¥', 'error');\n                return;\n            }\n            \n            try {\n                const playlist = await this.fetchNeteasePlaylist(input);\n                \n                if (!playlist.tracks || playlist.tracks.length === 0) {\n                    this.showStatus('æ­Œå•ä¸ºç©ºæˆ–æ— æ³•è·å–æ­Œæ›²åˆ—è¡¨', 'error');\n                    return;\n                }\n                \n                const confirmed = confirm(`å‘ç°æ­Œå•: ${playlist.name}\\nåˆ›å»ºè€…: ${playlist.creator}\\nå…± ${playlist.tracks.length} é¦–æ­Œæ›²\\n\\næ˜¯å¦å…¨éƒ¨æ·»åŠ åˆ°æ’­æ”¾åˆ—è¡¨ï¼Ÿ`);\n                \n                if (!confirmed) return;\n                \n                this.showStatus(`æ­£åœ¨å¯¼å…¥ ${playlist.tracks.length} é¦–æ­Œæ›²...`, 'info');\n                \n                let addedCount = 0;\n                let failedCount = 0;\n                \n                for (let i = 0; i < playlist.tracks.length; i++) {\n                    const track = playlist.tracks[i];\n                    const link = `music.163.com/song?id=${track.id}`;\n                    \n                    try {\n                        const songInfo = await this.fetchNeteaseSongInfo(link);\n                        \n                        this.playlist.push({\n                            title: track.name,\n                            artist: track.artists,\n                            url: songInfo.url,\n                            lyrics: songInfo.lyrics || '',\n                            cover: track.picUrl || songInfo.cover\n                        });\n                        \n                        addedCount++;\n                        \n                        if ((i + 1) % 5 === 0 || i === playlist.tracks.length - 1) {\n                            this.showStatus(`å·²å¯¼å…¥ ${i + 1}/${playlist.tracks.length} é¦–æ­Œæ›²`, 'info');\n                        }\n                        \n                        await new Promise(resolve => setTimeout(resolve, 100));\n                        \n                    } catch (error) {\n                        console.error(`æ­Œæ›² ${track.name} å¯¼å…¥å¤±è´¥:`, error);\n                        failedCount++;\n                    }\n                }\n                \n                this.addImportHistory('playlist', {\n                    name: playlist.name,\n                    creator: playlist.creator,\n                    count: playlist.tracks.length,\n                    link: input\n                });\n                \n                this.saveData();\n                this.renderList();\n                \n                if (addedCount > 0) {\n                    this.showStatus(`æ­Œå•å¯¼å…¥å®Œæˆï¼æˆåŠŸ ${addedCount} é¦–ï¼Œå¤±è´¥ ${failedCount} é¦–`, 'success');\n                } else {\n                    this.showStatus('æ²¡æœ‰æ­Œæ›²æˆåŠŸå¯¼å…¥', 'error');\n                }\n                \n                if (this.index === -1 && this.playlist.length > 0) {\n                    this.play(0);\n                }\n                \n            } catch (error) {\n                console.error('æ­Œå•å¯¼å…¥å¤±è´¥:', error);\n            }\n        },\n\n        // ==================== æ¸²æŸ“å¯¼å…¥å†å² ====================\n        renderImportHistory() {\n            const container = targetDoc.getElementById('history-list');\n            if (!container) return;\n            \n            if (this.state.importHistory.length === 0) {\n                container.innerHTML = '<div class=\"no-history\">æš‚æ— å¯¼å…¥å†å²</div>';\n                return;\n            }\n            \n            let html = '';\n            this.state.importHistory.forEach((history, index) => {\n                const time = history.time;\n                \n                if (history.type === 'single') {\n                    html += `\n                        <div class=\"history-item\">\n                            <div class=\"history-icon\">ğŸµ</div>\n                            <div class=\"history-content\">\n                                <div class=\"history-title\">${history.data.title}</div>\n                                <div class=\"history-sub\">${history.data.artist}</div>\n                            </div>\n                            <div class=\"history-time\">${time}</div>\n                        </div>\n                    `;\n                } else if (history.type === 'playlist') {\n                    html += `\n                        <div class=\"history-item\">\n                            <div class=\"history-icon\">ğŸ“‹</div>\n                            <div class=\"history-content\">\n                                <div class=\"history-title\">${history.data.name}</div>\n                                <div class=\"history-sub\">${history.data.creator} â€¢ ${history.data.count} é¦–</div>\n                            </div>\n                            <div class=\"history-time\">${time}</div>\n                        </div>\n                    `;\n                }\n            });\n            \n            container.innerHTML = html;\n        },\n\n        updateLyrics() {\n            if (!this.state.lyrics.length) {\n                targetDoc.getElementById('ins-lyrics').innerText = 'â‹†â€¦â€¦ğ–¦¤â€¦â€¦â‹†';\n                return;\n            }\n            const time = this.audio.currentTime;\n            let currentIndex = -1;\n            for (let i = 0; i < this.state.lyrics.length; i++) {\n                if (time >= this.state.lyrics[i].time) {\n                    currentIndex = i;\n                } else {\n                    break;\n                }\n            }\n            \n            if (currentIndex !== this.state.currentLyricIndex) {\n                this.state.currentLyricIndex = currentIndex;\n                if (this.state.isPureMode) {\n                    this.updatePureLyrics();\n                }\n            }\n            \n            const currentLine = this.state.lyrics[currentIndex] ? this.state.lyrics[currentIndex].text : '';\n            targetDoc.getElementById('ins-lyrics').innerText = currentLine || 'â‹†â€¦â€¦ğ–¦¤â€¦â€¦â‹†';\n        },\n\n        delSong(i) {\n            if (!confirm('åˆ é™¤?')) return;\n            this.playlist.splice(i, 1);\n            this.saveData();\n            this.renderList();\n            if (i === this.index) {\n                this.audio.pause();\n                this.index = -1;\n                this.updateView();\n            }\n        },\n\n        showLyricsDialog(i) {\n            const overlay = targetDoc.createElement('div');\n            overlay.className = 'lyrics-dialog-overlay';\n            overlay.innerHTML = `\n                <div class=\"lyrics-dialog\">\n                    <div class=\"lyrics-dialog-title\">æ­Œè¯è®¾ç½®</div>\n                    <div class=\"lyrics-dialog-btns\">\n                        <button id=\"lyrics-paste-btn\">ç²˜è´´æ­Œè¯</button>\n                        <button id=\"lyrics-import-btn\">å¯¼å…¥æ–‡ä»¶</button>\n                    </div>\n                    <button id=\"lyrics-cancel-btn\" class=\"lyrics-cancel\">å–æ¶ˆ</button>\n                </div>\n            `;\n            targetDoc.body.appendChild(overlay);\n\n            overlay.querySelector('#lyrics-paste-btn').onclick = () => {\n                overlay.remove();\n                const currentLyrics = this.playlist[i].lyrics || '';\n                const newLyrics = prompt('ç²˜è´´LRCæ ¼å¼æ­Œè¯:', currentLyrics);\n                if (newLyrics !== null) {\n                    this.playlist[i].lyrics = newLyrics;\n                    if (i === this.index) {\n                        this.state.lyrics = this.parseLyrics(newLyrics);\n                        this.state.currentLyricIndex = -1;\n                        this.state.wordLyricsProgress = 0;\n                    }\n                    this.saveData();\n                }\n            };\n\n            overlay.querySelector('#lyrics-import-btn').onclick = () => {\n                overlay.remove();\n                this.createFileInput('.lrc,.txt', (file) => {\n                    this.handleTextFileUpload(file, (content) => {\n                        this.playlist[i].lyrics = content;\n                        if (i === this.index) {\n                            this.state.lyrics = this.parseLyrics(content);\n                            this.state.currentLyricIndex = -1;\n                            this.state.wordLyricsProgress = 0;\n                        }\n                        this.saveData();\n                        alert('æ­Œè¯å¯¼å…¥æˆåŠŸï¼');\n                    });\n                });\n            };\n\n            overlay.querySelector('#lyrics-cancel-btn').onclick = () => {\n                overlay.remove();\n            };\n\n            overlay.onclick = (e) => {\n                if (e.target === overlay) overlay.remove();\n            };\n            \n            // å±…ä¸­å¼¹çª—\n            overlay.style.display = 'flex';\n            overlay.style.alignItems = 'center';\n            overlay.style.justifyContent = 'center';\n        },\n\n        renderList() {\n            const list = targetDoc.getElementById('list-box');\n            list.innerHTML = '';\n            this.playlist.forEach((t, i) => {\n                const item = targetDoc.createElement('div');\n                item.className = `item ${i === this.index ? 'active' : ''}`;\n                item.innerHTML = `\n                    <div class=\"info\"><b>${t.title} - ${t.artist}</b></div>\n                    <div class=\"item-btns\">\n                        <button class=\"btn-lyrics\">æ­Œè¯</button>\n                        <button class=\"del\">Ã—</button>\n                    </div>\n                `;\n                item.querySelector('.info').onclick = () => this.play(i);\n                item.querySelector('.del').onclick = () => this.delSong(i);\n                item.querySelector('.btn-lyrics').onclick = () => this.showLyricsDialog(i);\n                list.appendChild(item);\n            });\n        },\n\n        bindEvents() {\n            const root = targetDoc.getElementById('ins-v46-root');\n            const icon = targetDoc.getElementById('ins-v46-icon');\n            const island = targetDoc.getElementById('ins-island');\n            const leftZone = icon.querySelector('.icon-left-zone');\n            const rightZone = icon.querySelector('.icon-right-zone');\n\n            // æ’­æ”¾å™¨æ‹–æ‹½\n            const handlePlayerDrag = (e) => {\n                e.preventDefault();\n                this.drag.active = true;\n                const startX = e.clientX || e.touches[0].clientX;\n                const startY = e.clientY || e.touches[0].clientY;\n                this.drag.offX = startX - root.offsetLeft;\n                this.drag.offY = startY - root.offsetTop;\n\n                const move = (ev) => {\n                    if (!this.drag.active) return;\n                    ev.preventDefault();\n                    const cx = ev.clientX || ev.touches[0].clientX;\n                    const cy = ev.clientY || ev.touches[0].clientY;\n                    const x = cx - this.drag.offX;\n                    const y = cy - this.drag.offY;\n                    root.style.left = x + 'px';\n                    root.style.top = y + 'px';\n                    this.state.playerPos = { x, y };\n                };\n\n                const up = () => {\n                    this.drag.active = false;\n                    this.saveData();\n                    targetDoc.removeEventListener('mousemove', move);\n                    targetDoc.removeEventListener('touchmove', move);\n                    targetDoc.removeEventListener('mouseup', up);\n                    targetDoc.removeEventListener('touchend', up);\n                };\n\n                targetDoc.addEventListener('mousemove', move);\n                targetDoc.addEventListener('touchmove', move, { passive: false });\n                targetDoc.addEventListener('mouseup', up);\n                targetDoc.addEventListener('touchend', up);\n            };\n\n            island.addEventListener('mousedown', handlePlayerDrag);\n            island.addEventListener('touchstart', handlePlayerDrag);\n\n            // å›¾æ ‡æ‹–æ‹½\n            const handleIconDrag = (e) => {\n                e.preventDefault();\n                e.stopPropagation();\n                this.drag.active = true;\n                const startX = e.clientX || e.touches[0].clientX;\n                const startY = e.clientY || e.touches[0].clientY;\n                this.drag.offX = startX - icon.offsetLeft;\n                this.drag.offY = startY - icon.offsetTop;\n\n                const move = (ev) => {\n                    if (!this.drag.active) return;\n                    ev.preventDefault();\n                    const cx = ev.clientX || ev.touches[0].clientX;\n                    const cy = ev.clientY || ev.touches[0].clientY;\n                    const x = cx - this.drag.offX;\n                    const y = cy - this.drag.offY;\n                    icon.style.left = x + 'px';\n                    icon.style.top = y + 'px';\n                    this.state.iconPos = { x, y };\n                };\n\n                const up = () => {\n                    this.drag.active = false;\n                    this.saveData();\n                    targetDoc.removeEventListener('mousemove', move);\n                    targetDoc.removeEventListener('touchmove', move);\n                    targetDoc.removeEventListener('mouseup', up);\n                    targetDoc.removeEventListener('touchend', up);\n                };\n\n                targetDoc.addEventListener('mousemove', move);\n                targetDoc.addEventListener('touchmove', move, { passive: false });\n                targetDoc.addEventListener('mouseup', up);\n                targetDoc.addEventListener('touchend', up);\n            };\n\n            leftZone.addEventListener('mousedown', handleIconDrag);\n            leftZone.addEventListener('touchstart', handleIconDrag);\n\n            // å³ä¾§åŒºåŸŸï¼šåŒå‡»å±•å¼€\n            let lastClickTime = 0;\n            const handleRightClick = (e) => {\n                e.preventDefault();\n                e.stopPropagation();\n                const now = Date.now();\n                if (now - lastClickTime < 300) {\n                    this.state.isMinimized = false;\n                    this.updateView();\n                    this.saveData();\n                    lastClickTime = 0;\n                } else {\n                    lastClickTime = now;\n                }\n            };\n\n            rightZone.addEventListener('click', handleRightClick);\n            rightZone.addEventListener('touchend', (e) => {\n                e.preventDefault();\n                handleRightClick(e);\n            });\n\n            const click = (id, fn) => {\n                const el = targetDoc.getElementById(id);\n                if (el) el.onclick = (e) => { e.stopPropagation(); fn(e); };\n            };\n\n            click('btn-min', () => { this.state.isMinimized = true; this.updateView(); this.saveData(); });\n            click('btn-play', () => this.toggle());\n            click('btn-next', () => this.next());\n            click('btn-prev', () => this.prev());\n            click('btn-mode', () => { this.state.playMode = (this.state.playMode + 1) % 3; this.updateView(); this.saveData(); });\n            click('btn-set', () => this.togglePanel('set'));\n            click('btn-list', () => this.togglePanel('list'));\n            click('btn-history', () => this.togglePanel('history'));\n            click('btn-add', () => this.showAddOptions());\n            click('btn-pure', () => this.togglePureMode());\n            click('ins-pure-mode', () => this.togglePureMode());\n            click('btn-pure-signature', () => this.showSignatureDialog());\n            \n            // ä¿®æ”¹ï¼šä¸Šä¼ â†’å¯¼å…¥\n            click('btn-cover-upload', () => {\n                this.createFileInput('image/*', (file) => {\n                    this.handleFileUpload(file, (dataUrl) => {\n                        this.state.cfg.cover = dataUrl;\n                        this.updateView();\n                        this.saveData();\n                    });\n                });\n            });\n\n            click('btn-expanded-upload', () => {\n                this.createFileInput('image/*', (file) => {\n                    this.handleFileUpload(file, (dataUrl) => {\n                        this.state.cfg.expandedBg = `url(\"${dataUrl}\")`;\n                        this.updateView();\n                        this.saveData();\n                    });\n                });\n            });\n\n            click('btn-collapsed-upload', () => {\n                this.createFileInput('image/*', (file) => {\n                    this.handleFileUpload(file, (dataUrl) => {\n                        this.state.cfg.collapsedBg = `url(\"${dataUrl}\")`;\n                        this.updateView();\n                        this.saveData();\n                    });\n                });\n            });\n\n            // çº¯äº«æ¨¡å¼èƒŒæ™¯å¯¼å…¥\n            click('btn-pure-bg-upload', () => {\n                this.createFileInput('image/*', (file) => {\n                    this.handleFileUpload(file, (dataUrl) => {\n                        this.state.cfg.pureModeBg = `url(\"${dataUrl}\")`;\n                        this.updateView();\n                        this.saveData();\n                    });\n                });\n            });\n\n            const bgColorChange = (id, key) => {\n                const el = targetDoc.getElementById(id);\n                if (el) {\n                    el.oninput = (e) => {\n                        this.state.cfg[key] = e.target.value;\n                        this.updateView();\n                    };\n                    el.onchange = () => this.saveData();\n                }\n            };\n\n            bgColorChange('inp-expanded-col', 'expandedBg');\n            bgColorChange('inp-collapsed-col', 'collapsedBg');\n            bgColorChange('inp-pure-bg', 'pureModeBg');\n\n            const change = (id, fn) => {\n                const el = targetDoc.getElementById(id);\n                if (el) el.onchange = (e) => { fn(e.target.value); this.saveData(); };\n            };\n\n            change('inp-theme', v => { this.state.cfg.themeColor = v; this.updateView(); });\n            change('inp-border', v => { this.state.cfg.borderColor = v; this.updateView(); });\n            change('inp-rgb', v => { this.state.cfg.rgbColor = v; this.updateView(); });\n            \n            // çº¯äº«æ¨¡å¼å°ºå¯¸\n            const pureSizeInput = targetDoc.getElementById('inp-pure-size');\n            if (pureSizeInput) {\n                pureSizeInput.oninput = (e) => {\n                    this.state.cfg.pureModeSize = e.target.value;\n                    this.updateView();\n                };\n                pureSizeInput.onchange = () => this.saveData();\n            }\n\n            targetDoc.querySelectorAll('.rgb-opt').forEach(opt => {\n                opt.onclick = () => {\n                    this.state.rgbMode = parseInt(opt.dataset.val);\n                    this.updateView();\n                    this.saveData();\n                };\n            });\n\n            // ç£¨ç ‚ç»ç’ƒå¼€å…³\n            targetDoc.getElementById('sw-glass').onchange = (e) => { \n                this.state.glass = e.target.checked;\n                this.updateView();\n                this.saveData(); \n            };\n\n            // ç£¨ç ‚ç»ç’ƒé€æ˜åº¦æ»‘å—\n            const glassOpacityInput = targetDoc.getElementById('inp-glass-opacity');\n            if (glassOpacityInput) {\n                glassOpacityInput.oninput = (e) => {\n                    this.state.glassOpacity = parseInt(e.target.value) / 100;\n                    this.updateView();\n                };\n                glassOpacityInput.onchange = () => this.saveData();\n            }\n\n            targetDoc.getElementById('inp-speed').oninput = (e) => {\n                this.state.speed = parseFloat(e.target.value); \n                this.audio.playbackRate = this.state.speed;\n                this.updateView();\n            };\n            targetDoc.getElementById('inp-speed').onchange = () => this.saveData();\n\n            targetDoc.getElementById('inp-width').oninput = (e) => {\n                this.state.cfg.borderWidth = e.target.value + 'px';\n                this.updateView();\n            };\n            targetDoc.getElementById('inp-width').onchange = () => this.saveData();\n\n            targetDoc.getElementById('inp-width-player').oninput = (e) => {\n                this.state.cfg.playerWidth = e.target.value + 'px';\n                this.updateView();\n            };\n            targetDoc.getElementById('inp-width-player').onchange = () => this.saveData();\n\n            targetDoc.getElementById('inp-height-player').oninput = (e) => {\n                this.state.cfg.playerHeight = e.target.value + 'px';\n                this.updateView();\n            };\n            targetDoc.getElementById('inp-height-player').onchange = () => this.saveData();\n\n            targetDoc.getElementById('inp-cover-w').oninput = (e) => {\n                this.state.cfg.coverWidth = parseInt(e.target.value);\n                this.updateView();\n            };\n            targetDoc.getElementById('inp-cover-w').onchange = () => this.saveData();\n\n            targetDoc.getElementById('inp-cover-h').oninput = (e) => {\n                this.state.cfg.coverHeight = parseInt(e.target.value);\n                this.updateView();\n            };\n            targetDoc.getElementById('inp-cover-h').onchange = () => this.saveData();\n\n            targetDoc.getElementById('inp-prog').oninput = (e) => {\n                if(this.audio.duration) this.audio.currentTime = (e.target.value/100)*this.audio.duration;\n            };\n\n            this.audio.onplay = () => {\n                this.state.isPlaying = true;\n                targetDoc.getElementById('btn-play').innerText = 'âšâš';\n                this.updateView();\n            };\n            this.audio.onpause = () => {\n                this.state.isPlaying = false;\n                targetDoc.getElementById('btn-play').innerText = 'â–¶';\n                this.updateView();\n            };\n            this.audio.onended = () => this.next();\n            this.audio.ontimeupdate = () => {\n                if (this.audio.duration) {\n                    targetDoc.getElementById('inp-prog').value = (this.audio.currentTime / this.audio.duration) * 100;\n                }\n                this.updateLyrics();\n            };\n        },\n\n        createUI() {\n            // åˆ›å»ºçŠ¶æ€æç¤ºå…ƒç´ \n            const statusEl = targetDoc.createElement('div');\n            statusEl.id = 'ins-status';\n            statusEl.style.cssText = `\n                position: fixed;\n                top: 20px;\n                left: 50%;\n                transform: translateX(-50%);\n                background: #00d2ff;\n                color: white;\n                padding: 10px 20px;\n                border-radius: 20px;\n                z-index: 2147483648;\n                font-size: 14px;\n                opacity: 0;\n                transition: opacity 0.3s;\n                pointer-events: none;\n                box-shadow: 0 5px 15px rgba(0,0,0,0.3);\n            `;\n            targetDoc.body.appendChild(statusEl);\n\n            // åˆ›å»ºå›¾æ ‡ï¼ˆæ–°çš„éŸ³é¢‘æ¡åœ¨è¿™é‡Œåˆå§‹åŒ–ï¼‰\n            const icon = targetDoc.createElement('div');\n            icon.id = 'ins-v46-icon';\n            \n            icon.innerHTML = `\n                <div class=\"icon-left-zone\">\n                    <div class=\"zone-hint\">æ‹–æ‹½</div>\n                </div>\n                <div class=\"wave-box\"></div>\n                <div class=\"base-line\"></div>\n                <div class=\"icon-right-zone\">\n                    <div class=\"zone-hint\">åŒå‡»</div>\n                </div>\n            `;\n            targetDoc.body.appendChild(icon);\n\n            // åˆ›å»ºæ’­æ”¾å™¨ä¸»ç•Œé¢\n            const root = targetDoc.createElement('div');\n            root.id = 'ins-v46-root';\n            root.innerHTML = `\n                <div id=\"root-rgb\" class=\"rgb-layer\"></div>\n                <div id=\"ins-island\"></div>\n                <div id=\"root-inner\" class=\"inner-content\">\n                    <div id=\"ins-main-content\">\n                        <div class=\"main\">\n                            <div id=\"ins-cover\"></div>\n                            <div class=\"center\">\n                                <div class=\"meta\">\n                                    <div id=\"ins-t\">Ins Player</div>\n                                    <div id=\"ins-a\">Ready</div>\n                                </div>\n                                <div id=\"ins-lyrics\">â‹†â€¦â€¦ğ–¦¤â€¦â€¦â‹†</div>\n                                <div class=\"prog-wrap\">\n                                    <input type=\"range\" id=\"inp-prog\" value=\"0\" min=\"0\" max=\"100\">\n                                </div>\n                                <div class=\"ctrls\">\n                                    <button id=\"btn-mode\"></button>\n                                    <button id=\"btn-prev\">â®</button>\n                                    <button id=\"btn-play\">â–¶</button>\n                                    <button id=\"btn-next\">â­</button>\n                                    <button id=\"btn-list\">â˜°</button>\n                                </div>\n                            </div>\n                            <div class=\"right\">\n                                <button id=\"btn-min\" title=\"æœ€å°åŒ–\">ğ“†</button>\n                                <button id=\"btn-set\" title=\"è®¾ç½®\">â™¡</button>\n                                <button id=\"btn-pure\" title=\"çº¯äº«æ¨¡å¼\">ğ“†Ÿ</button>\n                            </div>\n                        </div>\n                        \n                        <div id=\"panel-set\" class=\"panel\">\n                            <div class=\"section-title\">æ’­æ”¾è®¾ç½®</div>\n                            <div class=\"row\">\n                                <span>å€é€Ÿ <b id=\"val-speed\">1.0x</b></span>\n                                <input id=\"inp-speed\" type=\"range\" min=\"0.5\" max=\"2.0\" step=\"0.1\">\n                            </div>\n                            \n                            <div class=\"section-title\">èƒŒæ™¯è®¾ç½®</div>\n                            <div class=\"row\">\n                                <span>å…¨å±èƒŒæ™¯</span>\n                                <div class=\"bg-ctrl\">\n                                    <input id=\"inp-expanded-col\" type=\"color\">\n                                    <button id=\"btn-expanded-upload\" class=\"upload-btn\">å¯¼å…¥</button>\n                                </div>\n                            </div>\n                            <div class=\"row\">\n                                <span>çª„å±èƒŒæ™¯</span>\n                                <div class=\"bg-ctrl\">\n                                    <input id=\"inp-collapsed-col\" type=\"color\">\n                                    <button id=\"btn-collapsed-upload\" class=\"upload-btn\">å¯¼å…¥</button>\n                                </div>\n                            </div>\n                            \n                            <div class=\"section-title\">å°é¢è®¾ç½®</div>\n                            <div class=\"row\">\n                                <span>å°é¢å›¾ç‰‡</span>\n                                <button id=\"btn-cover-upload\" class=\"upload-btn\">å¯¼å…¥</button>\n                            </div>\n                            <div class=\"row\">\n                                <span>å°é¢å®½åº¦ <b id=\"val-cover-w\">80px</b></span>\n                                <input id=\"inp-cover-w\" type=\"range\" min=\"60\" max=\"150\" step=\"5\">\n                            </div>\n                            <div class=\"row\">\n                                <span>å°é¢é«˜åº¦ <b id=\"val-cover-h\">80px</b></span>\n                                <input id=\"inp-cover-h\" type=\"range\" min=\"60\" max=\"150\" step=\"5\">\n                            </div>\n                            \n                            <div class=\"section-title\">RGB æ¨¡å¼</div>\n                            <div class=\"row\">\n                                <span>ç¯å…‰æ¨¡å¼</span>\n                                <div class=\"opt-group\">\n                                    <div class=\"rgb-opt\" data-val=\"0\">å…³</div>\n                                    <div class=\"rgb-opt\" data-val=\"1\">å•è‰²</div>\n                                    <div class=\"rgb-opt\" data-val=\"2\">å¹»å½©</div>\n                                </div>\n                            </div>\n                            <div class=\"row\">\n                                <span>å•è‰²é¢œè‰²</span>\n                                <input id=\"inp-rgb\" type=\"color\">\n                            </div>\n                            \n                            <div class=\"section-title\">é¢œè‰²è®¾ç½®</div>\n                            <div class=\"row col-2\">\n                                <label>å­—ä½“é¢œè‰² <input id=\"inp-theme\" type=\"color\"></label>\n                                <label>è¾¹æ¡†è‰² <input id=\"inp-border\" type=\"color\"></label>\n                            </div>\n                            \n                            <div class=\"section-title\">ç£¨ç ‚ç»ç’ƒè®¾ç½®</div>\n                            <div class=\"row\">\n                                <span>å¯ç”¨ç£¨ç ‚æ•ˆæœ</span>\n                                <input id=\"sw-glass\" type=\"checkbox\" checked>\n                            </div>\n                            <div class=\"row\">\n                                <span>é€æ˜åº¦ <b id=\"val-glass-opacity\">60%</b></span>\n                                <input id=\"inp-glass-opacity\" type=\"range\" min=\"10\" max=\"90\" value=\"60\">\n                            </div>\n                            \n                            <div class=\"section-title\">çº¯äº«æ¨¡å¼è®¾ç½®</div>\n                            <div class=\"row\">\n                                <span>å°ºå¯¸ <b id=\"val-pure-size\">400px</b></span>\n                                <input id=\"inp-pure-size\" type=\"range\" min=\"200\" max=\"800\" step=\"10\">\n                            </div>\n                            <div class=\"row\">\n                                <span>èƒŒæ™¯</span>\n                                <div class=\"bg-ctrl\">\n                                    <input id=\"inp-pure-bg\" type=\"color\">\n                                    <button id=\"btn-pure-bg-upload\" class=\"upload-btn\">å¯¼å…¥</button>\n                                </div>\n                            </div>\n                            <div class=\"row\">\n                                <span>ç­¾å</span>\n                                <button id=\"btn-pure-signature\" class=\"upload-btn\">è®¾ç½®</button>\n                            </div>\n                            \n                            <div class=\"section-title\">å°ºå¯¸è°ƒæ•´</div>\n                            <div class=\"row\">\n                                <span>æ’­æ”¾å™¨å®½åº¦ <b id=\"val-width-player\">400px</b></span>\n                                <input id=\"inp-width-player\" type=\"range\" min=\"300\" max=\"600\" step=\"10\">\n                            </div>\n                            <div class=\"row\">\n                                <span>æ’­æ”¾å™¨é«˜åº¦ <b id=\"val-height-player\">160px</b></span>\n                                <input id=\"inp-height-player\" type=\"range\" min=\"140\" max=\"300\" step=\"5\">\n                            </div>\n                            <div class=\"row\">\n                                <span>è¾¹æ¡†å®½åº¦ <b id=\"val-width\">6px</b></span>\n                                <input id=\"inp-width\" type=\"range\" min=\"1\" max=\"20\" step=\"1\">\n                            </div>\n                        </div>\n\n                        <div id=\"panel-list\" class=\"panel\">\n                            <div id=\"list-box\"></div>\n                            <button id=\"btn-add\" class=\"add-btn\">+ æ·»åŠ æ­Œæ›²</button>\n                        </div>\n                        \n                        <div id=\"panel-history\" class=\"panel\">\n                            <div class=\"section-title\">å¯¼å…¥å†å²</div>\n                            <div id=\"history-list\" class=\"history-list\"></div>\n                        </div>\n                    </div>\n                    \n                    <div id=\"ins-pure-mode\">\n                        <div id=\"pure-lyrics-container\"></div>\n                    </div>\n                </div>\n            `;\n            targetDoc.body.appendChild(root);\n            \n            // åˆå§‹åŒ–éŸ³é¢‘å¯è§†åŒ–\n            this.initAudioVisualizer();\n        },\n\n        injectCSS() {\n            const css = `\n                @keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.3} }\n                @keyframes color-cycle {\n                    0% { background-color: #ff0000; } \n                    14% { background-color: #ff7f00; } \n                    28% { background-color: #ffff00; } \n                    42% { background-color: #00ff00; } \n                    57% { background-color: #00ffff; } \n                    71% { background-color: #0000ff; } \n                    85% { background-color: #8b00ff; } \n                    100% { background-color: #ff0000; }\n                }\n                @keyframes starBlink { \n                    0% { opacity: 0.6; transform: scale(0.85); }\n                    100% { opacity: 1; transform: scale(1); }\n                }\n\n                /* çŠ¶æ€æç¤º */\n                #ins-status.status-info { background: #00d2ff; }\n                #ins-status.status-success { background: #00cc66; }\n                #ins-status.status-error { background: #ff4444; }\n\n                /* æ·»åŠ é€‰é¡¹å¯¹è¯æ¡† */\n                .add-options-dialog {\n                    background: #2a2a2a;\n                    border-radius: 16px;\n                    padding: 25px;\n                    min-width: 250px;\n                    text-align: center;\n                    color: #fff;\n                    box-shadow: 0 15px 35px rgba(0,0,0,0.5);\n                }\n\n                .add-options-btns {\n                    display: flex;\n                    flex-direction: column;\n                    gap: 15px;\n                    margin: 20px 0;\n                }\n\n                .add-options-btns button {\n                    background: rgba(255,255,255,0.1);\n                    border: 2px solid rgba(255,255,255,0.2);\n                    border-radius: 12px;\n                    padding: 20px;\n                    cursor: pointer;\n                    transition: all 0.3s;\n                    display: flex;\n                    flex-direction: column;\n                    align-items: center;\n                    justify-content: center;\n                    gap: 10px;\n                }\n\n                .add-options-btns button:hover {\n                    background: rgba(255,255,255,0.2);\n                    transform: translateY(-2px);\n                    border-color: rgba(255,255,255,0.3);\n                }\n\n                .option-icon {\n                    font-size: 32px;\n                    line-height: 1;\n                }\n\n                .option-text {\n                    font-size: 16px;\n                    font-weight: bold;\n                }\n\n                #add-single-btn:hover .option-icon { animation: none; }\n                #add-playlist-btn:hover .option-icon { animation: none; }\n\n                /* å¯¼å…¥å†å² */\n                .history-list {\n                    max-height: 300px;\n                    overflow-y: auto;\n                }\n\n                .history-list::-webkit-scrollbar {\n                    width: 4px;\n                }\n\n                .history-list::-webkit-scrollbar-thumb {\n                    background: rgba(255,255,255,0.3);\n                    border-radius: 2px;\n                }\n\n                .history-item {\n                    display: flex;\n                    align-items: center;\n                    padding: 12px 0;\n                    border-bottom: 1px solid rgba(255,255,255,0.1);\n                    gap: 12px;\n                }\n\n                .history-icon {\n                    font-size: 20px;\n                    width: 40px;\n                    height: 40px;\n                    display: flex;\n                    align-items: center;\n                    justify-content: center;\n                    background: rgba(255,255,255,0.1);\n                    border-radius: 10px;\n                }\n\n                .history-content {\n                    flex: 1;\n                    overflow: hidden;\n                }\n\n                .history-title {\n                    font-weight: bold;\n                    font-size: 13px;\n                    margin-bottom: 3px;\n                    white-space: nowrap;\n                    overflow: hidden;\n                    text-overflow: ellipsis;\n                }\n\n                .history-sub {\n                    font-size: 11px;\n                    opacity: 0.7;\n                    white-space: nowrap;\n                    overflow: hidden;\n                    text-overflow: ellipsis;\n                }\n\n                .history-time {\n                    font-size: 10px;\n                    opacity: 0.5;\n                    white-space: nowrap;\n                }\n\n                .no-history {\n                    text-align: center;\n                    padding: 40px 0;\n                    opacity: 0.5;\n                    font-size: 13px;\n                }\n\n                /* æ–°çš„éŸ³é¢‘å¯è§†åŒ–æ ·å¼ */\n                .new-audio-visualizer {\n                    position: absolute;\n                    top: 0;\n                    left: 0;\n                    width: 100%;\n                    height: 100%;\n                    display: flex;\n                    justify-content: center;\n                    align-items: center;\n                    gap: 2px;\n                    z-index: 5;\n                    pointer-events: none;\n                }\n\n                .audio-bar {\n                    width: 4px;\n                    background: currentColor;\n                    border-radius: 2px;\n                    transition: height 0.1s ease-out;\n                }\n\n                .audio-bar.top-bar {\n                    align-self: flex-start;\n                    margin-top: 5px;\n                }\n\n                .audio-bar.bottom-bar {\n                    align-self: flex-end;\n                    margin-bottom: 5px;\n                }\n\n                .audio-star {\n                    font-size: 14px;\n                    animation: starBlink 1s infinite alternate;\n                    opacity: 0.7;\n                    transform-origin: center;\n                }\n\n                /* ä¿®å¤ç£¨ç ‚ç»ç’ƒæ•ˆæœ */\n                #root-inner.glass-mode {\n                    backdrop-filter: blur(20px) saturate(180%);\n                    -webkit-backdrop-filter: blur(20px) saturate(180%);\n                    position: relative;\n                }\n\n                .glass-overlay {\n                    position: absolute;\n                    top: 0;\n                    left: 0;\n                    right: 0;\n                    bottom: 0;\n                    backdrop-filter: blur(20px) saturate(180%);\n                    -webkit-backdrop-filter: blur(20px) saturate(180%);\n                    z-index: 1;\n                    pointer-events: none;\n                }\n\n                /* çº¯äº«æ¨¡å¼æ ·å¼ */\n                #ins-pure-mode {\n                    display: none;\n                    flex-direction: column;\n                    justify-content: center;\n                    align-items: center;\n                    padding: 40px;\n                    box-sizing: border-box;\n                    overflow: hidden;\n                    cursor: pointer;\n                    width: 400px;\n                    height: 400px;\n                    transition: width 0.3s, height 0.3s;\n                }\n\n                .pure-signature {\n                    font-size: 12px;\n                    opacity: 0.6;\n                    margin-bottom: 20px;\n                    text-align: center;\n                }\n\n                .word-lyrics-line {\n                    font-size: 24px;\n                    font-weight: bold;\n                    text-align: center;\n                    line-height: 1.5;\n                    display: flex;\n                    flex-wrap: wrap;\n                    justify-content: center;\n                    gap: 2px;\n                }\n\n                .lyric-char {\n                    transition: all 0.3s ease;\n                }\n\n                #ins-v46-root.pure-mode #ins-main-content { display: none; }\n                #ins-v46-root.pure-mode #ins-pure-mode { display: flex; }\n\n                /* åŸæœ‰CSSä¿æŒä¸å˜ */\n                #ins-v46-icon {\n                    position: fixed; \n                    z-index: 2147483647;\n                    width: 300px; \n                    height: 50px;\n                    display: none; \n                    flex-direction: column;\n                    align-items: center; \n                    justify-content: flex-end;\n                    pointer-events: auto !important;\n                    --rgb-single: #00d2ff;\n                    background: transparent;\n                }\n\n                .icon-left-zone,\n                .icon-right-zone {\n                    position: absolute;\n                    top: 0;\n                    width: 50%;\n                    height: 100%;\n                    display: flex;\n                    align-items: center;\n                    justify-content: center;\n                    z-index: 10;\n                }\n                \n                .icon-left-zone {\n                    left: 0;\n                    cursor: grab;\n                }\n                .icon-left-zone:active {\n                    cursor: grabbing;\n                }\n                \n                .icon-right-zone {\n                    right: 0;\n                    cursor: pointer;\n                }\n\n                .zone-hint {\n                    font-size: 10px;\n                    color: rgba(0,0,0,0.3);\n                    opacity: 0;\n                    transition: opacity 0.3s;\n                    pointer-events: none;\n                }\n                \n                .icon-left-zone:hover .zone-hint,\n                .icon-right-zone:hover .zone-hint {\n                    opacity: 1;\n                }\n                \n                .wave-box { \n                    display: flex; \n                    align-items: flex-end; \n                    gap: 2px; \n                    height: 35px; \n                    width: 100%; \n                    justify-content: center;\n                    padding: 0 10px;\n                    box-sizing: border-box;\n                }\n                \n                .base-line { \n                    width: 100%; \n                    height: 2px; \n                    background: #000; \n                    margin-top: 1px; \n                }\n\n                #ins-v46-icon.playing .base-line { \n                    animation: blink 1s infinite; \n                }\n                \n                #ins-v46-icon.rgb-single .base-line { \n                    background: var(--rgb-single); \n                    box-shadow: 0 0 5px var(--rgb-single); \n                }\n                \n                #ins-v46-icon.rgb-rainbow .base-line { \n                    animation: color-cycle 4s infinite linear, blink 1s infinite; \n                }\n\n                #ins-v46-root {\n                    position: fixed; \n                    z-index: 2147483647;\n                    width: 400px;\n                    height: var(--player-h, 160px);\n                    border-radius: 30px; \n                    display: none; \n                    flex-direction: column;\n                    font-family: sans-serif; \n                    box-shadow: 0 20px 50px rgba(0,0,0,0.5);\n                    transition: height 0.3s, width 0.3s; \n                    pointer-events: auto !important;\n                    --rgb-single: #00d2ff; \n                    --border-w: 6px;\n                }\n                #ins-v46-root.expanded { height: 600px !important; }\n\n                #root-rgb { \n                    position: absolute; \n                    inset: 0; \n                    border-radius: 30px; \n                    z-index: 0; \n                    -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);\n                    -webkit-mask-composite: xor;\n                    mask-composite: exclude;\n                    padding: var(--border-w);\n                }\n                #root-rgb.mode-single { \n                    background: var(--rgb-single) !important; \n                    animation: blink 2s infinite; \n                }\n                #root-rgb.mode-rainbow { \n                    animation: color-cycle 4s infinite linear, blink 2s infinite; \n                }\n\n                #root-inner {\n                    position: absolute; \n                    top: var(--border-w); \n                    left: var(--border-w); \n                    right: var(--border-w); \n                    bottom: var(--border-w);\n                    border-radius: 24px; \n                    z-index: 1; \n                    overflow: hidden;\n                    background: #1a1a1a;\n                    transition: background 0.3s;\n                }\n\n                #ins-island { \n                    width: 70px; \n                    height: 18px; \n                    background: #000; \n                    margin: 0 auto; \n                    border-radius: 0 0 10px 10px; \n                    cursor: move; \n                    position: absolute; \n                    left: 50%; \n                    transform: translateX(-50%); \n                    z-index: 20; \n                    top: 0; \n                }\n                \n                .main { \n                    display: flex; \n                    height: 100%; \n                    padding: 30px 15px 15px; \n                    box-sizing: border-box; \n                    align-items: center; \n                    position: relative; \n                    z-index: 3; \n                }\n                \n                #ins-cover { \n                    width: 80px; \n                    height: 80px; \n                    border-radius: 12px; \n                    margin-right: 15px; \n                    background-size: cover; \n                    background-position: center; \n                    background-repeat: no-repeat;\n                    background-color: rgba(0,0,0,0.2);\n                    transition: width 0.3s, height 0.3s;\n                }\n                \n                .center { \n                    flex: 1; \n                    display: flex; \n                    flex-direction: column; \n                    justify-content: center; \n                    overflow: hidden; \n                }\n                \n                .meta { \n                    white-space: nowrap; \n                    overflow: hidden; \n                    margin-bottom: 5px; \n                }\n                #ins-t { font-weight: bold; font-size: 16px; }\n                #ins-a { font-size: 12px; opacity: 0.7; }\n                #ins-lyrics { \n                    font-size: 12px; \n                    opacity: 0.8; \n                    height: 16px; \n                    overflow: hidden; \n                    text-align: center; \n                }\n                \n                .prog-wrap { \n                    width: 100%; \n                    height: 6px; \n                    background: rgba(255,255,255,0.1); \n                    border-radius: 3px; \n                    position: relative; \n                    margin: 5px 0; \n                }\n                #inp-prog { \n                    width: 100%; \n                    height: 100%; \n                    -webkit-appearance: none; \n                    background: transparent; \n                    margin: 0; \n                    cursor: pointer;\n                }\n                #inp-prog::-webkit-slider-thumb { \n                    -webkit-appearance: none; \n                    width: 12px; \n                    height: 12px; \n                    background: var(--rgb-single); \n                    border-radius: 50%; \n                    box-shadow: 0 0 5px rgba(0,0,0,0.5); \n                    margin-top: -3px;\n                }\n                \n                .ctrls { \n                    display: flex; \n                    justify-content: space-between; \n                    align-items: center; \n                    padding-top: 10px; \n                }\n                .ctrls button { \n                    background: none; \n                    border: none; \n                    color: inherit; \n                    cursor: pointer; \n                    display: flex; \n                    align-items: center; \n                }\n                #btn-play { \n                    font-size: 22px; \n                    width: 26px; \n                    height: 26px; \n                    justify-content: center; \n                }\n                #btn-prev, #btn-next { font-size: 18px; }\n                #btn-mode { font-size: 18px; opacity: 0.8; }\n                #btn-list { font-size: 18px; opacity: 0.8; }\n\n                .right { \n                    display: flex; \n                    flex-direction: column; \n                    justify-content: space-between; \n                    height: 100px; \n                    margin-left: 12px; \n                }\n                .right button { \n                    background: none; \n                    border: none; \n                    font-size: 22px; \n                    cursor: pointer; \n                    opacity: 0.7; \n                    color: inherit; \n                    padding: 5px;\n                    transition: opacity 0.2s;\n                }\n                .right button:hover { opacity: 1; }\n                \n                .panel { \n                    flex: 1; \n                    display: none; \n                    flex-direction: column; \n                    padding: 15px; \n                    overflow-y: auto; \n                    position: relative; \n                    z-index: 3; \n                    max-height: 400px;\n                    background: transparent;\n                }\n                \n                .section-title {\n                    font-weight: bold;\n                    font-size: 13px;\n                    margin: 12px 0 8px 0;\n                    padding-bottom: 5px;\n                    border-bottom: 1px solid rgba(255,255,255,0.15);\n                    position: relative;\n                }\n                .section-title:first-child { margin-top: 0; }\n                \n                .row { \n                    display: flex; \n                    justify-content: space-between; \n                    margin-bottom: 10px; \n                    font-size: 12px; \n                    align-items: center;\n                    padding: 6px 0;\n                    border-bottom: 1px solid rgba(255,255,255,0.08);\n                    position: relative;\n                }\n                \n                .row.col-2 { gap: 10px; }\n                .row.col-2 label { \n                    flex: 1; \n                    display: flex; \n                    justify-content: space-between; \n                    align-items: center; \n                    font-size: 12px; \n                }\n                \n                .bg-ctrl { display: flex; gap: 5px; align-items: center; }\n                \n                .upload-btn, .add-btn {\n                    padding: 5px 10px;\n                    background: rgba(255,255,255,0.1);\n                    border: 1px solid rgba(255,255,255,0.2);\n                    color: #fff;\n                    border-radius: 5px;\n                    cursor: pointer;\n                    font-size: 11px;\n                    transition: all 0.2s;\n                }\n                .upload-btn:hover, .add-btn:hover {\n                    background: rgba(255,255,255,0.2);\n                }\n                \n                .opt-group { \n                    display: flex; \n                    gap: 4px; \n                    background: rgba(0,0,0,0.3); \n                    padding: 2px; \n                    border-radius: 5px; \n                }\n                .rgb-opt { \n                    padding: 4px 8px; \n                    cursor: pointer; \n                    border-radius: 4px; \n                    font-size: 11px; \n                    transition: all 0.2s; \n                }\n                .rgb-opt.active { \n                    background: #fff; \n                    color: #000; \n                    font-weight: bold; \n                }\n\n                input[type=color] { \n                    width: 28px; \n                    height: 28px; \n                    border: none; \n                    background: none; \n                    cursor: pointer; \n                    border-radius: 4px; \n                }\n                input[type=range] { width: 100px; }\n                input[type=checkbox] { \n                    width: 16px; \n                    height: 16px; \n                    cursor: pointer; \n                }\n                \n                .item { \n                    display: flex; \n                    justify-content: space-between; \n                    padding: 10px 0; \n                    border-bottom: 1px solid rgba(255,255,255,0.1); \n                    align-items: center;\n                }\n                \n                .item.active { color: var(--rgb-single); font-weight: bold; }\n                .item .info { flex: 1; cursor: pointer; font-size: 13px; }\n                .item-btns { display: flex; gap: 8px; align-items: center; }\n                .item-btns button { padding: 3px 8px; font-size: 11px; }\n                .btn-lyrics { \n                    background: rgba(255,255,255,0.1); \n                    border: 1px solid rgba(255,255,255,0.2); \n                    color: #fff; \n                    border-radius: 4px; \n                    cursor: pointer; \n                }\n                .del { \n                    background: none; \n                    border: none; \n                    color: #f55; \n                    cursor: pointer; \n                    font-size: 18px; \n                }\n                \n                .add-btn { \n                    width: 100%; \n                    padding: 12px; \n                    background: var(--rgb-single); \n                    border: none; \n                    cursor: pointer; \n                    font-weight: bold; \n                    border-radius: 8px; \n                    color: #000; \n                    margin-top: 10px; \n                    font-size: 13px;\n                }\n\n                #list-box { max-height: 280px; overflow-y: auto; }\n                #list-box::-webkit-scrollbar { width: 4px; }\n                #list-box::-webkit-scrollbar-thumb { \n                    background: rgba(255,255,255,0.3); \n                    border-radius: 2px; \n                }\n\n                .panel::-webkit-scrollbar { width: 4px; }\n                .panel::-webkit-scrollbar-thumb { \n                    background: rgba(255,255,255,0.3); \n                    border-radius: 2px; \n                }\n\n                /* æ­Œè¯å¯¹è¯æ¡† */\n                .lyrics-dialog-overlay {\n                    position: fixed;\n                    top: 0;\n                    left: 0;\n                    right: 0;\n                    bottom: 0;\n                    background: rgba(0,0,0,0.6);\n                    display: flex;\n                    justify-content: center;\n                    align-items: center;\n                    z-index: 2147483648;\n                }\n\n                .lyrics-dialog {\n                    background: #2a2a2a;\n                    border-radius: 12px;\n                    padding: 20px;\n                    min-width: 200px;\n                    text-align: center;\n                    color: #fff;\n                    box-shadow: 0 10px 30px rgba(0,0,0,0.5);\n                }\n\n                .lyrics-dialog-title {\n                    font-size: 16px;\n                    font-weight: bold;\n                    margin-bottom: 15px;\n                }\n\n                .lyrics-dialog-btns {\n                    display: flex;\n                    flex-direction: column;\n                    gap: 10px;\n                    margin-bottom: 15px;\n                }\n\n                .lyrics-dialog-btns button {\n                    padding: 12px 20px;\n                    border: none;\n                    border-radius: 8px;\n                    cursor: pointer;\n                    font-size: 14px;\n                    transition: all 0.2s;\n                }\n\n                #lyrics-paste-btn {\n                    background: #00d2ff;\n                    color: #000;\n                }\n\n                #lyrics-import-btn {\n                    background: #ff6b9d;\n                    color: #000;\n                }\n\n                .lyrics-dialog-btns button:hover {\n                    transform: scale(1.02);\n                    opacity: 0.9;\n                }\n\n                .lyrics-cancel {\n                    background: transparent;\n                    border: 1px solid rgba(255,255,255,0.3) !important;\n                    color: #fff;\n                    padding: 8px 20px;\n                    border-radius: 6px;\n                    cursor: pointer;\n                    font-size: 12px;\n                }\n\n                .lyrics-cancel:hover {\n                    background: rgba(255,255,255,0.1);\n                }\n            `;\n            const style = targetDoc.createElement('style');\n            style.textContent = css;\n            targetDoc.head.appendChild(style);\n        }\n    };\n\n    App.init();\n\n})();",
  "info": "",
  "button": {
    "enabled": true,
    "buttons": []
  },
  "data": {}
}