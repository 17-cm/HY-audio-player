<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HYéŸ³ä¹æ’­æ”¾å™¨</title>
    <link rel="stylesheet" href="player.css">
    <link rel="stylesheet" href="icon.css">
    <style>
        /* ===== å…³é”®ä¿®å¤ï¼šiframeå†…åµŒé€‚é…æ ·å¼ ===== */
        /* é‡ç½®bodyå’Œhtmlï¼Œç¡®ä¿åœ¨iframeå†…æ­£å¸¸æ˜¾ç¤º */
        html, body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: auto; /* å…è®¸æ»šåŠ¨ï¼Œä½†é™åˆ¶åœ¨iframeå†… */
            background: transparent !important;
        }
        
        /* ä¸»å®¹å™¨ - ç§»é™¤fixedå®šä½ï¼Œæ”¹ä¸ºå¸¸è§„å¸ƒå±€ */
        #music-player-container {
            position: relative; /* æ”¹ä¸ºrelative */
            width: 100%;
            min-height: 100%;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: transparent;
            box-sizing: border-box;
            z-index: 1; /* é™ä½z-index */
        }
        
        /* ç¡®ä¿æ‰€æœ‰å­å…ƒç´ ç›’æ¨¡å‹æ­£ç¡® */
        #music-player-container * {
            box-sizing: border-box;
            max-width: 100%;
        }
        
        /* ä¸»é¢˜è‡ªé€‚åº” - ä¿æŒåŸæ · */
        @media (prefers-color-scheme: light) {
            :root {
                --icon-filter: invert(0);
            }
        }
        
        @media (prefers-color-scheme: dark) {
            :root {
                --icon-filter: invert(1);
            }
        }
        
        .extension-icon {
            filter: var(--icon-filter, invert(0));
            transition: filter 0.3s;
        }
        
        /* ===== å†…åµŒæ¨¡å¼ç‰¹æ®Šå¤„ç† ===== */
        /* æ£€æµ‹æ˜¯å¦åœ¨iframeä¸­ï¼Œå¹¶åº”ç”¨ç›¸åº”æ ·å¼ */
        .iframe-mode #music-player-container {
            padding: 10px;
        }
        
        /* é˜²æ­¢ä»»ä½•å…ƒç´ å°è¯•è·³å‡ºiframe */
        .no-escape {
            position: relative !important;
            z-index: auto !important;
        }
    </style>
</head>
<body>
    <!-- æ·»åŠ iframeæ£€æµ‹ç±» -->
    <script>
        // æ£€æµ‹æ˜¯å¦åœ¨iframeä¸­è¿è¡Œ
        if (window !== window.top) {
            document.body.classList.add('iframe-mode');
            console.log('ğŸµ HYæ’­æ”¾å™¨ï¼šiframeå†…åµŒæ¨¡å¼');
            
            // å®‰å…¨æªæ–½ï¼šé˜²æ­¢çˆ¶çª—å£è®¿é—®
            Object.defineProperty(window, 'top', { get: function() { return window; } });
            Object.defineProperty(window, 'parent', { get: function() { return window; } });
            
            // é˜²æ­¢ä»»ä½•å¯èƒ½çš„è·³è½¬å°è¯•
            window.addEventListener('beforeunload', function(e) {
                // åœ¨iframeä¸­ä¸æ‰§è¡Œä»»ä½•è·³è½¬
                return null;
            });
        } else {
            console.log('ğŸµ HYæ’­æ”¾å™¨ï¼šç‹¬ç«‹çª—å£æ¨¡å¼');
        }
    </script>
    
    <div id="music-player-container" class="no-escape">
        <!-- æ’­æ”¾å™¨å°†é€šè¿‡JSåŠ¨æ€æ’å…¥ -->
    </div>
    
    <script src="player.js"></script>
    <script>
        // æ‰©å±•åˆå§‹åŒ– - å®‰å…¨ç‰ˆæœ¬
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸµ éŸ³ä¹æ’­æ”¾å™¨æ‰©å±•å·²åŠ è½½ï¼ˆå®‰å…¨æ¨¡å¼ï¼‰');
            
            // å®‰å…¨æ£€æŸ¥ï¼šç¡®ä¿ä¸å°è¯•è·³å‡ºiframe
            if (window !== window.top) {
                // åœ¨iframeä¸­ï¼Œç¦ç”¨æ‰€æœ‰å¯èƒ½çš„é‡å®šå‘
                window.location.replace = function() { 
                    console.warn('é‡å®šå‘å°è¯•è¢«é˜»æ­¢ï¼ˆiframeå®‰å…¨æ¨¡å¼ï¼‰');
                    return false;
                };
                
                // è¦†ç›–å¯èƒ½çš„å±é™©æ“ä½œ
                const originalOpen = window.open;
                window.open = function(url, name, specs) {
                    console.warn('window.openè°ƒç”¨è¢«é˜»æ­¢ï¼ˆiframeå®‰å…¨æ¨¡å¼ï¼‰:', url);
                    return null;
                };
            }
            
            // ç­‰å¾…ä¸€å°æ®µæ—¶é—´ç¡®ä¿DOMå®Œå…¨åŠ è½½
            setTimeout(() => {
                if (window.MusicPlayerApp) {
                    try {
                        window.MusicPlayerApp.init();
                        console.log('ğŸµ æ’­æ”¾å™¨åˆå§‹åŒ–æˆåŠŸ');
                    } catch (e) {
                        console.error('ğŸµ æ’­æ”¾å™¨åˆå§‹åŒ–å¤±è´¥:', e);
                    }
                } else {
                    console.error('ğŸµ MusicPlayerAppæœªå®šä¹‰');
                }
            }, 100);
        });
        
        // å¯¼å‡ºç»™é…’é¦†æ‰©å±•ç³»ç»Ÿ - å®‰å…¨ç‰ˆæœ¬
        window.MusicPlayerExtension = {
            version: '1.0.0',
            name: 'éŸ³ä¹æ’­æ”¾å™¨',
            isInIframe: function() {
                return window !== window.top;
            },
            destroy: function() {
                if (window.MusicPlayerApp) {
                    try {
                        window.MusicPlayerApp.cleanup();
                        console.log('ğŸµ æ’­æ”¾å™¨æ¸…ç†å®Œæˆ');
                    } catch (e) {
                        console.error('ğŸµ æ’­æ”¾å™¨æ¸…ç†å¤±è´¥:', e);
                    }
                }
            },
            // å®‰å…¨çš„é‡ç½®æ–¹æ³•ï¼ˆä¸é‡å®šå‘ï¼‰
            reset: function() {
                console.log('ğŸµ æ’­æ”¾å™¨é‡ç½®ï¼ˆå®‰å…¨æ¨¡å¼ï¼‰');
                if (window.MusicPlayerApp && window.MusicPlayerApp.reset) {
                    window.MusicPlayerApp.reset();
                }
            }
        };
    </script>
</body>
</html>
